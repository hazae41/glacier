{"version":3,"file":"schema.js","sources":["../../../../src/mods/single/schema.ts"],"sourcesContent":["import { Core } from \"mods/core.js\";\nimport { Fetcher } from \"mods/types/fetcher.js\";\nimport { NormalizerMore } from \"mods/types/normalizer.js\";\nimport { Params } from \"mods/types/params.js\";\nimport { Schema } from \"mods/types/schema.js\";\nimport { SingleInstance } from \"./instance.js\";\n\nexport function getSingleSchema<D = any, E = any, K = any>(\n  key: K | undefined,\n  fetcher: Fetcher<D, E, K> | undefined,\n  params: Params<D, E, K> = {},\n) {\n  return new SingleSchema(key, fetcher, params)\n}\n\nexport class SingleSchema<D = any, E = any, K = any> implements Schema<D, E, K, SingleInstance<D, E, K>>  {\n  constructor(\n    readonly key: K | undefined,\n    readonly fetcher: Fetcher<D, E, K> | undefined,\n    readonly params: Params<D, E, K> = {},\n  ) { }\n\n  make(core: Core) {\n    const { key, fetcher, params } = this\n\n    return new SingleInstance<D, E, K>(core, key, fetcher, params)\n  }\n\n  async normalize(data: D, more: NormalizerMore<D, E, K>) {\n    if (more.shallow) return\n    const { time, cooldown, expiration, optimistic } = more.root\n    const state = { data, time, cooldown, expiration, optimistic }\n    await this.make(more.core).mutate(() => state)\n  }\n}"],"names":["SingleInstance"],"mappings":";;;;;;;SAOgB,eAAe,CAC7B,GAAkB,EAClB,OAAqC,EACrC,MAA4B,EAAA;AAA5B,IAAA,IAAA,MAAA,KAAA,KAAA,CAAA,EAAA,EAAA,MAA4B,GAAA,EAAA,CAAA,EAAA;IAE5B,OAAO,IAAI,YAAY,CAAC,GAAG,EAAE,OAAO,EAAE,MAAM,CAAC,CAAA;AAC/C,CAAC;AAED,IAAA,YAAA,kBAAA,YAAA;AACE,IAAA,SAAA,YAAA,CACW,GAAkB,EAClB,OAAqC,EACrC,MAA4B,EAAA;AAA5B,QAAA,IAAA,MAAA,KAAA,KAAA,CAAA,EAAA,EAAA,MAA4B,GAAA,EAAA,CAAA,EAAA;QAF5B,IAAG,CAAA,GAAA,GAAH,GAAG,CAAe;QAClB,IAAO,CAAA,OAAA,GAAP,OAAO,CAA8B;QACrC,IAAM,CAAA,MAAA,GAAN,MAAM,CAAsB;KAClC;IAEL,YAAI,CAAA,SAAA,CAAA,IAAA,GAAJ,UAAK,IAAU,EAAA;QACP,IAAA,EAAA,GAA2B,IAAI,EAA7B,GAAG,GAAA,EAAA,CAAA,GAAA,EAAE,OAAO,GAAA,EAAA,CAAA,OAAA,EAAE,MAAM,GAAA,EAAA,CAAA,MAAS,CAAA;QAErC,OAAO,IAAIA,uBAAc,CAAU,IAAI,EAAE,GAAG,EAAE,OAAO,EAAE,MAAM,CAAC,CAAA;KAC/D,CAAA;AAEK,IAAA,YAAA,CAAA,SAAA,CAAA,SAAS,GAAf,UAAgB,IAAO,EAAE,IAA6B,EAAA;;;;;;wBACpD,IAAI,IAAI,CAAC,OAAO;4BAAE,OAAM,CAAA,CAAA,YAAA,CAAA;AAClB,wBAAA,EAAA,GAA6C,IAAI,CAAC,IAAI,EAApD,IAAI,GAAA,EAAA,CAAA,IAAA,EAAE,QAAQ,GAAA,EAAA,CAAA,QAAA,EAAE,UAAU,GAAA,EAAA,CAAA,UAAA,EAAE,UAAU,gBAAA,CAAc;AACtD,wBAAA,KAAK,GAAG,EAAE,IAAI,EAAA,IAAA,EAAE,IAAI,EAAA,IAAA,EAAE,QAAQ,EAAA,QAAA,EAAE,UAAU,EAAA,UAAA,EAAE,UAAU,EAAA,UAAA,EAAE,CAAA;AAC9D,wBAAA,OAAA,CAAA,CAAA,YAAM,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC,YAAM,EAAA,OAAA,KAAK,CAAL,EAAK,CAAC,CAAA,CAAA;;AAA9C,wBAAA,EAAA,CAAA,IAAA,EAA8C,CAAA;;;;;AAC/C,KAAA,CAAA;IACH,OAAC,YAAA,CAAA;AAAD,CAAC,EAAA;;;;;"}