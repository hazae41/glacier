{"version":3,"file":"helper.js","sources":["../../../../src/mods/scroll/helper.ts"],"sourcesContent":["import { lastOf } from \"libs/arrays.js\";\nimport { getTimeFromDelay } from \"libs/time.js\";\nimport { Core } from \"mods/core.js\";\nimport { AbortError } from \"mods/errors/abort.js\";\nimport { Fetcher } from \"mods/types/fetcher.js\";\nimport { Params } from \"mods/types/params.js\";\nimport { Scroller } from \"mods/types/scroller.js\";\nimport { State } from \"mods/types/state.js\";\nimport { DEFAULT_COOLDOWN, DEFAULT_EQUALS, DEFAULT_EXPIRATION, DEFAULT_TIMEOUT } from \"mods/utils/defaults.js\";\n\nexport class ScrollHelper {\n  constructor(readonly core: Core) { }\n\n  /**\n   * Fetch first page\n   * @param skey Storage key\n   * @param scroller Key scroller\n   * @param fetcher Resource fetcher\n   * @param aborter AbortController\n   * @param tparams Time parameters\n   * @param force Should ignore cooldown\n   * @returns The new state\n   */\n  async first<D = any, E = any, K = any>(\n    skey: string | undefined,\n    scroller: Scroller<D, E, K>,\n    fetcher: Fetcher<D, E, K>,\n    aborter = new AbortController(),\n    params: Params<D[], E, K> = {},\n    force = false,\n    ignore = false\n  ): Promise<State<D[], E, K> | undefined> {\n    if (skey === undefined) return\n\n    let { current, skip, first } = await this.core.lock(skey, async () => {\n      let current = await this.core.get(skey, params)\n\n      if (current?.optimistic)\n        return { current, skip: true }\n      if (current?.aborter && !force)\n        return { current, skip: true }\n      if (current?.aborter && force)\n        current.aborter.abort(\"Replaced\")\n\n      if (this.core.shouldCooldown(current) && !ignore)\n        return { current, skip: true }\n\n      const first = scroller(undefined)\n\n      if (first === undefined)\n        return { current, skip: true }\n\n      current = await this.core.mutate(skey, current,\n        c => ({ time: c?.time, aborter }),\n        params)\n      return { current, first }\n    })\n\n    if (skip)\n      return current\n    if (first === undefined)\n      throw new Error(\"Undefined first\")\n\n    const {\n      equals = DEFAULT_EQUALS,\n      cooldown: dcooldown = DEFAULT_COOLDOWN,\n      expiration: dexpiration = DEFAULT_EXPIRATION,\n      timeout: dtimeout = DEFAULT_TIMEOUT,\n    } = params\n\n    const timeout = setTimeout(() => {\n      aborter.abort(\"First timed out\")\n    }, dtimeout)\n\n    try {\n      const { signal } = aborter\n\n      const {\n        data,\n        error,\n        time = Date.now(),\n        cooldown = getTimeFromDelay(dcooldown),\n        expiration = getTimeFromDelay(dexpiration)\n      } = await fetcher(first, { signal })\n\n      if (signal.aborted)\n        throw new AbortError(signal)\n\n      current = await this.core.get(skey, params)\n\n      const state: State<D[], E, K> = {}\n\n      if (data !== undefined)\n        state.data = [data]\n      state.error = error\n\n      if (data !== undefined) {\n        const norm = await this.core.normalize(true, { data: [data] }, params)\n        if (equals(norm?.[0], current?.data?.[0])) delete state.data\n      }\n\n      return await this.core.mutate(skey, current,\n        () => ({ time, cooldown, expiration, aborter: undefined, ...state }),\n        params)\n    } catch (error: any) {\n      current = await this.core.get(skey, params)\n\n      if (current?.aborter !== aborter)\n        return current\n      return await this.core.mutate(skey, current,\n        () => ({ aborter: undefined, error }),\n        params)\n    } finally {\n      clearTimeout(timeout)\n    }\n  }\n\n  /**\n   * Scroll to the next page\n   * @param skey Storage key\n   * @param scroller Key scroller\n   * @param fetcher Resource fetcher\n   * @param aborter AbortController\n   * @param tparams Time parameters\n   * @param force Should ignore cooldown\n   * @returns The new state\n   */\n  async scroll<D = any, E = any, K = any>(\n    skey: string | undefined,\n    scroller: Scroller<D, E, K>,\n    fetcher: Fetcher<D, E, K>,\n    aborter = new AbortController(),\n    params: Params<D[], E, K> = {},\n    force = false,\n    ignore = false\n  ): Promise<State<D[], E, K> | undefined> {\n    if (skey === undefined) return\n\n    let { current, skip, last } = await this.core.lock(skey, async () => {\n      let current = await this.core.get(skey, params)\n\n      if (current?.optimistic)\n        return { current, skip: true }\n      if (current?.aborter && !force)\n        return { current, skip: true }\n      if (current?.aborter && force)\n        current.aborter.abort(\"Replaced\")\n\n      if (this.core.shouldCooldown(current) && !ignore)\n        return { current, skip: true }\n\n      const pages = current?.data ?? []\n      const last = scroller(lastOf(pages))\n\n      if (last === undefined)\n        return { current, skip: true }\n\n      current = await this.core.mutate(skey, current,\n        c => ({ time: c?.time, aborter }),\n        params)\n      return { current, last }\n    })\n\n    if (skip)\n      return current\n    if (last === undefined)\n      throw new Error(\"Undefined last\")\n\n    const {\n      cooldown: dcooldown = DEFAULT_COOLDOWN,\n      expiration: dexpiration = DEFAULT_EXPIRATION,\n      timeout: dtimeout = DEFAULT_TIMEOUT,\n    } = params\n\n    const timeout = setTimeout(() => {\n      aborter.abort(\"Scroll timed out\")\n    }, dtimeout)\n\n    try {\n      const { signal } = aborter\n\n      let {\n        data,\n        error,\n        time = Date.now(),\n        cooldown = getTimeFromDelay(dcooldown),\n        expiration = getTimeFromDelay(dexpiration)\n      } = await fetcher(last, { signal })\n\n      if (signal.aborted)\n        throw new AbortError(signal)\n\n      if (expiration !== undefined && current?.expiration !== undefined)\n        expiration = Math.min(expiration, current?.expiration)\n\n      current = await this.core.get(skey, params)\n\n      const state: State<D[], E, K> = {}\n\n      if (data !== undefined)\n        state.data = [...(current?.data ?? []), data]\n      state.error = error\n\n      return await this.core.mutate(skey, current,\n        () => ({ time, cooldown, expiration, aborter: undefined, ...state }),\n        params)\n    } catch (error: any) {\n      current = await this.core.get(skey, params)\n\n      if (current?.aborter !== aborter)\n        return current\n      return await this.core.mutate(skey, current,\n        () => ({ aborter: undefined, error }),\n        params)\n    } finally {\n      clearTimeout(timeout)\n    }\n  }\n}"],"names":["__awaiter","DEFAULT_EQUALS","DEFAULT_COOLDOWN","DEFAULT_EXPIRATION","DEFAULT_TIMEOUT","getTimeFromDelay","AbortError","__assign","lastOf","__spreadArray","__read"],"mappings":"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"}