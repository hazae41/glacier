{"version":3,"file":"ortho.cjs","sources":["../../../src/libs/ortho.ts"],"sourcesContent":["\n/**\n * Map of arrays data structure\n */\nexport class MapOfArrays<K = any, V = any> {\n  private map = new Map<K, V[]>()\n\n  get(key: K) {\n    return this.map.get(key)\n  }\n\n  push(key: K, value: V) {\n    const values = this.map.get(key)\n    if (!values) this.map.set(key, [value])\n    else values.push(value)\n  }\n\n  erase(key: K, value: V) {\n    const values = this.map.get(key)\n    if (!values) return\n    const values2 = values\n      .filter(it => it !== value)\n    if (values2.length)\n      this.map.set(key, values2)\n    else\n      this.map.delete(key)\n  }\n}\n\n/**\n * Orthogonal state publisher\n */\nexport class Ortho<K = any, S = any> {\n  private listeners = new MapOfArrays<K, (x: S) => void>()\n\n  publish(key: K, value: S) {\n    const listeners = this.listeners.get(key)\n    if (!listeners) return\n\n    for (const listener of listeners)\n      listener(value)\n  }\n\n  on(key: K, listener: (x: S) => void) {\n    this.listeners.push(key, listener)\n  }\n\n  off(key: K, listener: (x: S) => void) {\n    this.listeners.erase(key, listener)\n  }\n}\n"],"names":["__values"],"mappings":";;;;;;AACA;;AAEG;AACH,IAAA,WAAA,kBAAA,YAAA;AAAA,IAAA,SAAA,WAAA,GAAA;AACU,QAAA,IAAA,CAAA,GAAG,GAAG,IAAI,GAAG,EAAU,CAAA;KAsBhC;IApBC,WAAG,CAAA,SAAA,CAAA,GAAA,GAAH,UAAI,GAAM,EAAA;QACR,OAAO,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,CAAA;KACzB,CAAA;AAED,IAAA,WAAA,CAAA,SAAA,CAAA,IAAI,GAAJ,UAAK,GAAM,EAAE,KAAQ,EAAA;QACnB,IAAM,MAAM,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,CAAA;AAChC,QAAA,IAAI,CAAC,MAAM;YAAE,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,EAAE,CAAC,KAAK,CAAC,CAAC,CAAA;;AAClC,YAAA,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAA;KACxB,CAAA;AAED,IAAA,WAAA,CAAA,SAAA,CAAA,KAAK,GAAL,UAAM,GAAM,EAAE,KAAQ,EAAA;QACpB,IAAM,MAAM,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,CAAA;AAChC,QAAA,IAAI,CAAC,MAAM;YAAE,OAAM;QACnB,IAAM,OAAO,GAAG,MAAM;aACnB,MAAM,CAAC,UAAA,EAAE,EAAI,EAAA,OAAA,EAAE,KAAK,KAAK,CAAA,EAAA,CAAC,CAAA;QAC7B,IAAI,OAAO,CAAC,MAAM;YAChB,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,EAAE,OAAO,CAAC,CAAA;;AAE1B,YAAA,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAA;KACvB,CAAA;IACH,OAAC,WAAA,CAAA;AAAD,CAAC,EAAA,EAAA;AAED;;AAEG;AACH,IAAA,KAAA,kBAAA,YAAA;AAAA,IAAA,SAAA,KAAA,GAAA;AACU,QAAA,IAAA,CAAA,SAAS,GAAG,IAAI,WAAW,EAAqB,CAAA;KAiBzD;AAfC,IAAA,KAAA,CAAA,SAAA,CAAA,OAAO,GAAP,UAAQ,GAAM,EAAE,KAAQ,EAAA;;QACtB,IAAM,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,GAAG,CAAC,CAAA;AACzC,QAAA,IAAI,CAAC,SAAS;YAAE,OAAM;;AAEtB,YAAA,KAAuB,IAAA,WAAA,GAAAA,cAAA,CAAA,SAAS,CAAA,EAAA,aAAA,GAAA,WAAA,CAAA,IAAA,EAAA,EAAA,CAAA,aAAA,CAAA,IAAA,EAAA,aAAA,GAAA,WAAA,CAAA,IAAA,EAAA,EAAA;AAA3B,gBAAA,IAAM,QAAQ,GAAA,aAAA,CAAA,KAAA,CAAA;gBACjB,QAAQ,CAAC,KAAK,CAAC,CAAA;AAAA,aAAA;;;;;;;;;KAClB,CAAA;AAED,IAAA,KAAA,CAAA,SAAA,CAAA,EAAE,GAAF,UAAG,GAAM,EAAE,QAAwB,EAAA;QACjC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,GAAG,EAAE,QAAQ,CAAC,CAAA;KACnC,CAAA;AAED,IAAA,KAAA,CAAA,SAAA,CAAA,GAAG,GAAH,UAAI,GAAM,EAAE,QAAwB,EAAA;QAClC,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,GAAG,EAAE,QAAQ,CAAC,CAAA;KACpC,CAAA;IACH,OAAC,KAAA,CAAA;AAAD,CAAC,EAAA;;;;;"}