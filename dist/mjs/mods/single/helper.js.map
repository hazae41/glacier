{"version":3,"file":"helper.js","sources":["../../../../src/mods/single/helper.ts"],"sourcesContent":["import { getTimeFromDelay } from \"libs/time.js\";\nimport { Core } from \"mods/core.js\";\nimport { AbortError } from \"mods/errors/abort.js\";\nimport { Fetcher } from \"mods/types/fetcher.js\";\nimport { Params } from \"mods/types/params.js\";\nimport { Result } from \"mods/types/result.js\";\nimport { State } from \"mods/types/state.js\";\nimport { Updater } from \"mods/types/updater.js\";\nimport { DEFAULT_COOLDOWN, DEFAULT_EXPIRATION, DEFAULT_TIMEOUT } from \"mods/utils/defaults.js\";\n\nexport class SingleHelper {\n  constructor(readonly core: Core) { }\n\n  /**\n   * Fetch\n   * @param key Key (passed to fetcher)\n   * @param skey Storage key\n   * @param fetcher Resource fetcher\n   * @param aborter AbortController\n   * @param tparams Time parameters\n   * @param force Should ignore cooldown\n   * @returns The new state\n   */\n  async fetch<D = any, E = any, K = any>(\n    key: K | undefined,\n    skey: string | undefined,\n    fetcher: Fetcher<D, E, K>,\n    aborter = new AbortController(),\n    params: Params<D, E, K> = {},\n    force = false,\n    ignore = false\n  ): Promise<State<D, E, K> | undefined> {\n    if (key === undefined) return\n    if (skey === undefined) return\n\n    let { current, skip } = await this.core.lock(skey, async () => {\n      let current = await this.core.get(skey, params)\n\n      if (current?.optimistic)\n        return { current, skip: true }\n      if (current?.aborter && !force)\n        return { current, skip: true }\n      if (current?.aborter && force)\n        current.aborter.abort(\"Replaced\")\n\n      if (this.core.shouldCooldown(current) && !ignore)\n        return { current, skip: true }\n\n      current = await this.core.mutate(skey, current,\n        c => ({ time: c?.time, aborter }),\n        params)\n      return { current }\n    })\n\n    if (skip)\n      return current\n\n    const {\n      cooldown: dcooldown = DEFAULT_COOLDOWN,\n      expiration: dexpiration = DEFAULT_EXPIRATION,\n      timeout: dtimeout = DEFAULT_TIMEOUT,\n    } = params\n\n    const timeout = setTimeout(() => {\n      aborter.abort(\"Fetch timed out\")\n    }, dtimeout)\n\n    try {\n      const { signal } = aborter\n\n      const {\n        data,\n        error,\n        time = Date.now(),\n        cooldown = getTimeFromDelay(dcooldown),\n        expiration = getTimeFromDelay(dexpiration)\n      } = await fetcher(key, { signal })\n\n      if (signal.aborted)\n        throw new AbortError(signal)\n\n      current = await this.core.get(skey, params)\n\n      const state: State<D, E, K> = {}\n\n      if (data !== undefined)\n        state.data = data\n      state.error = error\n\n      return await this.core.mutate(skey, current,\n        () => ({ time, cooldown, expiration, aborter: undefined, ...state }),\n        params)\n    } catch (error: any) {\n      current = await this.core.get(skey, params)\n\n      if (current?.aborter !== aborter)\n        return current\n      return await this.core.mutate(skey, current,\n        () => ({ aborter: undefined, error }),\n        params)\n    } finally {\n      clearTimeout(timeout)\n    }\n  }\n\n  /**\n   * Optimistic update\n   * @param key Key (:K) (passed to poster)\n   * @param skey Storage key\n   * @param fetcher Resource poster\n   * @param updater Mutation function\n   * @param aborter AbortController\n   * @param tparams Time parameters\n   * @returns The new state\n   * @throws Error\n   */\n  async update<D = any, E = any, K = any>(\n    key: K | undefined,\n    skey: string | undefined,\n    fetcher: Fetcher<D, E, K> | undefined,\n    updater: Updater<D, E, K>,\n    aborter = new AbortController(),\n    params: Params<D, E, K> = {},\n  ): Promise<State<D, E, K> | undefined> {\n    if (key === undefined) return\n    if (skey === undefined) return\n\n    let { current, skip } = await this.core.lock(skey, async () => {\n      let current = await this.core.get(skey, params)\n\n      if (current?.optimistic)\n        return { current, skip: true }\n      if (current?.aborter)\n        current.aborter.abort(\"Replaced\")\n\n      current = await this.core.mutate(skey, current,\n        c => ({ time: c?.time, aborter, optimistic: true }),\n        params)\n      return { current }\n    })\n\n    if (skip)\n      return current\n\n    const {\n      cooldown: dcooldown = DEFAULT_COOLDOWN,\n      expiration: dexpiration = DEFAULT_EXPIRATION,\n      timeout: dtimeout = DEFAULT_TIMEOUT,\n    } = params\n\n    const timeout = setTimeout(() => {\n      aborter.abort(\"Update timed out\")\n    }, dtimeout)\n\n    try {\n      const { signal } = aborter\n\n      const generator = updater(current, { signal })\n\n      let result: Result<D, E, K> | void = undefined\n\n      while (true) {\n        const { done, value } = await generator.next()\n\n        if (done) {\n          result = value\n          break\n        }\n\n        const {\n          data,\n          error\n        } = value\n\n        if (signal.aborted)\n          throw new AbortError(signal)\n\n        const optimistic: State<D, E, K> = {}\n\n        if (data !== undefined)\n          optimistic.data = data\n        optimistic.error = error\n\n        current = await this.core.mutate(skey, current,\n          c => ({ time: c?.time, aborter, optimistic: true, ...optimistic }),\n          params)\n      }\n\n      if (result === undefined) {\n        if (fetcher === undefined)\n          throw new Error(\"Updater returned nothing and undefined fetcher\")\n        result = await fetcher(key, { signal, cache: \"reload\" })\n      }\n\n      const {\n        data,\n        error,\n        time = Date.now(),\n        cooldown = getTimeFromDelay(dcooldown),\n        expiration = getTimeFromDelay(dexpiration)\n      } = result\n\n      if (signal.aborted)\n        throw new AbortError(signal)\n\n      current = await this.core.get(skey, params)\n\n      if (error !== undefined) {\n        if (current?.aborter !== aborter)\n          return current\n        return await this.core.mutate(skey, current,\n          c => ({ time: c?.time, cooldown, expiration, aborter: undefined, optimistic: false, data: c?.data, error }),\n          params)\n      }\n\n      const state: State<D, E, K> = {}\n\n      if (data !== undefined)\n        state.data = data\n      state.error = error\n\n      return await this.core.mutate(skey, current,\n        () => ({ time, cooldown, expiration, aborter: undefined, optimistic: false, ...state }),\n        params)\n    } catch (error: any) {\n      current = await this.core.get(skey, params)\n\n      if (current?.aborter !== aborter)\n        return current\n      return await this.core.mutate(skey, current,\n        c => ({ time: c?.time, aborter: undefined, optimistic: false, data: c?.data, error }),\n        params)\n    } finally {\n      clearTimeout(timeout)\n    }\n  }\n}"],"names":[],"mappings":";;;;;AAUA,IAAA,YAAA,kBAAA,YAAA;AACE,IAAA,SAAA,YAAA,CAAqB,IAAU,EAAA;QAAV,IAAI,CAAA,IAAA,GAAJ,IAAI,CAAM;KAAK;AAEpC;;;;;;;;;AASG;AACG,IAAA,YAAA,CAAA,SAAA,CAAA,KAAK,GAAX,UACE,GAAkB,EAClB,IAAwB,EACxB,OAAyB,EACzB,OAA+B,EAC/B,MAA4B,EAC5B,KAAa,EACb,MAAc,EAAA;QAHd,IAAA,OAAA,KAAA,KAAA,CAAA,EAAA,EAAA,OAAc,GAAA,IAAA,eAAe,EAAE,CAAA,EAAA;AAC/B,QAAA,IAAA,MAAA,KAAA,KAAA,CAAA,EAAA,EAAA,MAA4B,GAAA,EAAA,CAAA,EAAA;AAC5B,QAAA,IAAA,KAAA,KAAA,KAAA,CAAA,EAAA,EAAA,KAAa,GAAA,KAAA,CAAA,EAAA;AACb,QAAA,IAAA,MAAA,KAAA,KAAA,CAAA,EAAA,EAAA,MAAc,GAAA,KAAA,CAAA,EAAA;;;;;;;wBAEd,IAAI,GAAG,KAAK,SAAS;4BAAE,OAAM,CAAA,CAAA,YAAA,CAAA;wBAC7B,IAAI,IAAI,KAAK,SAAS;4BAAE,OAAM,CAAA,CAAA,YAAA,CAAA;AAEN,wBAAA,OAAA,CAAA,CAAA,YAAM,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,YAAA,EAAA,OAAA,SAAA,CAAA,KAAA,EAAA,KAAA,CAAA,EAAA,KAAA,CAAA,EAAA,YAAA;;;;gDACnC,OAAM,CAAA,CAAA,YAAA,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE,MAAM,CAAC,CAAA,CAAA;;AAA3C,4CAAA,OAAO,GAAG,EAAiC,CAAA,IAAA,EAAA,CAAA;AAE/C,4CAAA,IAAI,OAAO,KAAP,IAAA,IAAA,OAAO,KAAP,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,OAAO,CAAE,UAAU;gDACrB,OAAO,CAAA,CAAA,aAAA,EAAE,OAAO,EAAA,OAAA,EAAE,IAAI,EAAE,IAAI,EAAE,CAAA,CAAA;4CAChC,IAAI,CAAA,OAAO,KAAA,IAAA,IAAP,OAAO,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAP,OAAO,CAAE,OAAO,KAAI,CAAC,KAAK;gDAC5B,OAAO,CAAA,CAAA,aAAA,EAAE,OAAO,EAAA,OAAA,EAAE,IAAI,EAAE,IAAI,EAAE,CAAA,CAAA;4CAChC,IAAI,CAAA,OAAO,KAAP,IAAA,IAAA,OAAO,uBAAP,OAAO,CAAE,OAAO,KAAI,KAAK;AAC3B,gDAAA,OAAO,CAAC,OAAO,CAAC,KAAK,CAAC,UAAU,CAAC,CAAA;4CAEnC,IAAI,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,IAAI,CAAC,MAAM;gDAC9C,OAAO,CAAA,CAAA,aAAA,EAAE,OAAO,EAAA,OAAA,EAAE,IAAI,EAAE,IAAI,EAAE,CAAA,CAAA;AAEtB,4CAAA,OAAA,CAAA,CAAA,YAAM,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,EAAE,OAAO,EAC5C,UAAA,CAAC,EAAI,EAAA,QAAC,EAAE,IAAI,EAAE,CAAC,aAAD,CAAC,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAD,CAAC,CAAE,IAAI,EAAE,OAAO,EAAA,OAAA,EAAE,EAA3B,EAA4B,EACjC,MAAM,CAAC,CAAA,CAAA;;4CAFT,OAAO,GAAG,SAED,CAAA;AACT,4CAAA,OAAA,CAAA,CAAA,aAAO,EAAE,OAAO,EAAA,OAAA,EAAE,CAAA,CAAA;;;AACnB,6BAAA,CAAA,CAAA,EAAA,CAAC,CAAA,CAAA;;AAjBE,wBAAA,EAAA,GAAoB,SAiBtB,EAjBI,OAAO,GAAA,EAAA,CAAA,OAAA,EAAE,IAAI,GAAA,EAAA,CAAA,IAAA,CAAA;AAmBnB,wBAAA,IAAI,IAAI;AACN,4BAAA,OAAA,CAAA,CAAA,aAAO,OAAO,CAAA,CAAA;wBAGd,EAGE,GAAA,MAAM,CAH8B,QAAA,EAA5B,SAAS,GAAA,EAAA,KAAA,KAAA,CAAA,GAAG,gBAAgB,GAAA,EAAA,EACtC,EAEE,GAAA,MAAM,CAFoC,UAAA,EAAhC,WAAW,GAAG,EAAA,KAAA,KAAA,CAAA,GAAA,kBAAkB,GAAA,EAAA,EAC5C,EACE,GAAA,MAAM,CAD2B,OAAA,EAA1B,QAAQ,GAAA,EAAA,KAAA,KAAA,CAAA,GAAG,eAAe,GAAA,EAAA,CAC3B;wBAEJ,OAAO,GAAG,UAAU,CAAC,YAAA;AACzB,4BAAA,OAAO,CAAC,KAAK,CAAC,iBAAiB,CAAC,CAAA;yBACjC,EAAE,QAAQ,CAAC,CAAA;;;;wBAGF,MAAM,GAAK,OAAO,CAAA,MAAZ,CAAY;wBAQtB,OAAM,CAAA,CAAA,YAAA,OAAO,CAAC,GAAG,EAAE,EAAE,MAAM,EAAA,MAAA,EAAE,CAAC,CAAA,CAAA;;AAN5B,wBAAA,EAAA,GAMF,EAA8B,CAAA,IAAA,EAAA,EALhC,IAAI,GAAA,EAAA,CAAA,IAAA,EACJ,KAAK,GAAA,EAAA,CAAA,KAAA,EACL,EAAA,GAAA,EAAA,CAAA,IAAiB,EAAjB,MAAA,GAAA,EAAA,KAAA,KAAA,CAAA,GAAO,IAAI,CAAC,GAAG,EAAE,GAAA,EAAA,EACjB,EAAA,GAAA,EAAA,CAAA,QAAsC,EAAtC,UAAA,GAAA,EAAA,KAAA,KAAA,CAAA,GAAW,gBAAgB,CAAC,SAAS,CAAC,GAAA,EAAA,EACtC,EAAA,GAAA,EAAA,CAAA,UAA0C,EAA1C,YAAa,GAAA,EAAA,KAAA,KAAA,CAAA,GAAA,gBAAgB,CAAC,WAAW,CAAC,GAAA,EAAA,CAAA;wBAG5C,IAAI,MAAM,CAAC,OAAO;AAChB,4BAAA,MAAM,IAAI,UAAU,CAAC,MAAM,CAAC,CAAA;wBAEpB,OAAM,CAAA,CAAA,YAAA,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE,MAAM,CAAC,CAAA,CAAA;;wBAA3C,OAAO,GAAG,SAAiC,CAAA;AAErC,wBAAA,OAAA,GAAwB,EAAE,CAAA;wBAEhC,IAAI,IAAI,KAAK,SAAS;AACpB,4BAAA,OAAK,CAAC,IAAI,GAAG,IAAI,CAAA;AACnB,wBAAA,OAAK,CAAC,KAAK,GAAG,KAAK,CAAA;AAEZ,wBAAA,OAAA,CAAA,CAAA,YAAM,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,EAAE,OAAO,EACzC,YAAA,EAAM,QAAA,QAAA,CAAA,EAAG,IAAI,EAAA,MAAA,EAAE,QAAQ,EAAA,UAAA,EAAE,UAAU,EAAA,YAAA,EAAE,OAAO,EAAE,SAAS,EAAK,EAAA,OAAK,GAA3D,EAA8D,EACpE,MAAM,CAAC,CAAA,CAAA;AAFT,oBAAA,KAAA,CAAA,EAAA,OAAA,CAAA,CAAA,aAAO,SAEE,CAAA,CAAA;;;wBAEC,OAAM,CAAA,CAAA,YAAA,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE,MAAM,CAAC,CAAA,CAAA;;wBAA3C,OAAO,GAAG,SAAiC,CAAA;wBAE3C,IAAI,CAAA,OAAO,KAAP,IAAA,IAAA,OAAO,uBAAP,OAAO,CAAE,OAAO,MAAK,OAAO;AAC9B,4BAAA,OAAA,CAAA,CAAA,aAAO,OAAO,CAAA,CAAA;wBACT,OAAM,CAAA,CAAA,YAAA,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,EAAE,OAAO,EACzC,YAAA,EAAM,QAAC,EAAE,OAAO,EAAE,SAAS,EAAE,KAAK,EAAA,OAAA,EAAE,EAAC,EAAA,EACrC,MAAM,CAAC,CAAA,CAAA;AAFT,oBAAA,KAAA,CAAA,EAAA,OAAA,CAAA,CAAA,aAAO,SAEE,CAAA,CAAA;;wBAET,YAAY,CAAC,OAAO,CAAC,CAAA;;;;;;AAExB,KAAA,CAAA;AAED;;;;;;;;;;AAUG;AACG,IAAA,YAAA,CAAA,SAAA,CAAA,MAAM,GAAZ,UACE,GAAkB,EAClB,IAAwB,EACxB,OAAqC,EACrC,OAAyB,EACzB,OAA+B,EAC/B,MAA4B,EAAA;QAD5B,IAAA,OAAA,KAAA,KAAA,CAAA,EAAA,EAAA,OAAc,GAAA,IAAA,eAAe,EAAE,CAAA,EAAA;AAC/B,QAAA,IAAA,MAAA,KAAA,KAAA,CAAA,EAAA,EAAA,MAA4B,GAAA,EAAA,CAAA,EAAA;;;;;;;wBAE5B,IAAI,GAAG,KAAK,SAAS;4BAAE,OAAM,CAAA,CAAA,YAAA,CAAA;wBAC7B,IAAI,IAAI,KAAK,SAAS;4BAAE,OAAM,CAAA,CAAA,YAAA,CAAA;AAEN,wBAAA,OAAA,CAAA,CAAA,YAAM,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,YAAA,EAAA,OAAA,SAAA,CAAA,KAAA,EAAA,KAAA,CAAA,EAAA,KAAA,CAAA,EAAA,YAAA;;;;gDACnC,OAAM,CAAA,CAAA,YAAA,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE,MAAM,CAAC,CAAA,CAAA;;AAA3C,4CAAA,OAAO,GAAG,EAAiC,CAAA,IAAA,EAAA,CAAA;AAE/C,4CAAA,IAAI,OAAO,KAAP,IAAA,IAAA,OAAO,KAAP,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,OAAO,CAAE,UAAU;gDACrB,OAAO,CAAA,CAAA,aAAA,EAAE,OAAO,EAAA,OAAA,EAAE,IAAI,EAAE,IAAI,EAAE,CAAA,CAAA;AAChC,4CAAA,IAAI,OAAO,KAAP,IAAA,IAAA,OAAO,KAAP,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,OAAO,CAAE,OAAO;AAClB,gDAAA,OAAO,CAAC,OAAO,CAAC,KAAK,CAAC,UAAU,CAAC,CAAA;AAEzB,4CAAA,OAAA,CAAA,CAAA,YAAM,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,EAAE,OAAO,EAC5C,UAAA,CAAC,EAAA,EAAI,QAAC,EAAE,IAAI,EAAE,CAAC,KAAD,IAAA,IAAA,CAAC,uBAAD,CAAC,CAAE,IAAI,EAAE,OAAO,SAAA,EAAE,UAAU,EAAE,IAAI,EAAE,EAAC,EAAA,EACnD,MAAM,CAAC,CAAA,CAAA;;4CAFT,OAAO,GAAG,SAED,CAAA;AACT,4CAAA,OAAA,CAAA,CAAA,aAAO,EAAE,OAAO,EAAA,OAAA,EAAE,CAAA,CAAA;;;AACnB,6BAAA,CAAA,CAAA,EAAA,CAAC,CAAA,CAAA;;AAZE,wBAAA,EAAA,GAAoB,SAYtB,EAZI,OAAO,GAAA,EAAA,CAAA,OAAA,EAAE,IAAI,GAAA,EAAA,CAAA,IAAA,CAAA;AAcnB,wBAAA,IAAI,IAAI;AACN,4BAAA,OAAA,CAAA,CAAA,aAAO,OAAO,CAAA,CAAA;wBAGd,EAGE,GAAA,MAAM,CAH8B,QAAA,EAA5B,SAAS,GAAA,EAAA,KAAA,KAAA,CAAA,GAAG,gBAAgB,GAAA,EAAA,EACtC,EAEE,GAAA,MAAM,CAFoC,UAAA,EAAhC,WAAW,GAAG,EAAA,KAAA,KAAA,CAAA,GAAA,kBAAkB,GAAA,EAAA,EAC5C,EACE,GAAA,MAAM,CAD2B,OAAA,EAA1B,QAAQ,GAAA,EAAA,KAAA,KAAA,CAAA,GAAG,eAAe,GAAA,EAAA,CAC3B;wBAEJ,OAAO,GAAG,UAAU,CAAC,YAAA;AACzB,4BAAA,OAAO,CAAC,KAAK,CAAC,kBAAkB,CAAC,CAAA;yBAClC,EAAE,QAAQ,CAAC,CAAA;;;;wBAGF,MAAM,GAAK,OAAO,CAAA,MAAZ,CAAY;wBAEpB,SAAS,GAAG,OAAO,CAAC,OAAO,EAAE,EAAE,MAAM,EAAA,MAAA,EAAE,CAAC,CAAA;wBAE1C,MAAM,GAA2B,SAAS,CAAA;;;;;AAGpB,oCAAA,KAAA,CAAA,EAAA,OAAA,CAAA,CAAA,YAAM,SAAS,CAAC,IAAI,EAAE,CAAA,CAAA;;AAAxC,wCAAA,EAAA,GAAkB,SAAsB,EAAtC,IAAI,GAAA,EAAA,CAAA,IAAA,EAAE,KAAK,GAAA,EAAA,CAAA,KAAA,CAAA;AAEnB,wCAAA,IAAI,IAAI,EAAE;4CACR,MAAM,GAAG,KAAK,CAAA;;AAEf,yCAAA;AAGC,wCAAA,MAAA,GAEE,KAAK,CAFH,IAAA,EACJ,OACE,GAAA,KAAK,MADF,CACE;wCAET,IAAI,MAAM,CAAC,OAAO;AAChB,4CAAA,MAAM,IAAI,UAAU,CAAC,MAAM,CAAC,CAAA;wCAExB,UAAU,GAAmB,EAAE,CAAA;wCAErC,IAAI,MAAI,KAAK,SAAS;AACpB,4CAAA,UAAU,CAAC,IAAI,GAAG,MAAI,CAAA;AACxB,wCAAA,UAAU,CAAC,KAAK,GAAG,OAAK,CAAA;AAEd,wCAAA,OAAA,CAAA,CAAA,YAAM,OAAK,IAAI,CAAC,MAAM,CAAC,IAAI,EAAE,OAAO,EAC5C,UAAA,CAAC,EAAI,EAAA,mBAAG,IAAI,EAAE,CAAC,KAAD,IAAA,IAAA,CAAC,KAAD,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,CAAC,CAAE,IAAI,EAAE,OAAO,EAAA,OAAA,EAAE,UAAU,EAAE,IAAI,EAAA,EAAK,UAAU,CAAG,EAAA,EAAA,EAClE,MAAM,CAAC,CAAA,CAAA;;wCAFT,OAAO,GAAG,SAED,CAAA;;;;;;;;;;;;;;;AAGP,wBAAA,IAAA,EAAA,MAAM,KAAK,SAAS,CAAA,EAApB,OAAoB,CAAA,CAAA,YAAA,CAAA,CAAA,CAAA;wBACtB,IAAI,OAAO,KAAK,SAAS;AACvB,4BAAA,MAAM,IAAI,KAAK,CAAC,gDAAgD,CAAC,CAAA;AAC1D,wBAAA,OAAA,CAAA,CAAA,YAAM,OAAO,CAAC,GAAG,EAAE,EAAE,MAAM,EAAA,MAAA,EAAE,KAAK,EAAE,QAAQ,EAAE,CAAC,CAAA,CAAA;;wBAAxD,MAAM,GAAG,SAA+C,CAAA;;;AAIxD,wBAAA,IAAI,GAKF,MAAM,CAAA,IALJ,EACJ,OAIE,GAAA,MAAM,MAJH,EACL,EAAA,GAGE,MAAM,CAAA,IAHS,EAAjB,MAAO,GAAA,EAAA,KAAA,KAAA,CAAA,GAAA,IAAI,CAAC,GAAG,EAAE,KAAA,EACjB,EAAA,GAEE,MAAM,CAAA,QAF8B,EAAtC,UAAW,GAAA,EAAA,KAAA,KAAA,CAAA,GAAA,gBAAgB,CAAC,SAAS,CAAC,KAAA,EACtC,EAAA,GACE,MAAM,CAAA,UADkC,EAA1C,YAAa,GAAA,EAAA,KAAA,KAAA,CAAA,GAAA,gBAAgB,CAAC,WAAW,CAAC,KAAA,CAClC;wBAEV,IAAI,MAAM,CAAC,OAAO;AAChB,4BAAA,MAAM,IAAI,UAAU,CAAC,MAAM,CAAC,CAAA;wBAEpB,OAAM,CAAA,CAAA,YAAA,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE,MAAM,CAAC,CAAA,CAAA;;wBAA3C,OAAO,GAAG,SAAiC,CAAA;AAEvC,wBAAA,IAAA,EAAA,OAAK,KAAK,SAAS,CAAA,EAAnB,OAAmB,CAAA,CAAA,YAAA,EAAA,CAAA,CAAA;wBACrB,IAAI,CAAA,OAAO,KAAP,IAAA,IAAA,OAAO,uBAAP,OAAO,CAAE,OAAO,MAAK,OAAO;AAC9B,4BAAA,OAAA,CAAA,CAAA,aAAO,OAAO,CAAA,CAAA;wBACT,OAAM,CAAA,CAAA,YAAA,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,EAAE,OAAO,EACzC,UAAA,CAAC,EAAA,EAAI,QAAC,EAAE,IAAI,EAAE,CAAC,KAAD,IAAA,IAAA,CAAC,KAAD,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,CAAC,CAAE,IAAI,EAAE,QAAQ,EAAA,UAAA,EAAE,UAAU,EAAA,YAAA,EAAE,OAAO,EAAE,SAAS,EAAE,UAAU,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC,KAAD,IAAA,IAAA,CAAC,KAAD,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,CAAC,CAAE,IAAI,EAAE,KAAK,EAAA,OAAA,EAAE,EAAC,EAAA,EAC3G,MAAM,CAAC,CAAA,CAAA;AAFT,oBAAA,KAAA,CAAA,EAAA,OAAA,CAAA,CAAA,aAAO,SAEE,CAAA,CAAA;;AAGL,wBAAA,OAAA,GAAwB,EAAE,CAAA;wBAEhC,IAAI,IAAI,KAAK,SAAS;AACpB,4BAAA,OAAK,CAAC,IAAI,GAAG,IAAI,CAAA;AACnB,wBAAA,OAAK,CAAC,KAAK,GAAG,OAAK,CAAA;AAEZ,wBAAA,OAAA,CAAA,CAAA,YAAM,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,EAAE,OAAO,EACzC,cAAM,QAAA,QAAA,CAAA,EAAG,IAAI,EAAA,MAAA,EAAE,QAAQ,EAAA,UAAA,EAAE,UAAU,cAAA,EAAE,OAAO,EAAE,SAAS,EAAE,UAAU,EAAE,KAAK,EAAA,EAAK,OAAK,CAAG,EAAA,EAAA,EACvF,MAAM,CAAC,CAAA,CAAA;AAFT,oBAAA,KAAA,EAAA,EAAA,OAAA,CAAA,CAAA,aAAO,SAEE,CAAA,CAAA;;;wBAEC,OAAM,CAAA,CAAA,YAAA,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE,MAAM,CAAC,CAAA,CAAA;;wBAA3C,OAAO,GAAG,SAAiC,CAAA;wBAE3C,IAAI,CAAA,OAAO,KAAP,IAAA,IAAA,OAAO,uBAAP,OAAO,CAAE,OAAO,MAAK,OAAO;AAC9B,4BAAA,OAAA,CAAA,CAAA,aAAO,OAAO,CAAA,CAAA;wBACT,OAAM,CAAA,CAAA,YAAA,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,EAAE,OAAO,EACzC,UAAA,CAAC,IAAI,QAAC,EAAE,IAAI,EAAE,CAAC,aAAD,CAAC,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAD,CAAC,CAAE,IAAI,EAAE,OAAO,EAAE,SAAS,EAAE,UAAU,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC,KAAA,IAAA,IAAD,CAAC,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAD,CAAC,CAAE,IAAI,EAAE,KAAK,EAAA,OAAA,EAAE,EAAC,EAAA,EACrF,MAAM,CAAC,CAAA,CAAA;AAFT,oBAAA,KAAA,EAAA,EAAA,OAAA,CAAA,CAAA,aAAO,SAEE,CAAA,CAAA;;wBAET,YAAY,CAAC,OAAO,CAAC,CAAA;;;;;;AAExB,KAAA,CAAA;IACH,OAAC,YAAA,CAAA;AAAD,CAAC,EAAA;;;;"}