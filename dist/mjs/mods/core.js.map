{"version":3,"file":"core.js","sources":["../../../src/mods/core.ts"],"sourcesContent":["import { Ortho } from \"libs/ortho.js\"\nimport { ScrollHelper } from \"mods/scroll/helper.js\"\nimport { SingleHelper } from \"mods/single/helper.js\"\nimport { Mutator } from \"mods/types/mutator.js\"\nimport { Params } from \"mods/types/params.js\"\nimport { State } from \"mods/types/state.js\"\nimport { isAsyncStorage } from \"mods/types/storage.js\"\nimport { DEFAULT_EQUALS } from \"mods/utils/defaults.js\"\nimport { shallowEquals } from \"mods/utils/equals.js\"\nimport { Lock } from \"mods/utils/lock.js\"\n\nexport type Listener<D = any, E = any, K = any> =\n  (x?: State<D, E, K>) => void\n\nexport class Core extends Ortho<string, State | undefined> {\n  readonly single = new SingleHelper(this)\n  readonly scroll = new ScrollHelper(this)\n\n  readonly cache = new Map<string, State>()\n  readonly locks = new Map<string, Lock>()\n\n  private _mounted = true\n\n  constructor(\n    readonly params: Params\n  ) { super() }\n\n  get mounted() { return this._mounted }\n\n  unmount() {\n    for (const timeout of this.timeouts.values())\n      clearTimeout(timeout)\n    this._mounted = false\n  }\n\n  async lock<T>(skey: string, callback: () => Promise<T>) {\n    const lock = this.locks.get(skey)\n\n    if (lock !== undefined)\n      return await lock.lock(callback)\n\n    const lock2 = new Lock()\n    this.locks.set(skey, lock2)\n    return await lock2.lock(callback)\n  }\n\n  getSync<D = any, E = any, K = any>(\n    skey: string | undefined,\n    params: Params<D, E, K> = {}\n  ): State<D, E, K> | undefined | null {\n    if (skey === undefined) return\n\n    const cached = this.cache.get(skey)\n    if (cached !== undefined) return cached\n\n    const { storage } = params\n    if (!storage) return\n\n    if (isAsyncStorage(storage))\n      return null\n    const state = storage.get(skey)\n    this.cache.set(skey, state)\n    return state\n  }\n\n  async get<D = any, E = any, K = any>(\n    skey: string | undefined,\n    params: Params<D, E, K> = {},\n    ignore = false\n  ): Promise<State<D, E, K> | undefined> {\n    if (skey === undefined) return\n\n    const cached = this.cache.get(skey)\n    if (cached !== undefined) return cached\n\n    const { storage } = params\n    if (!storage) return\n\n    const state = await storage.get(skey, ignore)\n    this.cache.set(skey, state)\n    return state\n  }\n\n  /**\n   * Force set a key to a state and publish it\n   * No check, no merge\n   * @param skey Key\n   * @param state New state\n   * @returns \n   */\n  async set<D = any, E = any, K = any>(\n    skey: string | undefined,\n    state: State<D, E, K>,\n    params: Params<D, E, K> = {}\n  ) {\n    if (skey === undefined) return\n\n    this.cache.set(skey, state)\n    this.publish(skey, state)\n\n    const { storage } = params\n    if (!storage) return\n    const { data, time, cooldown, expiration } = state\n    await storage.set(skey, { data, time, cooldown, expiration })\n  }\n\n  /**\n   * Delete key and publish undefined\n   * @param skey \n   * @returns \n   */\n  async delete<D = any, E = any, K = any>(\n    skey: string | undefined,\n    params: Params<D, E, K> = {}\n  ) {\n    if (!skey) return\n\n    this.cache.delete(skey)\n    this.locks.delete(skey)\n    this.publish(skey, undefined)\n\n    const { storage } = params\n    if (!storage) return\n    await storage.delete(skey)\n  }\n\n  async mutate<D = any, E = any, K = any>(\n    skey: string | undefined,\n    current: State<D, E, K> | undefined,\n    mutator: Mutator<D, E, K>,\n    params: Params<D, E, K> = {}\n  ): Promise<State<D, E, K> | undefined> {\n    if (skey === undefined) return\n    const state = mutator(current)\n\n    if (!state) {\n      await this.delete(skey, params)\n      return\n    }\n\n    if (state.time !== undefined && state.time < (current?.time ?? 0))\n      return current\n\n    if (state.optimistic === undefined && current?.optimistic)\n      return current\n\n    const {\n      equals = DEFAULT_EQUALS\n    } = params\n\n    const next: State<D, E, K> = {\n      ...current,\n      ...state\n    }\n\n    next.data = await this.normalize(false, next, params)\n\n    if (next.time === undefined)\n      next.time = Date.now()\n    if (equals(next.data, current?.data))\n      next.data = current?.data\n    if (!next.optimistic)\n      next.realData = next.data\n\n    if (shallowEquals(next, current))\n      return current\n    await this.set(skey, next, params)\n    return next as State<D, E, K>\n  }\n\n  async normalize<D = any, E = any, K = any>(\n    shallow: boolean,\n    root: State<D, E, K>,\n    params: Params<D, E, K> = {},\n  ) {\n    if (root.data === undefined) return\n    if (params.normalizer === undefined) return root.data\n    return await params.normalizer(root.data, { core: this, shallow, root })\n  }\n\n  /**\n   * True if we should cooldown this resource\n   */\n  shouldCooldown<D = any, E = any, K = any>(\n    current?: State<D, E, K>\n  ) {\n    if (current?.cooldown === undefined)\n      return false\n    return Date.now() < current.cooldown\n  }\n\n  counts = new Map<string, number>()\n  timeouts = new Map<string, NodeJS.Timeout>()\n\n  once<D = any, E = any, K = any>(\n    key: string | undefined,\n    listener: Listener<D, E, K>,\n    params: Params<D, E, K> = {}\n  ) {\n    if (!key) return\n\n    const f: Listener<D, E, K> = (x) => {\n      this.off(key, f, params)\n      listener(x)\n    }\n\n    this.on(key, f, params)\n  }\n\n  on<D = any, E = any, K = any>(\n    key: string | undefined,\n    listener: Listener<D, E, K>,\n    params: Params<D, E, K> = {}\n  ) {\n    if (!key) return\n\n    super.on(key, listener)\n\n    const count = this.counts.get(key) ?? 0\n    this.counts.set(key, count + 1)\n\n    const timeout = this.timeouts.get(key)\n    if (timeout === undefined) return\n\n    clearTimeout(timeout)\n    this.timeouts.delete(key)\n  }\n\n  async off<D = any, E = any, K = any>(\n    key: string | undefined,\n    listener: Listener<D, E, K>,\n    params: Params<D, E, K> = {}\n  ) {\n    if (!key) return\n\n    super.off(key, listener)\n\n    const count = this.counts.get(key)\n\n    if (count === undefined)\n      throw new Error(\"Undefined count\")\n\n    if (count > 1) {\n      this.counts.set(key, count - 1)\n      return\n    }\n\n    this.counts.delete(key)\n\n    const current = await this.get(key, params, true)\n    if (current?.expiration === undefined) return\n    if (current?.expiration === -1) return\n\n    const erase = async () => {\n      if (!this._mounted) return\n\n      const count = this.counts.get(key)\n      if (count !== undefined) return\n\n      this.timeouts.delete(key)\n      await this.delete(key, params)\n    }\n\n    if (Date.now() > current.expiration) {\n      await erase()\n      return\n    }\n\n    const delay = current.expiration - Date.now()\n    const timeout = setTimeout(erase, delay)\n    this.timeouts.set(key, timeout)\n  }\n}"],"names":[],"mappings":";;;;;;;;;AAcA,IAAA,IAAA,kBAAA,UAAA,MAAA,EAAA;IAA0B,SAAgC,CAAA,IAAA,EAAA,MAAA,CAAA,CAAA;AASxD,IAAA,SAAA,IAAA,CACW,MAAc,EAAA;AADzB,QAAA,IAAA,KAAA,GAEI,iBAAO,IAAE,IAAA,CAAA;QADF,KAAM,CAAA,MAAA,GAAN,MAAM,CAAQ;AAThB,QAAA,KAAA,CAAA,MAAM,GAAG,IAAI,YAAY,CAAC,KAAI,CAAC,CAAA;AAC/B,QAAA,KAAA,CAAA,MAAM,GAAG,IAAI,YAAY,CAAC,KAAI,CAAC,CAAA;AAE/B,QAAA,KAAA,CAAA,KAAK,GAAG,IAAI,GAAG,EAAiB,CAAA;AAChC,QAAA,KAAA,CAAA,KAAK,GAAG,IAAI,GAAG,EAAgB,CAAA;QAEhC,KAAQ,CAAA,QAAA,GAAG,IAAI,CAAA;AA0KvB,QAAA,KAAA,CAAA,MAAM,GAAG,IAAI,GAAG,EAAkB,CAAA;AAClC,QAAA,KAAA,CAAA,QAAQ,GAAG,IAAI,GAAG,EAA0B,CAAA;;KAvK/B;AAEb,IAAA,MAAA,CAAA,cAAA,CAAI,IAAO,CAAA,SAAA,EAAA,SAAA,EAAA;AAAX,QAAA,GAAA,EAAA,YAAA,EAAgB,OAAO,IAAI,CAAC,QAAQ,CAAA,EAAE;;;AAAA,KAAA,CAAA,CAAA;AAEtC,IAAA,IAAA,CAAA,SAAA,CAAA,OAAO,GAAP,YAAA;;;YACE,KAAsB,IAAA,EAAA,GAAA,QAAA,CAAA,IAAI,CAAC,QAAQ,CAAC,MAAM,EAAE,CAAA,EAAA,EAAA,GAAA,EAAA,CAAA,IAAA,EAAA,EAAA,CAAA,EAAA,CAAA,IAAA,EAAA,EAAA,GAAA,EAAA,CAAA,IAAA,EAAA,EAAA;AAAvC,gBAAA,IAAM,OAAO,GAAA,EAAA,CAAA,KAAA,CAAA;gBAChB,YAAY,CAAC,OAAO,CAAC,CAAA;AAAA,aAAA;;;;;;;;;AACvB,QAAA,IAAI,CAAC,QAAQ,GAAG,KAAK,CAAA;KACtB,CAAA;AAEK,IAAA,IAAA,CAAA,SAAA,CAAA,IAAI,GAAV,UAAc,IAAY,EAAE,QAA0B,EAAA;;;;;;wBAC9C,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,CAAA;AAE7B,wBAAA,IAAA,EAAA,IAAI,KAAK,SAAS,CAAA,EAAlB,OAAkB,CAAA,CAAA,YAAA,CAAA,CAAA,CAAA;AACb,wBAAA,OAAA,CAAA,CAAA,YAAM,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAA,CAAA;AAAhC,oBAAA,KAAA,CAAA,EAAA,OAAA,CAAA,CAAA,aAAO,SAAyB,CAAA,CAAA;;AAE5B,wBAAA,KAAK,GAAG,IAAI,IAAI,EAAE,CAAA;wBACxB,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI,EAAE,KAAK,CAAC,CAAA;AACpB,wBAAA,OAAA,CAAA,CAAA,YAAM,KAAK,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAA,CAAA;AAAjC,oBAAA,KAAA,CAAA,EAAA,OAAA,CAAA,CAAA,aAAO,SAA0B,CAAA,CAAA;;;;AAClC,KAAA,CAAA;AAED,IAAA,IAAA,CAAA,SAAA,CAAA,OAAO,GAAP,UACE,IAAwB,EACxB,MAA4B,EAAA;AAA5B,QAAA,IAAA,MAAA,KAAA,KAAA,CAAA,EAAA,EAAA,MAA4B,GAAA,EAAA,CAAA,EAAA;QAE5B,IAAI,IAAI,KAAK,SAAS;YAAE,OAAM;QAE9B,IAAM,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,CAAA;QACnC,IAAI,MAAM,KAAK,SAAS;AAAE,YAAA,OAAO,MAAM,CAAA;AAE/B,QAAA,IAAA,OAAO,GAAK,MAAM,CAAA,OAAX,CAAW;AAC1B,QAAA,IAAI,CAAC,OAAO;YAAE,OAAM;QAEpB,IAAI,cAAc,CAAC,OAAO,CAAC;AACzB,YAAA,OAAO,IAAI,CAAA;QACb,IAAM,KAAK,GAAG,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,CAAA;QAC/B,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI,EAAE,KAAK,CAAC,CAAA;AAC3B,QAAA,OAAO,KAAK,CAAA;KACb,CAAA;AAEK,IAAA,IAAA,CAAA,SAAA,CAAA,GAAG,GAAT,UACE,IAAwB,EACxB,MAA4B,EAC5B,MAAc,EAAA;AADd,QAAA,IAAA,MAAA,KAAA,KAAA,CAAA,EAAA,EAAA,MAA4B,GAAA,EAAA,CAAA,EAAA;AAC5B,QAAA,IAAA,MAAA,KAAA,KAAA,CAAA,EAAA,EAAA,MAAc,GAAA,KAAA,CAAA,EAAA;;;;;;wBAEd,IAAI,IAAI,KAAK,SAAS;4BAAE,OAAM,CAAA,CAAA,YAAA,CAAA;wBAExB,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,CAAA;wBACnC,IAAI,MAAM,KAAK,SAAS;AAAE,4BAAA,OAAA,CAAA,CAAA,aAAO,MAAM,CAAA,CAAA;wBAE/B,OAAO,GAAK,MAAM,CAAA,OAAX,CAAW;AAC1B,wBAAA,IAAI,CAAC,OAAO;4BAAE,OAAM,CAAA,CAAA,YAAA,CAAA;wBAEN,OAAM,CAAA,CAAA,YAAA,OAAO,CAAC,GAAG,CAAC,IAAI,EAAE,MAAM,CAAC,CAAA,CAAA;;AAAvC,wBAAA,KAAK,GAAG,EAA+B,CAAA,IAAA,EAAA,CAAA;wBAC7C,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI,EAAE,KAAK,CAAC,CAAA;AAC3B,wBAAA,OAAA,CAAA,CAAA,aAAO,KAAK,CAAA,CAAA;;;;AACb,KAAA,CAAA;AAED;;;;;;AAMG;AACG,IAAA,IAAA,CAAA,SAAA,CAAA,GAAG,GAAT,UACE,IAAwB,EACxB,KAAqB,EACrB,MAA4B,EAAA;AAA5B,QAAA,IAAA,MAAA,KAAA,KAAA,CAAA,EAAA,EAAA,MAA4B,GAAA,EAAA,CAAA,EAAA;;;;;;wBAE5B,IAAI,IAAI,KAAK,SAAS;4BAAE,OAAM,CAAA,CAAA,YAAA,CAAA;wBAE9B,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI,EAAE,KAAK,CAAC,CAAA;AAC3B,wBAAA,IAAI,CAAC,OAAO,CAAC,IAAI,EAAE,KAAK,CAAC,CAAA;wBAEjB,OAAO,GAAK,MAAM,CAAA,OAAX,CAAW;AAC1B,wBAAA,IAAI,CAAC,OAAO;4BAAE,OAAM,CAAA,CAAA,YAAA,CAAA;AACZ,wBAAA,IAAI,GAAiC,KAAK,CAAA,IAAtC,EAAE,IAAI,GAA2B,KAAK,CAAhC,IAAA,EAAE,QAAQ,GAAiB,KAAK,CAAtB,QAAA,EAAE,UAAU,GAAK,KAAK,WAAV,CAAU;wBAClD,OAAM,CAAA,CAAA,YAAA,OAAO,CAAC,GAAG,CAAC,IAAI,EAAE,EAAE,IAAI,EAAA,IAAA,EAAE,IAAI,EAAA,IAAA,EAAE,QAAQ,EAAA,QAAA,EAAE,UAAU,EAAA,UAAA,EAAE,CAAC,CAAA,CAAA;;AAA7D,wBAAA,EAAA,CAAA,IAAA,EAA6D,CAAA;;;;;AAC9D,KAAA,CAAA;AAED;;;;AAIG;AACG,IAAA,IAAA,CAAA,SAAA,CAAA,MAAM,GAAZ,UACE,IAAwB,EACxB,MAA4B,EAAA;AAA5B,QAAA,IAAA,MAAA,KAAA,KAAA,CAAA,EAAA,EAAA,MAA4B,GAAA,EAAA,CAAA,EAAA;;;;;;AAE5B,wBAAA,IAAI,CAAC,IAAI;4BAAE,OAAM,CAAA,CAAA,YAAA,CAAA;AAEjB,wBAAA,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,CAAA;AACvB,wBAAA,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,CAAA;AACvB,wBAAA,IAAI,CAAC,OAAO,CAAC,IAAI,EAAE,SAAS,CAAC,CAAA;wBAErB,OAAO,GAAK,MAAM,CAAA,OAAX,CAAW;AAC1B,wBAAA,IAAI,CAAC,OAAO;4BAAE,OAAM,CAAA,CAAA,YAAA,CAAA;AACpB,wBAAA,OAAA,CAAA,CAAA,YAAM,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,CAAA,CAAA;;AAA1B,wBAAA,EAAA,CAAA,IAAA,EAA0B,CAAA;;;;;AAC3B,KAAA,CAAA;IAEK,IAAM,CAAA,SAAA,CAAA,MAAA,GAAZ,UACE,IAAwB,EACxB,OAAmC,EACnC,OAAyB,EACzB,MAA4B,EAAA;;AAA5B,QAAA,IAAA,MAAA,KAAA,KAAA,CAAA,EAAA,EAAA,MAA4B,GAAA,EAAA,CAAA,EAAA;;;;;;wBAE5B,IAAI,IAAI,KAAK,SAAS;4BAAE,OAAM,CAAA,CAAA,YAAA,CAAA;AACxB,wBAAA,KAAK,GAAG,OAAO,CAAC,OAAO,CAAC,CAAA;6BAE1B,CAAC,KAAK,EAAN,OAAM,CAAA,CAAA,YAAA,CAAA,CAAA,CAAA;wBACR,OAAM,CAAA,CAAA,YAAA,IAAI,CAAC,MAAM,CAAC,IAAI,EAAE,MAAM,CAAC,CAAA,CAAA;;AAA/B,wBAAA,EAAA,CAAA,IAAA,EAA+B,CAAA;wBAC/B,OAAM,CAAA,CAAA,YAAA,CAAA;;wBAGR,IAAI,KAAK,CAAC,IAAI,KAAK,SAAS,IAAI,KAAK,CAAC,IAAI,IAAI,CAAA,EAAA,GAAA,OAAO,aAAP,OAAO,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAP,OAAO,CAAE,IAAI,MAAI,IAAA,IAAA,EAAA,KAAA,KAAA,CAAA,GAAA,EAAA,GAAA,CAAC,CAAC;AAC/D,4BAAA,OAAA,CAAA,CAAA,aAAO,OAAO,CAAA,CAAA;AAEhB,wBAAA,IAAI,KAAK,CAAC,UAAU,KAAK,SAAS,KAAI,OAAO,KAAA,IAAA,IAAP,OAAO,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAP,OAAO,CAAE,UAAU,CAAA;AACvD,4BAAA,OAAA,CAAA,CAAA,aAAO,OAAO,CAAA,CAAA;AAGd,wBAAA,EAAA,GACE,MAAM,CADe,MAAA,EAAvB,MAAM,GAAG,EAAA,KAAA,KAAA,CAAA,GAAA,cAAc,KAAA,CACf;AAEJ,wBAAA,IAAI,GACL,QAAA,CAAA,QAAA,CAAA,EAAA,EAAA,OAAO,CACP,EAAA,KAAK,CACT,CAAA;AAED,wBAAA,EAAA,GAAA,IAAI,CAAA;wBAAQ,OAAM,CAAA,CAAA,YAAA,IAAI,CAAC,SAAS,CAAC,KAAK,EAAE,IAAI,EAAE,MAAM,CAAC,CAAA,CAAA;;wBAArD,EAAK,CAAA,IAAI,GAAG,EAAA,CAAA,IAAA,EAAyC,CAAA;AAErD,wBAAA,IAAI,IAAI,CAAC,IAAI,KAAK,SAAS;AACzB,4BAAA,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,GAAG,EAAE,CAAA;AACxB,wBAAA,IAAI,MAAM,CAAC,IAAI,CAAC,IAAI,EAAE,OAAO,KAAA,IAAA,IAAP,OAAO,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAP,OAAO,CAAE,IAAI,CAAC;4BAClC,IAAI,CAAC,IAAI,GAAG,OAAO,KAAA,IAAA,IAAP,OAAO,KAAP,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,OAAO,CAAE,IAAI,CAAA;wBAC3B,IAAI,CAAC,IAAI,CAAC,UAAU;AAClB,4BAAA,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,IAAI,CAAA;AAE3B,wBAAA,IAAI,aAAa,CAAC,IAAI,EAAE,OAAO,CAAC;AAC9B,4BAAA,OAAA,CAAA,CAAA,aAAO,OAAO,CAAA,CAAA;wBAChB,OAAM,CAAA,CAAA,YAAA,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE,IAAI,EAAE,MAAM,CAAC,CAAA,CAAA;;AAAlC,wBAAA,EAAA,CAAA,IAAA,EAAkC,CAAA;AAClC,wBAAA,OAAA,CAAA,CAAA,aAAO,IAAsB,CAAA,CAAA;;;;AAC9B,KAAA,CAAA;AAEK,IAAA,IAAA,CAAA,SAAA,CAAA,SAAS,GAAf,UACE,OAAgB,EAChB,IAAoB,EACpB,MAA4B,EAAA;AAA5B,QAAA,IAAA,MAAA,KAAA,KAAA,CAAA,EAAA,EAAA,MAA4B,GAAA,EAAA,CAAA,EAAA;;;;;AAE5B,wBAAA,IAAI,IAAI,CAAC,IAAI,KAAK,SAAS;4BAAE,OAAM,CAAA,CAAA,YAAA,CAAA;AACnC,wBAAA,IAAI,MAAM,CAAC,UAAU,KAAK,SAAS;4BAAE,OAAO,CAAA,CAAA,aAAA,IAAI,CAAC,IAAI,CAAA,CAAA;wBAC9C,OAAM,CAAA,CAAA,YAAA,MAAM,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,EAAE,EAAE,IAAI,EAAE,IAAI,EAAE,OAAO,EAAA,OAAA,EAAE,IAAI,EAAA,IAAA,EAAE,CAAC,CAAA,CAAA;AAAxE,oBAAA,KAAA,CAAA,EAAA,OAAA,CAAA,CAAA,aAAO,SAAiE,CAAA,CAAA;;;;AACzE,KAAA,CAAA;AAED;;AAEG;IACH,IAAc,CAAA,SAAA,CAAA,cAAA,GAAd,UACE,OAAwB,EAAA;QAExB,IAAI,CAAA,OAAO,KAAP,IAAA,IAAA,OAAO,uBAAP,OAAO,CAAE,QAAQ,MAAK,SAAS;AACjC,YAAA,OAAO,KAAK,CAAA;QACd,OAAO,IAAI,CAAC,GAAG,EAAE,GAAG,OAAO,CAAC,QAAQ,CAAA;KACrC,CAAA;AAKD,IAAA,IAAA,CAAA,SAAA,CAAA,IAAI,GAAJ,UACE,GAAuB,EACvB,QAA2B,EAC3B,MAA4B,EAAA;QAH9B,IAaC,KAAA,GAAA,IAAA,CAAA;AAVC,QAAA,IAAA,MAAA,KAAA,KAAA,CAAA,EAAA,EAAA,MAA4B,GAAA,EAAA,CAAA,EAAA;AAE5B,QAAA,IAAI,CAAC,GAAG;YAAE,OAAM;QAEhB,IAAM,CAAC,GAAsB,UAAC,CAAC,EAAA;YAC7B,KAAI,CAAC,GAAG,CAAC,GAAG,EAAE,CAAC,EAAE,MAAM,CAAC,CAAA;YACxB,QAAQ,CAAC,CAAC,CAAC,CAAA;AACb,SAAC,CAAA;QAED,IAAI,CAAC,EAAE,CAAC,GAAG,EAAE,CAAC,EAAE,MAAM,CAAC,CAAA;KACxB,CAAA;AAED,IAAA,IAAA,CAAA,SAAA,CAAA,EAAE,GAAF,UACE,GAAuB,EACvB,QAA2B,EAC3B,MAA4B,EAAA;;AAE5B,QAAA,IAAI,CAAC,GAAG;YAAE,OAAM;AAEhB,QAAA,MAAA,CAAA,SAAA,CAAM,EAAE,CAAC,IAAA,CAAA,IAAA,EAAA,GAAG,EAAE,QAAQ,CAAC,CAAA;AAEvB,QAAA,IAAM,KAAK,GAAG,CAAA,EAAA,GAAA,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,GAAG,CAAC,MAAA,IAAA,IAAA,EAAA,KAAA,KAAA,CAAA,GAAA,EAAA,GAAI,CAAC,CAAA;QACvC,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,GAAG,EAAE,KAAK,GAAG,CAAC,CAAC,CAAA;QAE/B,IAAM,OAAO,GAAG,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,GAAG,CAAC,CAAA;QACtC,IAAI,OAAO,KAAK,SAAS;YAAE,OAAM;QAEjC,YAAY,CAAC,OAAO,CAAC,CAAA;AACrB,QAAA,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,GAAG,CAAC,CAAA;KAC1B,CAAA;AAEK,IAAA,IAAA,CAAA,SAAA,CAAA,GAAG,GAAT,UACE,GAAuB,EACvB,QAA2B,EAC3B,MAA4B,EAAA;AAA5B,QAAA,IAAA,MAAA,KAAA,KAAA,CAAA,EAAA,EAAA,MAA4B,GAAA,EAAA,CAAA,EAAA;;;;;;;AAE5B,wBAAA,IAAI,CAAC,GAAG;4BAAE,OAAM,CAAA,CAAA,YAAA,CAAA;AAEhB,wBAAA,MAAA,CAAA,SAAA,CAAM,GAAG,CAAC,IAAA,CAAA,IAAA,EAAA,GAAG,EAAE,QAAQ,CAAC,CAAA;wBAElB,KAAK,GAAG,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,GAAG,CAAC,CAAA;wBAElC,IAAI,KAAK,KAAK,SAAS;AACrB,4BAAA,MAAM,IAAI,KAAK,CAAC,iBAAiB,CAAC,CAAA;wBAEpC,IAAI,KAAK,GAAG,CAAC,EAAE;4BACb,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,GAAG,EAAE,KAAK,GAAG,CAAC,CAAC,CAAA;4BAC/B,OAAM,CAAA,CAAA,YAAA,CAAA;AACP,yBAAA;AAED,wBAAA,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,GAAG,CAAC,CAAA;wBAEP,OAAM,CAAA,CAAA,YAAA,IAAI,CAAC,GAAG,CAAC,GAAG,EAAE,MAAM,EAAE,IAAI,CAAC,CAAA,CAAA;;AAA3C,wBAAA,OAAO,GAAG,EAAiC,CAAA,IAAA,EAAA,CAAA;wBACjD,IAAI,CAAA,OAAO,KAAP,IAAA,IAAA,OAAO,uBAAP,OAAO,CAAE,UAAU,MAAK,SAAS;4BAAE,OAAM,CAAA,CAAA,YAAA,CAAA;wBAC7C,IAAI,CAAA,OAAO,KAAA,IAAA,IAAP,OAAO,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAP,OAAO,CAAE,UAAU,MAAK,CAAC,CAAC;4BAAE,OAAM,CAAA,CAAA,YAAA,CAAA;AAEhC,wBAAA,KAAK,GAAG,YAAA,EAAA,OAAA,SAAA,CAAA,KAAA,EAAA,KAAA,CAAA,EAAA,KAAA,CAAA,EAAA,YAAA;;;;;wCACZ,IAAI,CAAC,IAAI,CAAC,QAAQ;4CAAE,OAAM,CAAA,CAAA,YAAA,CAAA;wCAEpB,KAAK,GAAG,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,GAAG,CAAC,CAAA;wCAClC,IAAI,KAAK,KAAK,SAAS;4CAAE,OAAM,CAAA,CAAA,YAAA,CAAA;AAE/B,wCAAA,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,GAAG,CAAC,CAAA;wCACzB,OAAM,CAAA,CAAA,YAAA,IAAI,CAAC,MAAM,CAAC,GAAG,EAAE,MAAM,CAAC,CAAA,CAAA;;AAA9B,wCAAA,EAAA,CAAA,IAAA,EAA8B,CAAA;;;;6BAC/B,CAAA;8BAEG,IAAI,CAAC,GAAG,EAAE,GAAG,OAAO,CAAC,UAAU,CAAA,EAA/B,OAA+B,CAAA,CAAA,YAAA,CAAA,CAAA,CAAA;wBACjC,OAAM,CAAA,CAAA,YAAA,KAAK,EAAE,CAAA,CAAA;;AAAb,wBAAA,EAAA,CAAA,IAAA,EAAa,CAAA;wBACb,OAAM,CAAA,CAAA,YAAA,CAAA;;wBAGF,KAAK,GAAG,OAAO,CAAC,UAAU,GAAG,IAAI,CAAC,GAAG,EAAE,CAAA;AACvC,wBAAA,OAAO,GAAG,UAAU,CAAC,KAAK,EAAE,KAAK,CAAC,CAAA;wBACxC,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,GAAG,EAAE,OAAO,CAAC,CAAA;;;;;AAChC,KAAA,CAAA;IACH,OAAC,IAAA,CAAA;AAAD,CAlQA,CAA0B,KAAK,CAkQ9B;;;;"}