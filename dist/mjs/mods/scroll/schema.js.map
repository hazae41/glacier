{"version":3,"file":"schema.js","sources":["../../../../src/mods/scroll/schema.ts"],"sourcesContent":["import { Core } from \"mods/core.js\";\nimport { Fetcher } from \"mods/types/fetcher.js\";\nimport { NormalizerMore } from \"mods/types/normalizer.js\";\nimport { Params } from \"mods/types/params.js\";\nimport { Schema } from \"mods/types/schema.js\";\nimport { Scroller } from \"mods/types/scroller.js\";\nimport { ScrollObject } from \"./object.js\";\n\nexport function getScrollSchema<D = any, E = any, K = any>(\n  scroller: Scroller<D, E, K>,\n  fetcher: Fetcher<D, E, K> | undefined,\n  params: Params<D[], E, K> = {},\n) {\n  return new ScrollSchema(scroller, fetcher, params)\n}\n\nexport class ScrollSchema<D = any, E = any, K = any> implements Schema<D[], E, K, ScrollObject<D, E, K>> {\n  constructor(\n    readonly scroller: Scroller<D, E, K>,\n    readonly fetcher: Fetcher<D, E, K> | undefined,\n    readonly params: Params<D[], E, K> = {},\n  ) { }\n\n  make(core: Core) {\n    const { scroller, fetcher, params } = this\n\n    return new ScrollObject<D, E, K>(core, scroller, fetcher, params)\n  }\n\n  async normalize(data: D[], more: NormalizerMore<D[], E, K>) {\n    if (more.shallow) return\n    const { time, cooldown, expiration, optimistic } = more.root\n    const state = { data, time, cooldown, expiration, optimistic }\n    await this.make(more.core).mutate(() => state)\n  }\n}"],"names":[],"mappings":";;;SAQgB,eAAe,CAC7B,QAA2B,EAC3B,OAAqC,EACrC,MAA8B,EAAA;AAA9B,IAAA,IAAA,MAAA,KAAA,KAAA,CAAA,EAAA,EAAA,MAA8B,GAAA,EAAA,CAAA,EAAA;IAE9B,OAAO,IAAI,YAAY,CAAC,QAAQ,EAAE,OAAO,EAAE,MAAM,CAAC,CAAA;AACpD,CAAC;AAED,IAAA,YAAA,kBAAA,YAAA;AACE,IAAA,SAAA,YAAA,CACW,QAA2B,EAC3B,OAAqC,EACrC,MAA8B,EAAA;AAA9B,QAAA,IAAA,MAAA,KAAA,KAAA,CAAA,EAAA,EAAA,MAA8B,GAAA,EAAA,CAAA,EAAA;QAF9B,IAAQ,CAAA,QAAA,GAAR,QAAQ,CAAmB;QAC3B,IAAO,CAAA,OAAA,GAAP,OAAO,CAA8B;QACrC,IAAM,CAAA,MAAA,GAAN,MAAM,CAAwB;KACpC;IAEL,YAAI,CAAA,SAAA,CAAA,IAAA,GAAJ,UAAK,IAAU,EAAA;QACP,IAAA,EAAA,GAAgC,IAAI,EAAlC,QAAQ,GAAA,EAAA,CAAA,QAAA,EAAE,OAAO,GAAA,EAAA,CAAA,OAAA,EAAE,MAAM,GAAA,EAAA,CAAA,MAAS,CAAA;QAE1C,OAAO,IAAI,YAAY,CAAU,IAAI,EAAE,QAAQ,EAAE,OAAO,EAAE,MAAM,CAAC,CAAA;KAClE,CAAA;AAEK,IAAA,YAAA,CAAA,SAAA,CAAA,SAAS,GAAf,UAAgB,IAAS,EAAE,IAA+B,EAAA;;;;;;wBACxD,IAAI,IAAI,CAAC,OAAO;4BAAE,OAAM,CAAA,CAAA,YAAA,CAAA;AAClB,wBAAA,EAAA,GAA6C,IAAI,CAAC,IAAI,EAApD,IAAI,GAAA,EAAA,CAAA,IAAA,EAAE,QAAQ,GAAA,EAAA,CAAA,QAAA,EAAE,UAAU,GAAA,EAAA,CAAA,UAAA,EAAE,UAAU,gBAAA,CAAc;AACtD,wBAAA,KAAK,GAAG,EAAE,IAAI,EAAA,IAAA,EAAE,IAAI,EAAA,IAAA,EAAE,QAAQ,EAAA,QAAA,EAAE,UAAU,EAAA,UAAA,EAAE,UAAU,EAAA,UAAA,EAAE,CAAA;AAC9D,wBAAA,OAAA,CAAA,CAAA,YAAM,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC,YAAM,EAAA,OAAA,KAAK,CAAL,EAAK,CAAC,CAAA,CAAA;;AAA9C,wBAAA,EAAA,CAAA,IAAA,EAA8C,CAAA;;;;;AAC/C,KAAA,CAAA;IACH,OAAC,YAAA,CAAA;AAAD,CAAC,EAAA;;;;"}