import t,{createContext as e,useContext as r,useRef as n,useEffect as o,useMemo as i,useState as u,useCallback as a}from"react";function c(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(r)return(r=r.call(t)).next.bind(r);if(Array.isArray(t)||(r=unsupportedIterableToArray(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0;return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}}}throw TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l=function(){function t(){this.map=new Map}var e=t.prototype;return e.get=function(t){return this.map.get(t)},e.push=function(t,e){var r=this.map.get(t);r?r.push(e):this.map.set(t,[e])},e.erase=function(t,e){var r=this.map.get(t);if(r){var n=r.filter(function(t){return t!==e});n.length?this.map.set(t,n):this.map.delete(t)}},t}(),s=function(){function t(){this.listeners=new l}var e=t.prototype;return e.publish=function(t,e){var r=this.listeners.get(t);if(r)for(var n,o=c(r);!(n=o()).done;)(0,n.value)(e)},e.on=function(t,e){this.listeners.push(t,e)},e.off=function(t,e){this.listeners.erase(t,e)},t}();function f(t){if(t.length)return t[t.length-1]}function d(t){if(-1!==t)return Date.now()+t}function h(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}function v(t,e,r){return(v=h()?Reflect.construct:function(t,e,r){var n=[null];n.push.apply(n,e);var o=new(Function.bind.apply(t,n));return r&&w(o,r.prototype),o}).apply(null,arguments)}function p(t){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function y(t,e){if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&w(t,e)}function b(t,e){return null!=e&&"undefined"!=typeof Symbol&&e[Symbol.hasInstance]?!!e[Symbol.hasInstance](t):t instanceof e}function m(t){return -1!==Function.toString.call(t).indexOf("[native code]")}function w(t,e){return(w=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function g(t){var e="function"==typeof Map?new Map:void 0;return(g=function(t){if(null===t||!m(t))return t;if("function"!=typeof t)throw TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return v(t,arguments,p(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),w(r,t)})(t)}var k=function(t){function e(e){return t.call(this,"Aborted: "+e.reason,{cause:e})}return y(e,t),e}(g(Error));function S(t){return!!(b(t,k)||b(t,DOMException)&&"AbortError"===t.name)}var x=function(t){return t&&"undefined"!=typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};function E(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(r)return(r=r.call(t)).next.bind(r);if(Array.isArray(t)||(r=unsupportedIterableToArray(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0;return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}}}throw TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _(t,e){return t===e}function O(t,e){return t===e||(void 0===t?"undefined":x(t))===(void 0===e?"undefined":x(e))&&JSON.stringify(t)===JSON.stringify(e)}function P(t,e){if(t===e)return!0;if((void 0===t?"undefined":x(t))!==(void 0===e?"undefined":x(e)))return!1;var r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(var o,i=E(r);!(o=i()).done;){var u=o.value;if(t[u]!==e[u])return!1}return!0}var j=O,A=JSON,T=1e3,I=-1,D=5e3;function N(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function R(t){if(Array.isArray(t))return N(t)}function L(t,e,r,n,o,i,u){try{var a=t[i](u),c=a.value}catch(l){r(l);return}a.done?e(c):Promise.resolve(c).then(n,o)}function z(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var i=t.apply(e,r);function u(t){L(i,n,o,u,a,"next",t)}function a(t){L(i,n,o,u,a,"throw",t)}u(void 0)})}}function C(){return(C=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t}).apply(this,arguments)}function U(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function F(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function B(t){return R(t)||U(t)||G(t)||F()}function G(t,e){if(t){if("string"==typeof t)return N(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if("Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return N(t,e)}}var M=function(t,e){var r,n,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw TypeError("Generator is already executing.");for(;u;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,n=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=e.call(t,u)}catch(a){i=[6,a],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},J=function(){function t(t){this.core=t}var e=t.prototype;return e.first=function(t,e,r,n,o,i,u){void 0===n&&(n=new AbortController),void 0===o&&(o={}),void 0===i&&(i=!1),void 0===u&&(u=!1);var a=this;return z(function(){var c,l,s,f,h,v,p,y,b,m,w,g,S,x,E,_,O,P,A,N,R,L,U,F,B,G,J;return M(this,function(g){switch(g.label){case 0:if(void 0===t)return[2];return[4,a.core.lock(t,z(function(){var r,c;return M(this,function(l){switch(l.label){case 0:return[4,a.core.get(t,o)];case 1:if((null==(r=l.sent())?void 0:r.optimistic)||(null==r?void 0:r.aborter)&&!i||((null==r?void 0:r.aborter)&&i&&r.aborter.abort("Replaced"),a.core.shouldCooldown(r)&&!u||void 0===(c=e(void 0))))return[2,{current:r,skip:!0}];return[4,a.core.mutate(t,r,function(t){return{time:null==t?void 0:t.time,aborter:n}},o)];case 2:return[2,{current:r=l.sent(),first:c}]}})}))];case 1:if(l=(c=g.sent()).current,s=c.skip,f=c.first,s)return[2,l];if(void 0===f)throw Error("Undefined first");v=void 0===(h=o.equals)?j:h,y=void 0===(p=o.cooldown)?T:p,m=void 0===(b=o.expiration)?I:b,S=setTimeout(function(){n.abort("First timed out")},void 0===(w=o.timeout)?D:w),g.label=2;case 2:return g.trys.push([2,8,11,12]),[4,r(f,{signal:x=n.signal})];case 3:if(_=(E=g.sent()).data,O=E.error,A=void 0===(P=E.time)?Date.now():P,R=void 0===(N=E.cooldown)?d(y):N,U=void 0===(L=E.expiration)?d(m):L,x.aborted)throw new k(x);return[4,a.core.get(t,o)];case 4:if(l=g.sent(),F={},void 0!==_&&(F.data=[_]),F.error=O,!(void 0!==_))return[3,6];return[4,a.core.normalize(!0,{data:[_]},o)];case 5:v(null==(G=g.sent())?void 0:G[0],null==l?void 0:null==(B=l.data)?void 0:B[0])&&delete F.data,g.label=6;case 6:return[4,a.core.mutate(t,l,function(){return C({time:A,cooldown:R,expiration:U,aborter:void 0},F)},o)];case 7:case 10:return[2,g.sent()];case 8:return J=g.sent(),[4,a.core.get(t,o)];case 9:if((null==(l=g.sent())?void 0:l.aborter)!==n)return[2,l];return[4,a.core.mutate(t,l,function(){return{aborter:void 0,error:J}},o)];case 11:return clearTimeout(S),[7];case 12:return[2]}})})()},e.scroll=function(t,e,r,n,o,i,u){void 0===n&&(n=new AbortController),void 0===o&&(o={}),void 0===i&&(i=!1),void 0===u&&(u=!1);var a=this;return z(function(){var c,l,s,h,v,p,y,b,m,w,g,S,x,E,_,O,P,j,A,N,R,L,U,F;return M(this,function(w){switch(w.label){case 0:if(void 0===t)return[2];return[4,a.core.lock(t,z(function(){var r,c,l,s;return M(this,function(l){switch(l.label){case 0:return[4,a.core.get(t,o)];case 1:if((null==(r=l.sent())?void 0:r.optimistic)||(null==r?void 0:r.aborter)&&!i||((null==r?void 0:r.aborter)&&i&&r.aborter.abort("Replaced"),a.core.shouldCooldown(r)&&!u||void 0===(s=e(f(null!=(c=null==r?void 0:r.data)?c:[])))))return[2,{current:r,skip:!0}];return[4,a.core.mutate(t,r,function(t){return{time:null==t?void 0:t.time,aborter:n}},o)];case 2:return[2,{current:r=l.sent(),last:s}]}})}))];case 1:if(l=(c=w.sent()).current,s=c.skip,h=c.last,s)return[2,l];if(void 0===h)throw Error("Undefined last");p=void 0===(v=o.cooldown)?T:v,b=void 0===(y=o.expiration)?I:y,g=setTimeout(function(){n.abort("Scroll timed out")},void 0===(m=o.timeout)?D:m),w.label=2;case 2:return w.trys.push([2,6,9,10]),[4,r(h,{signal:S=n.signal})];case 3:if(E=(x=w.sent()).data,_=x.error,P=void 0===(O=x.time)?Date.now():O,A=void 0===(j=x.cooldown)?d(p):j,R=void 0===(N=x.expiration)?d(b):N,S.aborted)throw new k(S);return void 0!==R&&(null==l?void 0:l.expiration)!==void 0&&(R=Math.min(R,null==l?void 0:l.expiration)),[4,a.core.get(t,o)];case 4:return l=w.sent(),L={},void 0!==E&&(L.data=B(null!=(U=null==l?void 0:l.data)?U:[]).concat([E])),L.error=_,[4,a.core.mutate(t,l,function(){return C({time:P,cooldown:A,expiration:R,aborter:void 0},L)},o)];case 5:case 8:return[2,w.sent()];case 6:return F=w.sent(),[4,a.core.get(t,o)];case 7:if((null==(l=w.sent())?void 0:l.aborter)!==n)return[2,l];return[4,a.core.mutate(t,l,function(){return{aborter:void 0,error:F}},o)];case 9:return clearTimeout(g),[7];case 10:return[2]}})})()},t}();function q(t,e,r,n,o,i,u){try{var a=t[i](u),c=a.value}catch(l){r(l);return}a.done?e(c):Promise.resolve(c).then(n,o)}function W(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var i=t.apply(e,r);function u(t){q(i,n,o,u,a,"next",t)}function a(t){q(i,n,o,u,a,"throw",t)}u(void 0)})}}var X=function(t,e){var r,n,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw TypeError("Generator is already executing.");for(;u;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,n=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=e.call(t,u)}catch(a){i=[6,a],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};function H(t){return K.apply(this,arguments)}function K(){return(K=W(function(t){var e;return X(this,function(r){switch(r.label){case 0:return[4,t.next()];case 1:if((e=r.sent()).done)return[2,e.value];return[2]}})})).apply(this,arguments)}function Q(t){var e,r,n,o=2;for("undefined"!=typeof Symbol&&(r=Symbol.asyncIterator,n=Symbol.iterator);o--;){if(r&&null!=(e=t[r]))return e.call(t);if(n&&null!=(e=t[n]))return new V(e.call(t));r="@@asyncIterator",n="@@iterator"}throw TypeError("Object is not async iterable")}function V(t){function e(t){if(Object(t)!==t)return Promise.reject(TypeError(t+" is not an object."));var e=t.done;return Promise.resolve(t.value).then(function(t){return{value:t,done:e}})}return(V=function(t){this.s=t,this.n=t.next}).prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(t){var r=this.s.return;return void 0===r?Promise.resolve({value:t,done:!0}):e(r.apply(this.s,arguments))},throw:function(t){var r=this.s.return;return void 0===r?Promise.reject(t):e(r.apply(this.s,arguments))}},new V(t)}function Z(t,e,r,n,o,i,u){try{var a=t[i](u),c=a.value}catch(l){r(l);return}a.done?e(c):Promise.resolve(c).then(n,o)}function $(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var i=t.apply(e,r);function u(t){Z(i,n,o,u,a,"next",t)}function a(t){Z(i,n,o,u,a,"throw",t)}u(void 0)})}}function Y(){return(Y=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t}).apply(this,arguments)}var tt=function(t,e){var r,n,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw TypeError("Generator is already executing.");for(;u;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,n=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=e.call(t,u)}catch(a){i=[6,a],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},te=function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},tr=function(){function t(t){this.core=t}var e=t.prototype;return e.fetch=function(t,e,r,n,o,i,u){void 0===n&&(n=new AbortController),void 0===o&&(o={}),void 0===i&&(i=!1),void 0===u&&(u=!1);var a=this;return $(function(){var c,l,s,f,h,v,p,y,b,m,w,g,S,x,E,_,O,P,j,A,N,R;return tt(this,function(s){switch(s.label){case 0:if(void 0===t||void 0===e)return[2];return[4,a.core.lock(e,$(function(){var t;return tt(this,function(r){switch(r.label){case 0:return[4,a.core.get(e,o)];case 1:if((null==(t=r.sent())?void 0:t.optimistic)||(null==t?void 0:t.aborter)&&!i||((null==t?void 0:t.aborter)&&i&&t.aborter.abort("Replaced"),a.core.shouldCooldown(t)&&!u))return[2,{current:t,skip:!0}];return[4,a.core.mutate(e,t,function(t){return{time:null==t?void 0:t.time,aborter:n}},o)];case 2:return[2,{current:t=r.sent()}]}})}))];case 1:if(l=(c=s.sent()).current,c.skip)return[2,l];h=void 0===(f=o.cooldown)?T:f,p=void 0===(v=o.expiration)?I:v,m=setTimeout(function(){n.abort("Fetch timed out")},void 0===(y=o.timeout)?D:y),s.label=2;case 2:return s.trys.push([2,6,9,10]),[4,r(t,{signal:w=n.signal})];case 3:if(S=(g=s.sent()).data,x=g.error,_=void 0===(E=g.time)?Date.now():E,P=void 0===(O=g.cooldown)?d(h):O,A=void 0===(j=g.expiration)?d(p):j,w.aborted)throw new k(w);return[4,a.core.get(e,o)];case 4:return l=s.sent(),N={},void 0!==S&&(N.data=S),N.error=x,[4,a.core.mutate(e,l,function(){return Y({time:_,cooldown:P,expiration:A,aborter:void 0},N)},o)];case 5:case 8:return[2,s.sent()];case 6:return R=s.sent(),[4,a.core.get(e,o)];case 7:if((null==(l=s.sent())?void 0:l.aborter)!==n)return[2,l];return[4,a.core.mutate(e,l,function(){return{aborter:void 0,error:R}},o)];case 9:return clearTimeout(m),[7];case 10:return[2]}})})()},e.update=function(t,e,r,n,o,i){void 0===o&&(o=new AbortController),void 0===i&&(i={});var u=this;return $(function(){var a,c,l,s,f,h,v,p,y,b,m,w,g,S,x,E,_,O,P,j,A,N,R,L,z,C,U,F,B,G;return tt(this,function(l){switch(l.label){case 0:if(void 0===t||void 0===e)return[2];return[4,u.core.lock(e,$(function(){var t;return tt(this,function(r){switch(r.label){case 0:return[4,u.core.get(e,i)];case 1:if(null==(t=r.sent())?void 0:t.optimistic)return[2,{current:t,skip:!0}];return(null==t?void 0:t.aborter)&&t.aborter.abort("Replaced"),[4,u.core.mutate(e,t,function(t){return{time:null==t?void 0:t.time,aborter:o,optimistic:!0}},i)];case 2:return[2,{current:t=r.sent()}]}})}))];case 1:if(c=(a=l.sent()).current,a.skip)return[2,c];f=void 0===(s=i.cooldown)?T:s,v=void 0===(h=i.expiration)?I:h,b=setTimeout(function(){o.abort("Update timed out")},void 0===(p=i.timeout)?D:p),l.label=2;case 2:l.trys.push([2,23,26,27]),w=n(c,{signal:m=o.signal}),g=!1,S=!1,l.label=3;case 3:l.trys.push([3,9,10,15]),E=function(){var t,r,n,a;return tt(this,function(l){switch(l.label){case 0:if(r=(t=O.value).data,n=t.error,m.aborted)throw new k(m);return a={},void 0!==r&&(a.data=r),a.error=n,[4,u.core.mutate(e,c,function(t){return Y({time:null==t?void 0:t.time,aborter:o,optimistic:!0},a)},i)];case 1:return c=l.sent(),[2]}})},_=Q(w),l.label=4;case 4:return[4,_.next()];case 5:if(!(g=!(O=l.sent()).done))return[3,8];return[5,te(E())];case 6:l.sent(),l.label=7;case 7:return g=!1,[3,4];case 8:return[3,15];case 9:return P=l.sent(),S=!0,x=P,[3,15];case 10:if(l.trys.push([10,,13,14]),!(g&&null!=_.return))return[3,12];return[4,_.return()];case 11:l.sent(),l.label=12;case 12:return[3,14];case 13:if(S)throw x;return[7];case 14:return[7];case 15:return[4,H(w)];case 16:if(void 0!==(j=l.sent()))return[3,18];if(void 0===r)throw Error("Updater returned nothing and undefined fetcher");return[4,r(t,{signal:m,cache:"reload"})];case 17:j=l.sent(),l.label=18;case 18:if(A=j.data,N=j.error,L=void 0===(R=j.time)?Date.now():R,C=void 0===(z=j.cooldown)?d(f):z,F=void 0===(U=j.expiration)?d(v):U,m.aborted)throw new k(m);return[4,u.core.get(e,i)];case 19:if(c=l.sent(),!(void 0!==N))return[3,21];if((null==c?void 0:c.aborter)!==o)return[2,c];return[4,u.core.mutate(e,c,function(t){return{time:null==t?void 0:t.time,cooldown:C,expiration:F,aborter:void 0,optimistic:!1,data:null==t?void 0:t.data,error:N}},i)];case 20:case 22:case 25:return[2,l.sent()];case 21:return B={},void 0!==A&&(B.data=A),B.error=N,[4,u.core.mutate(e,c,function(){return Y({time:L,cooldown:C,expiration:F,aborter:void 0,optimistic:!1},B)},i)];case 23:return G=l.sent(),[4,u.core.get(e,i)];case 24:if((null==(c=l.sent())?void 0:c.aborter)!==o)return[2,c];return[4,u.core.mutate(e,c,function(t){return{time:null==t?void 0:t.time,aborter:void 0,optimistic:!1,data:null==t?void 0:t.data,error:G}},i)];case 26:return clearTimeout(b),[7];case 27:return[2]}})})()},t}();function tn(t){return Boolean(t.async)}function to(t,e,r,n,o,i,u){try{var a=t[i](u),c=a.value}catch(l){r(l);return}a.done?e(c):Promise.resolve(c).then(n,o)}function ti(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var i=t.apply(e,r);function u(t){to(i,n,o,u,a,"next",t)}function a(t){to(i,n,o,u,a,"throw",t)}u(void 0)})}}var tu=function(t,e){var r,n,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw TypeError("Generator is already executing.");for(;u;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,n=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=e.call(t,u)}catch(a){i=[6,a],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},ta=function(){function t(){}return t.prototype.lock=function(t){var e=this;return ti(function(){var r;return tu(this,function(n){switch(n.label){case 0:if(!e.mutex)return[3,2];return[4,e.mutex];case 1:n.sent(),n.label=2;case 2:return r=t(),e.mutex=r,[4,r];case 3:return[2,n.sent()]}})})()},t}();function tc(t){if(void 0===t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function tl(t,e,r,n,o,i,u){try{var a=t[i](u),c=a.value}catch(l){r(l);return}a.done?e(c):Promise.resolve(c).then(n,o)}function ts(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var i=t.apply(e,r);function u(t){tl(i,n,o,u,a,"next",t)}function a(t){tl(i,n,o,u,a,"throw",t)}u(void 0)})}}function tf(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function td(t,e,r){return e&&tf(t.prototype,e),r&&tf(t,r),t}function th(){return(th=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t}).apply(this,arguments)}function tv(t,e,r){return(tv="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=tm(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(r):o.value}})(t,e,r||t)}function tp(t){return(tp=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ty(t,e){if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&tb(t,e)}function tb(t,e){return(tb=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function tm(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=tp(t)););return t}function tw(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(r)return(r=r.call(t)).next.bind(r);if(Array.isArray(t)||(r=unsupportedIterableToArray(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0;return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}}}throw TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var tg=function(t,e){var r,n,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw TypeError("Generator is already executing.");for(;u;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,n=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=e.call(t,u)}catch(a){i=[6,a],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},tk=function(t){function e(e){var r;return(r=t.call(this)||this).params=e,r.single=new tr(tc(r)),r.scroll=new J(tc(r)),r.cache=new Map,r.locks=new Map,r._mounted=!0,r.counts=new Map,r.timeouts=new Map,r}ty(e,t);var r=e.prototype;return r.unmount=function(){for(var t,e=tw(this.timeouts.values());!(t=e()).done;)clearTimeout(t.value);this._mounted=!1},r.lock=function(t,e){var r=this;return ts(function(){var n,o;return tg(this,function(i){switch(i.label){case 0:if(!(void 0!==(n=r.locks.get(t))))return[3,2];return[4,n.lock(e)];case 1:case 3:return[2,i.sent()];case 2:return o=new ta,r.locks.set(t,o),[4,o.lock(e)]}})})()},r.getSync=function(t,e){if(void 0===e&&(e={}),void 0!==t){var r=this.cache.get(t);if(void 0!==r)return r;var n=e.storage;if(n){if(tn(n))return null;var o=n.get(t);return this.cache.set(t,o),o}}},r.get=function(t,e,r){void 0===e&&(e={}),void 0===r&&(r=!1);var n=this;return ts(function(){var o,i,u;return tg(this,function(a){switch(a.label){case 0:if(void 0===t)return[2];if(void 0!==(o=n.cache.get(t)))return[2,o];if(!(i=e.storage))return[2];return[4,i.get(t,r)];case 1:return u=a.sent(),n.cache.set(t,u),[2,u]}})})()},r.set=function(t,e,r){void 0===r&&(r={});var n=this;return ts(function(){var o,i,u,a,c;return tg(this,function(l){switch(l.label){case 0:if(void 0===t||(n.cache.set(t,e),n.publish(t,e),!(o=r.storage)))return[2];return i=e.data,u=e.time,a=e.cooldown,c=e.expiration,[4,o.set(t,{data:i,time:u,cooldown:a,expiration:c})];case 1:return l.sent(),[2]}})})()},r.delete=function(t,e){void 0===e&&(e={});var r=this;return ts(function(){var n;return tg(this,function(o){switch(o.label){case 0:if(!t||(r.cache.delete(t),r.locks.delete(t),r.publish(t,void 0),!(n=e.storage)))return[2];return[4,n.delete(t)];case 1:return o.sent(),[2]}})})()},r.mutate=function(t,e,r,n){void 0===n&&(n={});var o=this;return ts(function(){var i,u,a,c,l;return tg(this,function(s){switch(s.label){case 0:if(void 0===t)return[2];if(i=r(e))return[3,2];return[4,o.delete(t,n)];case 1:return s.sent(),[2];case 2:if(void 0!==i.time&&i.time<(null!=(u=null==e?void 0:e.time)?u:0)||void 0===i.optimistic&&(null==e?void 0:e.optimistic))return[2,e];return c=void 0===(a=n.equals)?j:a,l=th({},e,i),[4,o.normalize(!1,l,n)];case 3:if(l.data=s.sent(),void 0===l.time&&(l.time=Date.now()),c(l.data,null==e?void 0:e.data)&&(l.data=null==e?void 0:e.data),l.optimistic||(l.realData=l.data),P(l,e))return[2,e];return[4,o.set(t,l,n)];case 4:return s.sent(),[2,l]}})})()},r.normalize=function(t,e,r){void 0===r&&(r={});var n=this;return ts(function(){return tg(this,function(o){switch(o.label){case 0:if(void 0===e.data)return[2];if(void 0===r.normalizer)return[2,e.data];return[4,r.normalizer(e.data,{core:n,shallow:t,root:e})];case 1:return[2,o.sent()]}})})()},r.shouldCooldown=function(t){return(null==t?void 0:t.cooldown)!==void 0&&Date.now()<t.cooldown},r.once=function(t,e,r){void 0===r&&(r={});var n=this;if(t){var o=function(i){n.off(t,o,r),e(i)};this.on(t,o,r)}},r.on=function(t,r,n){if(t){tv(e.prototype,"on",this).call(this,t,r);var o,i=null!=(o=this.counts.get(t))?o:0;this.counts.set(t,i+1);var u=this.timeouts.get(t);void 0!==u&&(clearTimeout(u),this.timeouts.delete(t))}},r.off=function(t,r,n){void 0===n&&(n={});var o=this,i=this;return ts(function(){var u,a,c,l,s;return tg(this,function(l){switch(l.label){case 0:if(!t)return[2];if(tv(e.prototype,"off",o).call(i,t,r),void 0===(u=i.counts.get(t)))throw Error("Undefined count");if(u>1)return i.counts.set(t,u-1),[2];return i.counts.delete(t),[4,i.get(t,n,!0)];case 1:if((null==(a=l.sent())?void 0:a.expiration)===void 0||(null==a?void 0:a.expiration)===-1)return[2];if(c=ts(function(){var e;return tg(this,function(e){switch(e.label){case 0:if(!i._mounted||void 0!==i.counts.get(t))return[2];return i.timeouts.delete(t),[4,i.delete(t,n)];case 1:return e.sent(),[2]}})}),!(Date.now()>a.expiration))return[3,3];return[4,c()];case 2:return l.sent(),[2];case 3:return s=setTimeout(c,a.expiration-Date.now()),i.timeouts.set(t,s),[2]}})})()},td(e,[{key:"mounted",get:function(){return this._mounted}}]),e}(s);function tS(t,e){if(null==t)return{};var r,n,o={},i=Object.keys(t);for(n=0;n<i.length;n++)r=i[n],e.indexOf(r)>=0||(o[r]=t[r]);return o}var tx=e(void 0);function tE(){var t=r(tx);if(void 0===t)throw Error("Undefined core");return t}function t_(t){var e=n();return void 0===e.current&&(e.current=new tk(t)),o(function(){return function(){var t;null==(t=e.current)||t.unmount()}},[]),e.current}function tO(e){var r=e.children,n=t_(tS(e,["children"]));return t.createElement(tx.Provider,{value:n},r)}function tP(t,e){var r=t.data;o(function(){console.debug(e,t)},[r,t.error,t.time])}function tj(t,e){var r=t.error;o(function(){void 0!==r&&e(r)},[r])}function tA(t,e){var r=t.data,n=t.error;void 0===r&&void 0===n&&Object.assign(t,e)}function tT(t){var e=t.fetch;o(function(){e()},[e])}function tI(t,e){var r=t.ready,n=t.fetch;o(function(){if(r&&e){var t=setInterval(n,e);return function(){return clearInterval(t)}}},[n,e])}function tD(t){var e=t.fetch;o(function(){e()},[])}function tN(t){var e=t.data,r=t.fetch;o(function(){void 0===e&&r()},[e,r])}function tR(t){var e=n(t);return e.current=t,e}function tL(t){var e=t.ready,r=tR(t.fetch);o(function(){if(e){var t=function(){return r.current()};return addEventListener("online",t),function(){return removeEventListener("online",t)}}},[e])}function tz(t,e){void 0===e&&(e={});var r=t.ready,i=t.skey,u=t.refetch,a=t.error,c=e.init,l=void 0===c?1e3:c,s=e.base,f=void 0===s?2:s,d=e.max,h=void 0===d?3:d,v=n(0);o(function(){v.current=0},[i]);var p=tR(u);o(function(){var t=function(){v.current++,p.current()};if(r){if(void 0===a){v.current=0;return}if(!(v.current>=h)){var e=setTimeout(t,l*Math.pow(f,v.current));return function(){return clearTimeout(e)}}}},[r,a])}function tC(t){var e=t.ready,r=tR(t.fetch);o(function(){if(e){var t=function(){return!document.hidden&&r.current()};return document.addEventListener("visibilitychange",t),function(){return document.removeEventListener("visibilitychange",t)}}},[e])}function tU(t,e,r,n,o,i,u){try{var a=t[i](u),c=a.value}catch(l){r(l);return}a.done?e(c):Promise.resolve(c).then(n,o)}function tF(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var i=t.apply(e,r);function u(t){tU(i,n,o,u,a,"next",t)}function a(t){tU(i,n,o,u,a,"throw",t)}u(void 0)})}}function tB(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function tG(t,e,r){return e&&tB(t.prototype,e),r&&tB(t,r),t}function tM(){return(tM=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t}).apply(this,arguments)}var tJ=function(t,e){var r,n,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw TypeError("Generator is already executing.");for(;u;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,n=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=e.call(t,u)}catch(a){i=[6,a],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};function tq(t,e){if(void 0!==t){if("string"==typeof t)return t;var r=e.serializer;return"scroll:"+(void 0===r?A:r).stringify(t)}}var tW=function(){function t(t,e,r,n){void 0===n&&(n={}),this.core=t,this.scroller=e,this.fetcher=r,this.params=n,this.mparams=tM({},t.params,n),this.key=e(),this.skey=tq(this.key,this.mparams),this.loadSync(),this.subscribe()}var e=t.prototype;return e.loadSync=function(){var t=this.core,e=this.skey,r=this.mparams;this._state=t.getSync(e,r)},e.loadAsync=function(){var t=this;return tF(function(){var e,r,n;return tJ(this,function(o){switch(o.label){case 0:if(t.ready)return[2];return e=t.core,r=t.skey,n=t.mparams,[4,e.get(r,n)];case 1:return t._state=o.sent(),[2]}})})()},e.subscribe=function(){var t=this,e=this.core,r=this.skey,n=function(e){return t._state=e};e.on(r,n),new FinalizationRegistry(function(){e.off(r,n)}).register(this,void 0)},e.mutate=function(t){var e=this;return tF(function(){var r,n,o,i;return tJ(this,function(u){switch(u.label){case 0:if(r=e.core,n=e.skey,o=e.mparams,null!==e._state)return[3,2];return[4,null!=(i=e._init)?i:e._init=e.loadAsync()];case 1:u.sent(),u.label=2;case 2:if(null===e._state)throw Error("Null state after init");return[4,r.mutate(n,e._state,t,o)];case 3:return[2,e._state=u.sent()]}})})()},e.fetch=function(t){var e=this;return tF(function(){var r,n,o,i,u,a;return tJ(this,function(c){switch(c.label){case 0:if(r=e.core,n=e.scroller,o=e.skey,i=e.fetcher,u=e.mparams,null!==e._state)return[3,2];return[4,null!=(a=e._init)?a:e._init=e.loadAsync()];case 1:c.sent(),c.label=2;case 2:if(null===e._state)throw Error("Null state after init");if(void 0===i)return[2,e._state];return[4,r.scroll.first(o,n,i,t,u)];case 3:return[2,e._state=c.sent()]}})})()},e.refetch=function(t){var e=this;return tF(function(){var r,n,o,i,u,a;return tJ(this,function(c){switch(c.label){case 0:if(r=e.core,n=e.scroller,o=e.skey,i=e.fetcher,u=e.mparams,null!==e._state)return[3,2];return[4,null!=(a=e._init)?a:e._init=e.loadAsync()];case 1:c.sent(),c.label=2;case 2:if(null===e._state)throw Error("Null state after init");if(void 0===i)return[2,e._state];return[4,r.scroll.first(o,n,i,t,u,!0,!0)];case 3:return[2,e._state=c.sent()]}})})()},e.scroll=function(t){var e=this;return tF(function(){var r,n,o,i,u,a;return tJ(this,function(c){switch(c.label){case 0:if(r=e.core,n=e.scroller,o=e.skey,i=e.fetcher,u=e.mparams,null!==e._state)return[3,2];return[4,null!=(a=e._init)?a:e._init=e.loadAsync()];case 1:c.sent(),c.label=2;case 2:if(null===e._state)throw Error("Null state after init");if(void 0===i)return[2,e._state];return[4,r.scroll.scroll(o,n,i,t,u,!0,!0)];case 3:return[2,e._state=c.sent()]}})})()},e.clear=function(){var t=this;return tF(function(){var e,r,n;return tJ(this,function(o){switch(o.label){case 0:return e=t.core,r=t.skey,n=t.mparams,[4,e.delete(r,n)];case 1:return o.sent(),delete t._state,[2]}})})()},tG(t,[{key:"init",get:function(){return this._init}},{key:"state",get:function(){return this._state}},{key:"ready",get:function(){return null!==this._state}}]),t}();function tX(t,e,r,n,o,i,u){try{var a=t[i](u),c=a.value}catch(l){r(l);return}a.done?e(c):Promise.resolve(c).then(n,o)}function tH(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var i=t.apply(e,r);function u(t){tX(i,n,o,u,a,"next",t)}function a(t){tX(i,n,o,u,a,"throw",t)}u(void 0)})}}var tK=function(t,e){var r,n,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw TypeError("Generator is already executing.");for(;u;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,n=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=e.call(t,u)}catch(a){i=[6,a],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};function tQ(t,e,r){return void 0===r&&(r={}),new tV(t,e,r)}var tV=function(){function t(t,e,r){void 0===r&&(r={}),this.scroller=t,this.fetcher=e,this.params=r}var e=t.prototype;return e.make=function(t){var e=this.scroller,r=this.fetcher,n=this.params;return new tW(t,e,r,n)},e.normalize=function(t,e){var r=this;return tH(function(){var n,o,i,u,a,c;return tK(this,function(a){switch(a.label){case 0:if(e.shallow)return[2];return o=(n=e.root).time,i=n.cooldown,c={data:t,time:o,cooldown:i,expiration:u=n.expiration,optimistic:n.optimistic},[4,r.make(e.core).mutate(function(){return c})];case 1:return a.sent(),[2]}})})()},t}();function tZ(t,e,r,n,o,i,u){try{var a=t[i](u),c=a.value}catch(l){r(l);return}a.done?e(c):Promise.resolve(c).then(n,o)}function t$(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var i=t.apply(e,r);function u(t){tZ(i,n,o,u,a,"next",t)}function a(t){tZ(i,n,o,u,a,"throw",t)}u(void 0)})}}function tY(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function t0(t,e,r){return e&&tY(t.prototype,e),r&&tY(t,r),t}function t1(){return(t1=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t}).apply(this,arguments)}var t2=function(t,e){var r,n,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw TypeError("Generator is already executing.");for(;u;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,n=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=e.call(t,u)}catch(a){i=[6,a],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};function t4(t,e){if(void 0!==t){if("string"==typeof t)return t;var r=e.serializer;return(void 0===r?A:r).stringify(t)}}var t3=function(){function t(t,e,r,n){void 0===n&&(n={}),this.core=t,this.key=e,this.fetcher=r,this.params=n,this.mparams=t1({},t.params,n),this.skey=t4(e,this.mparams),this.loadSync(),this.subscribe()}var e=t.prototype;return e.loadSync=function(){var t=this.core,e=this.skey,r=this.mparams;this._state=t.getSync(e,r)},e.loadAsync=function(){var t=this;return t$(function(){var e,r,n;return t2(this,function(o){switch(o.label){case 0:if(t.ready)return[2];return e=t.core,r=t.skey,n=t.mparams,[4,e.get(r,n)];case 1:return t._state=o.sent(),[2]}})})()},e.subscribe=function(){var t=this,e=this.core,r=this.skey,n=function(e){return t._state=e};e.on(this.skey,n),new FinalizationRegistry(function(){e.off(r,n)}).register(this,void 0)},e.mutate=function(t){var e=this;return t$(function(){var r,n,o,i;return t2(this,function(u){switch(u.label){case 0:if(r=e.core,n=e.skey,o=e.mparams,null!==e._state)return[3,2];return[4,null!=(i=e._init)?i:e._init=e.loadAsync()];case 1:u.sent(),u.label=2;case 2:if(null===e._state)throw Error("Null state after init");return[4,r.mutate(n,e._state,t,o)];case 3:return[2,e._state=u.sent()]}})})()},e.fetch=function(t){var e=this;return t$(function(){var r,n,o,i,u,a;return t2(this,function(c){switch(c.label){case 0:if(r=e.core,n=e.key,o=e.skey,i=e.fetcher,u=e.mparams,null!==e._state)return[3,2];return[4,null!=(a=e._init)?a:e._init=e.loadAsync()];case 1:c.sent(),c.label=2;case 2:if(null===e._state)throw Error("Null state after init");if(void 0===i)return[2,e._state];return[4,r.single.fetch(n,o,i,t,u)];case 3:return[2,e._state=c.sent()]}})})()},e.refetch=function(t){var e=this;return t$(function(){var r,n,o,i,u,a;return t2(this,function(c){switch(c.label){case 0:if(r=e.core,n=e.key,o=e.skey,i=e.fetcher,u=e.mparams,null!==e._state)return[3,2];return[4,null!=(a=e._init)?a:e._init=e.loadAsync()];case 1:c.sent(),c.label=2;case 2:if(null===e._state)throw Error("Null state after init");if(void 0===i)return[2,e._state];return[4,r.single.fetch(n,o,i,t,u,!0,!0)];case 3:return[2,e._state=c.sent()]}})})()},e.update=function(t,e,r){void 0===e&&(e={});var n=this;return t$(function(){var o,i,u,a,c,l,s;return t2(this,function(f){switch(f.label){case 0:if(o=n.core,i=n.key,u=n.skey,a=n.fetcher,c=n.mparams,null!==n._state)return[3,2];return[4,null!=(l=n._init)?l:n._init=n.loadAsync()];case 1:f.sent(),f.label=2;case 2:if(null===n._state)throw Error("Null state after init");return s=t1({},c,e),[4,o.single.update(i,u,a,t,r,s)];case 3:return[2,n._state=f.sent()]}})})()},e.clear=function(){var t=this;return t$(function(){var e,r,n;return t2(this,function(o){switch(o.label){case 0:return e=t.core,r=t.skey,n=t.mparams,[4,e.delete(r,n)];case 1:return o.sent(),delete t._state,[2]}})})()},t0(t,[{key:"init",get:function(){return this._init}},{key:"state",get:function(){return this._state}},{key:"ready",get:function(){return null!==this._state}}]),t}();function t6(t,e,r,n,o,i,u){try{var a=t[i](u),c=a.value}catch(l){r(l);return}a.done?e(c):Promise.resolve(c).then(n,o)}function t5(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var i=t.apply(e,r);function u(t){t6(i,n,o,u,a,"next",t)}function a(t){t6(i,n,o,u,a,"throw",t)}u(void 0)})}}var t7=function(t,e){var r,n,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw TypeError("Generator is already executing.");for(;u;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,n=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=e.call(t,u)}catch(a){i=[6,a],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};function t8(t,e,r){return void 0===r&&(r={}),new t9(t,e,r)}var t9=function(){function t(t,e,r){void 0===r&&(r={}),this.key=t,this.fetcher=e,this.params=r}var e=t.prototype;return e.make=function(t){var e=this.key,r=this.fetcher,n=this.params;return new t3(t,e,r,n)},e.normalize=function(t,e){var r=this;return t5(function(){var n,o,i,u,a,c;return t7(this,function(a){switch(a.label){case 0:if(e.shallow)return[2];return o=(n=e.root).time,i=n.cooldown,c={data:t,time:o,cooldown:i,expiration:u=n.expiration,optimistic:n.optimistic},[4,r.make(e.core).mutate(function(){return c})];case 1:return a.sent(),[2]}})})()},t}();function et(t,e,r,n,o,i,u){try{var a=t[i](u),c=a.value}catch(l){r(l);return}a.done?e(c):Promise.resolve(c).then(n,o)}function ee(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var i=t.apply(e,r);function u(t){et(i,n,o,u,a,"next",t)}function a(t){et(i,n,o,u,a,"throw",t)}u(void 0)})}}function er(){return(er=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t}).apply(this,arguments)}var en=function(t,e){var r,n,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw TypeError("Generator is already executing.");for(;u;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,n=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=e.call(t,u)}catch(a){i=[6,a],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};function eo(t,e,r){void 0===r&&(r={});var c=tE(),l=er({},c.params,r),s=tR(t),f=tR(e),d=tR(l),h=i(function(){return t()},[t]),v=i(function(){return tq(h,d.current)},[h]),p=u(0)[1],y=n();i(function(){y.current=c.getSync(v,d.current)},[c,v]);var b=a(function(t){y.current=t,p(function(t){return t+1})},[]),m=n();o(function(){null===y.current&&(m.current=c.get(v,d.current).then(b))},[c,v]),o(function(){if(v)return c.on(v,b,d.current),function(){c.off(v,b,d.current)}},[c,v]);var w=a(ee(function(t){var e,r;return en(this,function(n){switch(n.label){case 0:if(null!==y.current)return[3,2];return[4,m.current];case 1:n.sent(),n.label=2;case 2:if(null===y.current)throw Error("Null state after init");return e=y.current,r=d.current,[4,c.mutate(v,e,t,r)];case 3:return[2,n.sent()]}})}),[c,v]),g=a(ee(function(){return en(this,function(t){switch(t.label){case 0:if(null!==y.current)return[3,2];return[4,m.current];case 1:t.sent(),t.label=2;case 2:if(null===y.current)throw Error("Null state after init");return[4,c.delete(v,d.current)];case 3:return t.sent(),[2]}})}),[c,v]),k=a(ee(function(t){var e,r,n;return en(this,function(o){switch(o.label){case 0:if("undefined"==typeof window)throw Error("Fetch on SSR");if(null!==y.current)return[3,2];return[4,m.current];case 1:o.sent(),o.label=2;case 2:if(null===y.current)throw Error("Null state after init");if(void 0===f.current)return[2,y.current];return e=s.current,r=f.current,n=d.current,[4,c.scroll.first(v,e,r,t,n)];case 3:return[2,o.sent()]}})}),[c,v]),S=a(ee(function(t){var e,r,n;return en(this,function(o){switch(o.label){case 0:if("undefined"==typeof window)throw Error("Refetch on SSR");if(null!==y.current)return[3,2];return[4,m.current];case 1:o.sent(),o.label=2;case 2:if(null===y.current)throw Error("Null state after init");if(void 0===f.current)return[2,y.current];return e=s.current,r=f.current,n=d.current,[4,c.scroll.first(v,e,r,t,n,!0,!0)];case 3:return[2,o.sent()]}})}),[c,v]),x=a(ee(function(t){var e,r,n;return en(this,function(o){switch(o.label){case 0:if("undefined"==typeof window)throw Error("Scroll on SSR");if(null!==y.current)return[3,2];return[4,m.current];case 1:o.sent(),o.label=2;case 2:if(null===y.current)throw Error("Null state after init");if(void 0===f.current)return[2,y.current];return e=s.current,r=f.current,n=d.current,[4,c.scroll.scroll(v,e,r,t,n,!0,!0)];case 3:return[2,o.sent()]}})}),[c,v]),E=a(function(){if("undefined"==typeof window)throw Error("Suspend on SSR");return ee(function(){var t,e,r,n;return en(this,function(o){switch(o.label){case 0:if(null!==y.current)return[3,2];return[4,m.current];case 1:o.sent(),o.label=2;case 2:if(null===y.current)throw Error("Null state after init");if(void 0===f.current)throw Error("No fetcher");return t=s.current,e=f.current,r=d.current,n=new Promise(function(t){return c.once(v,function(){return t()},r)}),[4,c.scroll.first(v,t,e,void 0,r,!1,!0)];case 3:return o.sent(),[4,n];case 4:return o.sent(),[2]}})})()},[c,v]),_=y.current,O=null!=_?_:{},P=O.data,j=O.error,A=O.time,T=O.cooldown,I=O.expiration,D=O.aborter,N=O.optimistic,R=O.realData,L=Boolean(D);return{key:h,skey:v,data:P,error:j,time:A,cooldown:T,expiration:I,aborter:D,optimistic:N,realData:R,loading:L,ready:null!==_,mutate:w,fetch:k,refetch:S,scroll:x,clear:g,suspend:E}}function ei(t,e,r,n,o,i,u){try{var a=t[i](u),c=a.value}catch(l){r(l);return}a.done?e(c):Promise.resolve(c).then(n,o)}function eu(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var i=t.apply(e,r);function u(t){ei(i,n,o,u,a,"next",t)}function a(t){ei(i,n,o,u,a,"throw",t)}u(void 0)})}}function ea(){return(ea=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t}).apply(this,arguments)}var ec=function(t,e){var r,n,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw TypeError("Generator is already executing.");for(;u;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,n=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=e.call(t,u)}catch(a){i=[6,a],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};function el(t,e,r){void 0===r&&(r={});var c=tE(),l=ea({},c.params,r),s=tR(t),f=tR(e),d=tR(l),h=i(function(){return t4(t,d.current)},[t]),v=u(0)[1],p=n();i(function(){p.current=c.getSync(h,d.current)},[c,h]);var y=a(function(t){p.current=t,v(function(t){return t+1})},[]),b=n();o(function(){null===p.current&&(b.current=c.get(h,d.current).then(y))},[c,h]),o(function(){if(h)return c.on(h,y,d.current),function(){c.off(h,y,d.current)}},[c,h]);var m=a(eu(function(t){var e,r;return ec(this,function(n){switch(n.label){case 0:if(null!==p.current)return[3,2];return[4,b.current];case 1:n.sent(),n.label=2;case 2:if(null===p.current)throw Error("Null state after init");return e=p.current,r=d.current,[4,c.mutate(h,e,t,r)];case 3:return[2,n.sent()]}})}),[c,h]),w=a(eu(function(){return ec(this,function(t){switch(t.label){case 0:if(null!==p.current)return[3,2];return[4,b.current];case 1:t.sent(),t.label=2;case 2:if(null===p.current)throw Error("Null state after init");return[4,c.delete(h,d.current)];case 3:return t.sent(),[2]}})}),[c,h]),g=a(eu(function(t){var e,r,n;return ec(this,function(o){switch(o.label){case 0:if("undefined"==typeof window)throw Error("Fetch on SSR");if(null!==p.current)return[3,2];return[4,b.current];case 1:o.sent(),o.label=2;case 2:if(null===p.current)throw Error("Null state after init");if(void 0===f.current)return[2,p.current];return e=s.current,r=f.current,n=d.current,[4,c.single.fetch(e,h,r,t,n)];case 3:return[2,o.sent()]}})}),[c,h]),k=a(eu(function(t){var e,r,n;return ec(this,function(o){switch(o.label){case 0:if("undefined"==typeof window)throw Error("Refetch on SSR");if(null!==p.current)return[3,2];return[4,b.current];case 1:o.sent(),o.label=2;case 2:if(null===p.current)throw Error("Null state after init");if(void 0===f.current)return[2,p.current];return e=s.current,r=f.current,n=d.current,[4,c.single.fetch(e,h,r,t,n,!0,!0)];case 3:return[2,o.sent()]}})}),[c,h]),S=a(eu(function(t,e,r){var n,o,i,u;return ec(this,function(i){switch(i.label){case 0:if(void 0===e&&(e={}),"undefined"==typeof window)throw Error("Update on SSR");if(null!==p.current)return[3,2];return[4,b.current];case 1:i.sent(),i.label=2;case 2:if(null===p.current)throw Error("Null state after init");return n=s.current,o=f.current,u=ea({},d.current,e),[4,c.single.update(n,h,o,t,r,u)];case 3:return[2,i.sent()]}})}),[c,h]),x=a(function(){if("undefined"==typeof window)throw Error("Suspend on SSR");return eu(function(){var t,e,r,n;return ec(this,function(o){switch(o.label){case 0:if(null!==p.current)return[3,2];return[4,b.current];case 1:o.sent(),o.label=2;case 2:if(null===p.current)throw Error("Null state after init");if(void 0===f.current)throw Error("No fetcher");return t=s.current,e=f.current,r=d.current,n=new Promise(function(t){return c.once(h,function(){return t()},r)}),[4,c.single.fetch(t,h,e,void 0,r,!1,!0)];case 3:return o.sent(),[4,n];case 4:return o.sent(),[2]}})})()},[c,h]),E=p.current,_=null!=E?E:{},O=_.data,P=_.error,j=_.time,A=_.cooldown,T=_.expiration,I=_.aborter,D=_.optimistic,N=_.realData,R=Boolean(I);return{key:t,skey:h,data:O,error:P,time:j,cooldown:A,expiration:T,aborter:I,optimistic:D,realData:N,loading:R,ready:null!==E,mutate:m,fetch:g,refetch:k,update:S,clear:w,suspend:x}}function es(t,e){return null!=e&&"undefined"!=typeof Symbol&&e[Symbol.hasInstance]?!!e[Symbol.hasInstance](t):t instanceof e}function ef(t,e){var r=i(function(){return t.apply(void 0,e)},e);if(es(r,t9)){var n=r.key;return el(n,r.fetcher,r.params)}if(es(r,tV)){var o=r.scroller;return eo(o,r.fetcher,r.params)}throw Error("Invalid resource schema")}function ed(){var t=tE(),e=a(function(e){return e.make(t)},[t]);return{core:t,make:e}}function eh(t,e,r,n,o,i,u){try{var a=t[i](u),c=a.value}catch(l){r(l);return}a.done?e(c):Promise.resolve(c).then(n,o)}function ev(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var i=t.apply(e,r);function u(t){eh(i,n,o,u,a,"next",t)}function a(t){eh(i,n,o,u,a,"throw",t)}u(void 0)})}}function ep(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ey(t,e,r){return e&&ep(t.prototype,e),r&&ep(t,r),t}function eb(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(r)return(r=r.call(t)).next.bind(r);if(Array.isArray(t)||(r=unsupportedIterableToArray(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0;return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}}}throw TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var em=function(t,e){var r,n,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw TypeError("Generator is already executing.");for(;u;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,n=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=e.call(t,u)}catch(a){i=[6,a],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};function ew(t){var e=n();return void 0===e.current&&(e.current=new eg(t)),o(function(){return function(){var t;null==(t=e.current)||t.unmount()}},[]),e.current}var eg=function(){function t(t){var e=this;this.name=t,this.async=!0,this.keys=new Set,"undefined"!=typeof indexedDB&&(this.initialization=this.load(),this.onunload=function(){return e.unload()},addEventListener("beforeunload",this.onunload))}var e=t.prototype;return e.load=function(){var t=this;return ev(function(){var e,r;return em(this,function(r){switch(r.label){case 0:if("undefined"==typeof indexedDB)return[2];return[4,new Promise(function(e,r){var n=indexedDB.open(t.name,1);n.onupgradeneeded=function(){return n.result.createObjectStore("keyval",{})},n.onblocked=function(){return r("blocked")},n.onsuccess=function(){return e(n.result)},n.onerror=function(){return r(n.error)}})];case 1:if(t._database=r.sent(),"undefined"==typeof Storage||!(e=localStorage.getItem("idb."+t.name+".keys")))return[2];return JSON.parse(e).forEach(function(e){return t.keys.add(e)}),localStorage.removeItem("idb."+t.name+".keys"),[4,t.collect().catch(console.error)];case 2:return r.sent(),[2]}})})()},e.unmount=function(){"undefined"!=typeof indexedDB&&(void 0!==this.onunload&&removeEventListener("beforeunload",this.onunload),this.collect().catch(console.error))},e.unload=function(){if("undefined"!=typeof Storage){var t=JSON.stringify([].concat(this.keys));localStorage.setItem("idb."+this.name+".keys",t)}},e.collect=function(){var t=this;return ev(function(){var e,r,n,o;return em(this,function(i){switch(i.label){case 0:if("undefined"==typeof indexedDB)return[2];e=eb(t.keys),i.label=1;case 1:if((r=e()).done)return[3,4];return n=r.value,[4,t.get(n,!0)];case 2:if((null==(o=i.sent())?void 0:o.expiration)===void 0||o.expiration>Date.now())return[3,3];t.delete(n,!1),i.label=3;case 3:return[3,1];case 4:return[2]}})})()},e.transact=function(t,e){var r=this;return ev(function(){return em(this,function(n){switch(n.label){case 0:if("undefined"==typeof indexedDB)return[2];if(void 0!==r.database)return[3,2];return[4,r.initialization];case 1:n.sent(),n.label=2;case 2:return[4,new Promise(function(n,o){if(void 0===r.database)throw Error("Undefined database");var i,u=r.database.transaction("keyval",e);u.onerror=function(){return o(u.error)},u.oncomplete=function(){return n(i)},t(u.objectStore("keyval")).then(function(t){return i=t}).then(function(){return u.commit()}).catch(o)})];case 3:return[2,n.sent()]}})})()},e.get=function(t,e){void 0===e&&(e=!1);var r=this;return ev(function(){return em(this,function(n){switch(n.label){case 0:if("undefined"==typeof indexedDB)return[2];return e||r.keys.has(t)||r.keys.add(t),[4,r.transact(ev(function(e){return em(this,function(r){switch(r.label){case 0:return[4,new Promise(function(r,n){var o=e.get(t);o.onerror=function(){return n(o.error)},o.onsuccess=function(){return r(o.result)}})];case 1:return[2,r.sent()]}})}),"readonly")];case 1:return[2,n.sent()]}})})()},e.set=function(t,e,r){void 0===r&&(r=!1);var n=this;return ev(function(){return em(this,function(o){switch(o.label){case 0:if("undefined"==typeof indexedDB)return[2];return r||n.keys.has(t)||n.keys.add(t),[4,n.transact(ev(function(r){return em(this,function(n){switch(n.label){case 0:return[4,new Promise(function(n,o){var i=r.put(e,t);i.onerror=function(){return o(i.error)},i.onsuccess=function(){return n()}})];case 1:return[2,n.sent()]}})}),"readwrite")];case 1:return[2,o.sent()]}})})()},e.delete=function(t,e){void 0===e&&(e=!1);var r=this;return ev(function(){return em(this,function(n){switch(n.label){case 0:if("undefined"==typeof indexedDB)return[2];return!e&&r.keys.has(t)&&r.keys.delete(t),[4,r.transact(ev(function(e){return em(this,function(r){switch(r.label){case 0:return[4,new Promise(function(r,n){var o=e.delete(t);o.onerror=function(){return n(o.error)},o.onsuccess=function(){return r()}})];case 1:return[2,r.sent()]}})}),"readwrite")];case 1:return[2,n.sent()]}})})()},ey(t,[{key:"database",get:function(){return this._database}}]),t}();function ek(t,e,r,n,o,i,u){try{var a=t[i](u),c=a.value}catch(l){r(l);return}a.done?e(c):Promise.resolve(c).then(n,o)}function eS(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var i=t.apply(e,r);function u(t){ek(i,n,o,u,a,"next",t)}function a(t){ek(i,n,o,u,a,"throw",t)}u(void 0)})}}function ex(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(r)return(r=r.call(t)).next.bind(r);if(Array.isArray(t)||(r=unsupportedIterableToArray(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0;return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}}}throw TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var eE=function(t,e){var r,n,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw TypeError("Generator is already executing.");for(;u;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,n=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=e.call(t,u)}catch(a){i=[6,a],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};function e_(t,e){var r=n();return void 0===r.current&&(r.current=new eO(t,e)),o(function(){return function(){var t;null==(t=r.current)||t.unmount()}},[]),r.current}var eO=function(){function t(t,e){void 0===t&&(t="xswr:"),void 0===e&&(e=JSON);var r=this;this.prefix=t,this.serializer=e,this.async=!0,this.keys=new Set,"undefined"!=typeof Storage&&(this.onunload=function(){return r.collect()},addEventListener("beforeunload",this.onunload))}var e=t.prototype;return e.unmount=function(){if("undefined"!=typeof Storage){this.onunload&&removeEventListener("beforeunload",this.onunload);var t=this;eS(function(){return eE(this,function(e){return[2,t.collect()]})})().catch(console.error)}},e.collect=function(){if("undefined"!=typeof Storage)for(var t,e=ex(this.keys);!(t=e()).done;){var r=t.value,n=this.getSync(r,!0);(null==n?void 0:n.expiration)!==void 0&&(n.expiration>Date.now()||this.delete(r,!1))}},e.getSync=function(t,e){if(void 0===e&&(e=!1),"undefined"!=typeof Storage){e||this.keys.has(t)||this.keys.add(t);var r=localStorage.getItem(this.prefix+t);if(r)return this.serializer.parse(r)}},e.get=function(t,e){void 0===e&&(e=!1);var r=this;return eS(function(){var n;return eE(this,function(o){return"undefined"==typeof Storage?[2]:(e||r.keys.has(t)||r.keys.add(t),n=localStorage.getItem(r.prefix+t))?[2,r.serializer.parse(n)]:[2]})})()},e.set=function(t,e,r){void 0===r&&(r=!1);var n=this;return eS(function(){var o;return eE(this,function(i){return"undefined"==typeof Storage||(r||n.keys.has(t)||n.keys.add(t),o=n.serializer.stringify(e),localStorage.setItem(n.prefix+t,o)),[2]})})()},e.delete=function(t,e){void 0===e&&(e=!1);var r=this;return eS(function(){return eE(this,function(n){return"undefined"==typeof Storage||(!e&&r.keys.has(t)&&r.keys.delete(t),localStorage.removeItem(r.prefix+t)),[2]})})()},t}();function eP(t,e,r,n,o,i,u){try{var a=t[i](u),c=a.value}catch(l){r(l);return}a.done?e(c):Promise.resolve(c).then(n,o)}function ej(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var i=t.apply(e,r);function u(t){eP(i,n,o,u,a,"next",t)}function a(t){eP(i,n,o,u,a,"throw",t)}u(void 0)})}}function eA(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(r)return(r=r.call(t)).next.bind(r);if(Array.isArray(t)||(r=unsupportedIterableToArray(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0;return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}}}throw TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var eT=function(t,e){var r,n,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw TypeError("Generator is already executing.");for(;u;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,n=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=e.call(t,u)}catch(a){i=[6,a],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};function eI(t,e){var r=n();return r.current||(r.current=new eD(t,e)),o(function(){return function(){var t;null==(t=r.current)||t.unmount()}},[]),r.current}var eD=function(){function t(t,e){void 0===t&&(t="xswr:"),void 0===e&&(e=JSON);var r=this;this.prefix=t,this.serializer=e,this.async=!1,this.keys=new Set,"undefined"!=typeof Storage&&(this.onunload=function(){return r.collect()},addEventListener("beforeunload",this.onunload))}var e=t.prototype;return e.unmount=function(){if("undefined"!=typeof Storage){removeEventListener("beforeunload",this.onunload);var t=this;ej(function(){return eT(this,function(e){return[2,t.collect()]})})().catch(console.error)}},e.collect=function(){if("undefined"!=typeof Storage)for(var t,e=eA(this.keys);!(t=e()).done;){var r=t.value,n=this.get(r,!0);(null==n?void 0:n.expiration)!==void 0&&(n.expiration>Date.now()||this.delete(r,!1))}},e.get=function(t,e){if(void 0===e&&(e=!1),"undefined"!=typeof Storage){e||this.keys.has(t)||this.keys.add(t);var r=localStorage.getItem(this.prefix+t);if(r)return this.serializer.parse(r)}},e.set=function(t,e,r){if(void 0===r&&(r=!1),"undefined"!=typeof Storage){r||this.keys.has(t)||this.keys.add(t);var n=this.serializer.stringify(e);localStorage.setItem(this.prefix+t,n)}},e.delete=function(t,e){void 0===e&&(e=!1),"undefined"!=typeof Storage&&(!e&&this.keys.has(t)&&this.keys.delete(t),localStorage.removeItem(this.prefix+t))},t}(),eN={__proto__:null,Core:tk,AbortError:k,isAbortError:S,CoreContext:tx,useCore:tE,useCoreProvider:t_,CoreProvider:tO,useDebug:tP,useError:tj,useFallback:tA,useFetch:tT,useInterval:tI,useMount:tD,useOnce:tN,useOnline:tL,useRetry:tz,useVisible:tC,use:ef,useScroll:eo,useSingle:el,useXSWR:ed,ScrollHelper:J,getScrollStorageKey:tq,ScrollObject:tW,scroll:tQ,ScrollSchema:tV,SingleHelper:tr,getSingleStorageKey:t4,SingleObject:t3,single:t8,SingleSchema:t9,useIDBStorage:ew,IDBStorage:eg,useAsyncLocalStorage:e_,AsyncLocalStorage:eO,useSyncLocalStorage:eI,SyncLocalStorage:eD,isAsyncStorage:tn,DEFAULT_EQUALS:j,DEFAULT_SERIALIZER:A,DEFAULT_COOLDOWN:T,DEFAULT_EXPIRATION:I,DEFAULT_TIMEOUT:D,refEquals:_,jsonEquals:O,shallowEquals:P};export{eN as XSWR};
