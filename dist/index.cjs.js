var e=require("react");function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=t(e);function n(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o=function(){function e(){this.map=new Map}var t=e.prototype;return t.get=function(e){return this.map.get(e)},t.push=function(e,t){var r=this.map.get(e);r?r.push(t):this.map.set(e,[t])},t.erase=function(e,t){var r=this.map.get(e);if(r){var n=r.filter(function(e){return e!==t});n.length?this.map.set(e,n):this.map.delete(e)}},e}(),i=function(){function e(){this.listeners=new o}var t=e.prototype;return t.publish=function(e,t){var r=this.listeners.get(e);if(r)for(var o,i=n(r);!(o=i()).done;)(0,o.value)(t)},t.on=function(e,t){this.listeners.push(e,t)},t.off=function(e,t){this.listeners.erase(e,t)},e}();function u(e){if(e.length)return e[e.length-1]}function a(e){if(-1!==e)return Date.now()+e}function c(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function s(e,t,r){return(s=c()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var o=new(Function.bind.apply(e,n));return r&&v(o,r.prototype),o}).apply(null,arguments)}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}function d(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function h(e){return -1!==Function.toString.call(e).indexOf("[native code]")}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function p(e){var t="function"==typeof Map?new Map:void 0;return(p=function(e){if(null===e||!h(e))return e;if("function"!=typeof e)throw TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return s(e,arguments,l(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),v(r,e)})(e)}var b=function(e){function t(t){return e.call(this,"Aborted: "+t.reason,{cause:t})}return f(t,e),t}(p(Error));function y(e){return!!(d(e,b)||d(e,DOMException)&&"AbortError"===e.name)}var m=function(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};function w(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function g(e,t){return e===t}function k(e,t){return e===t||(void 0===e?"undefined":m(e))===(void 0===t?"undefined":m(t))&&JSON.stringify(e)===JSON.stringify(t)}function S(e,t){if(e===t)return!0;if((void 0===e?"undefined":m(e))!==(void 0===t?"undefined":m(t)))return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(var o,i=w(r);!(o=i()).done;){var u=o.value;if(e[u]!==t[u])return!1}return!0}var x=k,E=JSON,_=1e3,O=-1,P=5e3;function j(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function A(e){if(Array.isArray(e))return j(e)}function T(e,t,r,n,o,i,u){try{var a=e[i](u),c=a.value}catch(s){r(s);return}a.done?t(c):Promise.resolve(c).then(n,o)}function I(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function u(e){T(i,n,o,u,a,"next",e)}function a(e){T(i,n,o,u,a,"throw",e)}u(void 0)})}}function R(){return(R=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function D(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function C(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function N(e){return A(e)||D(e)||L(e)||C()}function L(e,t){if(e){if("string"==typeof e)return j(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return j(e,t)}}var z=function(e,t){var r,n,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw TypeError("Generator is already executing.");for(;u;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,n=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=t.call(e,u)}catch(a){i=[6,a],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},M=function(){function e(e){this.core=e}var t=e.prototype;return t.first=function(e,t,r,n,o,i,u){void 0===n&&(n=new AbortController),void 0===o&&(o={}),void 0===i&&(i=!1),void 0===u&&(u=!1);var c=this;return I(function(){var s,l,f,d,h,v,p,y,m,w,g,k,S,E,j,A,T,D,C,N,L,M,U,F,B,G,J;return z(this,function(k){switch(k.label){case 0:if(void 0===e)return[2];return[4,c.core.lock(e,I(function(){var r,a;return z(this,function(s){switch(s.label){case 0:return[4,c.core.get(e,o)];case 1:if((null==(r=s.sent())?void 0:r.optimistic)||(null==r?void 0:r.aborter)&&!i||((null==r?void 0:r.aborter)&&i&&r.aborter.abort("Replaced"),c.core.shouldCooldown(r)&&!u||void 0===(a=t(void 0))))return[2,{current:r,skip:!0}];return[4,c.core.mutate(e,r,function(e){return{time:null==e?void 0:e.time,aborter:n}},o)];case 2:return[2,{current:r=s.sent(),first:a}]}})}))];case 1:if(l=(s=k.sent()).current,f=s.skip,d=s.first,f)return[2,l];if(void 0===d)throw Error("Undefined first");v=void 0===(h=o.equals)?x:h,y=void 0===(p=o.cooldown)?_:p,w=void 0===(m=o.expiration)?O:m,S=setTimeout(function(){n.abort("First timed out")},void 0===(g=o.timeout)?P:g),k.label=2;case 2:return k.trys.push([2,8,11,12]),[4,r(d,{signal:E=n.signal})];case 3:if(A=(j=k.sent()).data,T=j.error,C=void 0===(D=j.time)?Date.now():D,L=void 0===(N=j.cooldown)?a(y):N,U=void 0===(M=j.expiration)?a(w):M,E.aborted)throw new b(E);return[4,c.core.get(e,o)];case 4:if(l=k.sent(),F={},void 0!==A&&(F.data=[A]),F.error=T,!(void 0!==A))return[3,6];return[4,c.core.normalize(!0,{data:[A]},o)];case 5:v(null==(G=k.sent())?void 0:G[0],null==l?void 0:null==(B=l.data)?void 0:B[0])&&delete F.data,k.label=6;case 6:return[4,c.core.mutate(e,l,function(){return R({time:C,cooldown:L,expiration:U,aborter:void 0},F)},o)];case 7:case 10:return[2,k.sent()];case 8:return J=k.sent(),[4,c.core.get(e,o)];case 9:if((null==(l=k.sent())?void 0:l.aborter)!==n)return[2,l];return[4,c.core.mutate(e,l,function(){return{aborter:void 0,error:J}},o)];case 11:return clearTimeout(S),[7];case 12:return[2]}})})()},t.scroll=function(e,t,r,n,o,i,c){void 0===n&&(n=new AbortController),void 0===o&&(o={}),void 0===i&&(i=!1),void 0===c&&(c=!1);var s=this;return I(function(){var l,f,d,h,v,p,y,m,w,g,k,S,x,E,j,A,T,D,C,L,M,U,F,B;return z(this,function(g){switch(g.label){case 0:if(void 0===e)return[2];return[4,s.core.lock(e,I(function(){var r,a,l,f;return z(this,function(l){switch(l.label){case 0:return[4,s.core.get(e,o)];case 1:if((null==(r=l.sent())?void 0:r.optimistic)||(null==r?void 0:r.aborter)&&!i||((null==r?void 0:r.aborter)&&i&&r.aborter.abort("Replaced"),s.core.shouldCooldown(r)&&!c||void 0===(f=t(u(null!=(a=null==r?void 0:r.data)?a:[])))))return[2,{current:r,skip:!0}];return[4,s.core.mutate(e,r,function(e){return{time:null==e?void 0:e.time,aborter:n}},o)];case 2:return[2,{current:r=l.sent(),last:f}]}})}))];case 1:if(f=(l=g.sent()).current,d=l.skip,h=l.last,d)return[2,f];if(void 0===h)throw Error("Undefined last");p=void 0===(v=o.cooldown)?_:v,m=void 0===(y=o.expiration)?O:y,k=setTimeout(function(){n.abort("Scroll timed out")},void 0===(w=o.timeout)?P:w),g.label=2;case 2:return g.trys.push([2,6,9,10]),[4,r(h,{signal:S=n.signal})];case 3:if(E=(x=g.sent()).data,j=x.error,T=void 0===(A=x.time)?Date.now():A,C=void 0===(D=x.cooldown)?a(p):D,M=void 0===(L=x.expiration)?a(m):L,S.aborted)throw new b(S);return void 0!==M&&(null==f?void 0:f.expiration)!==void 0&&(M=Math.min(M,null==f?void 0:f.expiration)),[4,s.core.get(e,o)];case 4:return f=g.sent(),U={},void 0!==E&&(U.data=N(null!=(F=null==f?void 0:f.data)?F:[]).concat([E])),U.error=j,[4,s.core.mutate(e,f,function(){return R({time:T,cooldown:C,expiration:M,aborter:void 0},U)},o)];case 5:case 8:return[2,g.sent()];case 6:return B=g.sent(),[4,s.core.get(e,o)];case 7:if((null==(f=g.sent())?void 0:f.aborter)!==n)return[2,f];return[4,s.core.mutate(e,f,function(){return{aborter:void 0,error:B}},o)];case 9:return clearTimeout(k),[7];case 10:return[2]}})})()},e}();function U(e,t,r,n,o,i,u){try{var a=e[i](u),c=a.value}catch(s){r(s);return}a.done?t(c):Promise.resolve(c).then(n,o)}function F(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function u(e){U(i,n,o,u,a,"next",e)}function a(e){U(i,n,o,u,a,"throw",e)}u(void 0)})}}var B=function(e,t){var r,n,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw TypeError("Generator is already executing.");for(;u;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,n=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=t.call(e,u)}catch(a){i=[6,a],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};function G(e){return J.apply(this,arguments)}function J(){return(J=F(function(e){var t;return B(this,function(r){switch(r.label){case 0:return[4,e.next()];case 1:if((t=r.sent()).done)return[2,t.value];return[2]}})})).apply(this,arguments)}function q(e){var t,r,n,o=2;for("undefined"!=typeof Symbol&&(r=Symbol.asyncIterator,n=Symbol.iterator);o--;){if(r&&null!=(t=e[r]))return t.call(e);if(n&&null!=(t=e[n]))return new W(t.call(e));r="@@asyncIterator",n="@@iterator"}throw TypeError("Object is not async iterable")}function W(e){function t(e){if(Object(e)!==e)return Promise.reject(TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then(function(e){return{value:e,done:t}})}return(W=function(e){this.s=e,this.n=e.next}).prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var r=this.s.return;return void 0===r?Promise.resolve({value:e,done:!0}):t(r.apply(this.s,arguments))},throw:function(e){var r=this.s.return;return void 0===r?Promise.reject(e):t(r.apply(this.s,arguments))}},new W(e)}function X(e,t,r,n,o,i,u){try{var a=e[i](u),c=a.value}catch(s){r(s);return}a.done?t(c):Promise.resolve(c).then(n,o)}function H(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function u(e){X(i,n,o,u,a,"next",e)}function a(e){X(i,n,o,u,a,"throw",e)}u(void 0)})}}function K(){return(K=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var Q=function(e,t){var r,n,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw TypeError("Generator is already executing.");for(;u;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,n=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=t.call(e,u)}catch(a){i=[6,a],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},V=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Z=function(){function e(e){this.core=e}var t=e.prototype;return t.fetch=function(e,t,r,n,o,i,u){void 0===n&&(n=new AbortController),void 0===o&&(o={}),void 0===i&&(i=!1),void 0===u&&(u=!1);var c=this;return H(function(){var s,l,f,d,h,v,p,y,m,w,g,k,S,x,E,j,A,T,I,R,D,C;return Q(this,function(f){switch(f.label){case 0:if(void 0===e||void 0===t)return[2];return[4,c.core.lock(t,H(function(){var e;return Q(this,function(r){switch(r.label){case 0:return[4,c.core.get(t,o)];case 1:if((null==(e=r.sent())?void 0:e.optimistic)||(null==e?void 0:e.aborter)&&!i||((null==e?void 0:e.aborter)&&i&&e.aborter.abort("Replaced"),c.core.shouldCooldown(e)&&!u))return[2,{current:e,skip:!0}];return[4,c.core.mutate(t,e,function(e){return{time:null==e?void 0:e.time,aborter:n}},o)];case 2:return[2,{current:e=r.sent()}]}})}))];case 1:if(l=(s=f.sent()).current,s.skip)return[2,l];h=void 0===(d=o.cooldown)?_:d,p=void 0===(v=o.expiration)?O:v,w=setTimeout(function(){n.abort("Fetch timed out")},void 0===(y=o.timeout)?P:y),f.label=2;case 2:return f.trys.push([2,6,9,10]),[4,r(e,{signal:g=n.signal})];case 3:if(S=(k=f.sent()).data,x=k.error,j=void 0===(E=k.time)?Date.now():E,T=void 0===(A=k.cooldown)?a(h):A,R=void 0===(I=k.expiration)?a(p):I,g.aborted)throw new b(g);return[4,c.core.get(t,o)];case 4:return l=f.sent(),D={},void 0!==S&&(D.data=S),D.error=x,[4,c.core.mutate(t,l,function(){return K({time:j,cooldown:T,expiration:R,aborter:void 0},D)},o)];case 5:case 8:return[2,f.sent()];case 6:return C=f.sent(),[4,c.core.get(t,o)];case 7:if((null==(l=f.sent())?void 0:l.aborter)!==n)return[2,l];return[4,c.core.mutate(t,l,function(){return{aborter:void 0,error:C}},o)];case 9:return clearTimeout(w),[7];case 10:return[2]}})})()},t.update=function(e,t,r,n,o,i){void 0===o&&(o=new AbortController),void 0===i&&(i={});var u=this;return H(function(){var c,s,l,f,d,h,v,p,y,m,w,g,k,S,x,E,j,A,T,I,R,D,C,N,L,z,M,U,F,B;return Q(this,function(l){switch(l.label){case 0:if(void 0===e||void 0===t)return[2];return[4,u.core.lock(t,H(function(){var e;return Q(this,function(r){switch(r.label){case 0:return[4,u.core.get(t,i)];case 1:if(null==(e=r.sent())?void 0:e.optimistic)return[2,{current:e,skip:!0}];return(null==e?void 0:e.aborter)&&e.aborter.abort("Replaced"),[4,u.core.mutate(t,e,function(e){return{time:null==e?void 0:e.time,aborter:o,optimistic:!0}},i)];case 2:return[2,{current:e=r.sent()}]}})}))];case 1:if(s=(c=l.sent()).current,c.skip)return[2,s];d=void 0===(f=i.cooldown)?_:f,v=void 0===(h=i.expiration)?O:h,m=setTimeout(function(){o.abort("Update timed out")},void 0===(p=i.timeout)?P:p),l.label=2;case 2:l.trys.push([2,23,26,27]),g=n(s,{signal:w=o.signal}),k=!1,S=!1,l.label=3;case 3:l.trys.push([3,9,10,15]),E=function(){var e,r,n,a;return Q(this,function(c){switch(c.label){case 0:if(r=(e=A.value).data,n=e.error,w.aborted)throw new b(w);return a={},void 0!==r&&(a.data=r),a.error=n,[4,u.core.mutate(t,s,function(e){return K({time:null==e?void 0:e.time,aborter:o,optimistic:!0},a)},i)];case 1:return s=c.sent(),[2]}})},j=q(g),l.label=4;case 4:return[4,j.next()];case 5:if(!(k=!(A=l.sent()).done))return[3,8];return[5,V(E())];case 6:l.sent(),l.label=7;case 7:return k=!1,[3,4];case 8:return[3,15];case 9:return T=l.sent(),S=!0,x=T,[3,15];case 10:if(l.trys.push([10,,13,14]),!(k&&null!=j.return))return[3,12];return[4,j.return()];case 11:l.sent(),l.label=12;case 12:return[3,14];case 13:if(S)throw x;return[7];case 14:return[7];case 15:return[4,G(g)];case 16:if(void 0!==(I=l.sent()))return[3,18];if(void 0===r)throw Error("Updater returned nothing and undefined fetcher");return[4,r(e,{signal:w,cache:"reload"})];case 17:I=l.sent(),l.label=18;case 18:if(R=I.data,D=I.error,N=void 0===(C=I.time)?Date.now():C,z=void 0===(L=I.cooldown)?a(d):L,U=void 0===(M=I.expiration)?a(v):M,w.aborted)throw new b(w);return[4,u.core.get(t,i)];case 19:if(s=l.sent(),!(void 0!==D))return[3,21];if((null==s?void 0:s.aborter)!==o)return[2,s];return[4,u.core.mutate(t,s,function(e){return{time:null==e?void 0:e.time,cooldown:z,expiration:U,aborter:void 0,optimistic:!1,data:null==e?void 0:e.data,error:D}},i)];case 20:case 22:case 25:return[2,l.sent()];case 21:return F={},void 0!==R&&(F.data=R),F.error=D,[4,u.core.mutate(t,s,function(){return K({time:N,cooldown:z,expiration:U,aborter:void 0,optimistic:!1},F)},i)];case 23:return B=l.sent(),[4,u.core.get(t,i)];case 24:if((null==(s=l.sent())?void 0:s.aborter)!==o)return[2,s];return[4,u.core.mutate(t,s,function(e){return{time:null==e?void 0:e.time,aborter:void 0,optimistic:!1,data:null==e?void 0:e.data,error:B}},i)];case 26:return clearTimeout(m),[7];case 27:return[2]}})})()},e}();function $(e){return Boolean(e.async)}function Y(e,t,r,n,o,i,u){try{var a=e[i](u),c=a.value}catch(s){r(s);return}a.done?t(c):Promise.resolve(c).then(n,o)}function ee(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function u(e){Y(i,n,o,u,a,"next",e)}function a(e){Y(i,n,o,u,a,"throw",e)}u(void 0)})}}var et=function(e,t){var r,n,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw TypeError("Generator is already executing.");for(;u;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,n=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=t.call(e,u)}catch(a){i=[6,a],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},er=function(){function e(){}return e.prototype.lock=function(e){var t=this;return ee(function(){var r;return et(this,function(n){switch(n.label){case 0:if(!t.mutex)return[3,2];return[4,t.mutex];case 1:n.sent(),n.label=2;case 2:return r=e(),t.mutex=r,[4,r];case 3:return[2,n.sent()]}})})()},e}();function en(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function eo(e,t,r,n,o,i,u){try{var a=e[i](u),c=a.value}catch(s){r(s);return}a.done?t(c):Promise.resolve(c).then(n,o)}function ei(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function u(e){eo(i,n,o,u,a,"next",e)}function a(e){eo(i,n,o,u,a,"throw",e)}u(void 0)})}}function eu(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ea(e,t,r){return t&&eu(e.prototype,t),r&&eu(e,r),e}function ec(){return(ec=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function es(e,t,r){return(es="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=eh(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function el(e){return(el=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ef(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ed(e,t)}function ed(e,t){return(ed=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function eh(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=el(e)););return e}function ev(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var ep=function(e,t){var r,n,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw TypeError("Generator is already executing.");for(;u;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,n=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=t.call(e,u)}catch(a){i=[6,a],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},eb=function(e){function t(t){var r;return(r=e.call(this)||this).params=t,r.single=new Z(en(r)),r.scroll=new M(en(r)),r.cache=new Map,r.locks=new Map,r._mounted=!0,r.counts=new Map,r.timeouts=new Map,r}ef(t,e);var r=t.prototype;return r.unmount=function(){for(var e,t=ev(this.timeouts.values());!(e=t()).done;)clearTimeout(e.value);this._mounted=!1},r.lock=function(e,t){var r=this;return ei(function(){var n,o;return ep(this,function(i){switch(i.label){case 0:if(!(void 0!==(n=r.locks.get(e))))return[3,2];return[4,n.lock(t)];case 1:case 3:return[2,i.sent()];case 2:return o=new er,r.locks.set(e,o),[4,o.lock(t)]}})})()},r.getSync=function(e,t){if(void 0===t&&(t={}),void 0!==e){var r=this.cache.get(e);if(void 0!==r)return r;var n=t.storage;if(n){if($(n))return null;var o=n.get(e);return this.cache.set(e,o),o}}},r.get=function(e,t,r){void 0===t&&(t={}),void 0===r&&(r=!1);var n=this;return ei(function(){var o,i,u;return ep(this,function(a){switch(a.label){case 0:if(void 0===e)return[2];if(void 0!==(o=n.cache.get(e)))return[2,o];if(!(i=t.storage))return[2];return[4,i.get(e,r)];case 1:return u=a.sent(),n.cache.set(e,u),[2,u]}})})()},r.set=function(e,t,r){void 0===r&&(r={});var n=this;return ei(function(){var o,i,u,a,c;return ep(this,function(s){switch(s.label){case 0:if(void 0===e||(n.cache.set(e,t),n.publish(e,t),!(o=r.storage)))return[2];return i=t.data,u=t.time,a=t.cooldown,c=t.expiration,[4,o.set(e,{data:i,time:u,cooldown:a,expiration:c})];case 1:return s.sent(),[2]}})})()},r.delete=function(e,t){void 0===t&&(t={});var r=this;return ei(function(){var n;return ep(this,function(o){switch(o.label){case 0:if(!e||(r.cache.delete(e),r.locks.delete(e),r.publish(e,void 0),!(n=t.storage)))return[2];return[4,n.delete(e)];case 1:return o.sent(),[2]}})})()},r.mutate=function(e,t,r,n){void 0===n&&(n={});var o=this;return ei(function(){var i,u,a,c,s;return ep(this,function(l){switch(l.label){case 0:if(void 0===e)return[2];if(i=r(t))return[3,2];return[4,o.delete(e,n)];case 1:return l.sent(),[2];case 2:if(void 0!==i.time&&i.time<(null!=(u=null==t?void 0:t.time)?u:0)||void 0===i.optimistic&&(null==t?void 0:t.optimistic))return[2,t];return c=void 0===(a=n.equals)?x:a,s=ec({},t,i),[4,o.normalize(!1,s,n)];case 3:if(s.data=l.sent(),void 0===s.time&&(s.time=Date.now()),c(s.data,null==t?void 0:t.data)&&(s.data=null==t?void 0:t.data),s.optimistic||(s.realData=s.data),S(s,t))return[2,t];return[4,o.set(e,s,n)];case 4:return l.sent(),[2,s]}})})()},r.normalize=function(e,t,r){void 0===r&&(r={});var n=this;return ei(function(){return ep(this,function(o){switch(o.label){case 0:if(void 0===t.data)return[2];if(void 0===r.normalizer)return[2,t.data];return[4,r.normalizer(t.data,{core:n,shallow:e,root:t})];case 1:return[2,o.sent()]}})})()},r.shouldCooldown=function(e){return(null==e?void 0:e.cooldown)!==void 0&&Date.now()<e.cooldown},r.once=function(e,t,r){void 0===r&&(r={});var n=this;if(e){var o=function(i){n.off(e,o,r),t(i)};this.on(e,o,r)}},r.on=function(e,r,n){if(e){es(t.prototype,"on",this).call(this,e,r);var o,i=null!=(o=this.counts.get(e))?o:0;this.counts.set(e,i+1);var u=this.timeouts.get(e);void 0!==u&&(clearTimeout(u),this.timeouts.delete(e))}},r.off=function(e,r,n){void 0===n&&(n={});var o=this,i=this;return ei(function(){var u,a,c,s,l;return ep(this,function(s){switch(s.label){case 0:if(!e)return[2];if(es(t.prototype,"off",o).call(i,e,r),void 0===(u=i.counts.get(e)))throw Error("Undefined count");if(u>1)return i.counts.set(e,u-1),[2];return i.counts.delete(e),[4,i.get(e,n,!0)];case 1:if((null==(a=s.sent())?void 0:a.expiration)===void 0||(null==a?void 0:a.expiration)===-1)return[2];if(c=ei(function(){var t;return ep(this,function(t){switch(t.label){case 0:if(!i._mounted||void 0!==i.counts.get(e))return[2];return i.timeouts.delete(e),[4,i.delete(e,n)];case 1:return t.sent(),[2]}})}),!(Date.now()>a.expiration))return[3,3];return[4,c()];case 2:return s.sent(),[2];case 3:return l=setTimeout(c,a.expiration-Date.now()),i.timeouts.set(e,l),[2]}})})()},ea(t,[{key:"mounted",get:function(){return this._mounted}}]),t}(i);function ey(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}var em=e.createContext(void 0);function ew(){var t=e.useContext(em);if(void 0===t)throw Error("Undefined core");return t}function eg(t){var r=e.useRef();return void 0===r.current&&(r.current=new eb(t)),e.useEffect(function(){return function(){var e;null==(e=r.current)||e.unmount()}},[]),r.current}function ek(e){var t=e.children,n=eg(ey(e,["children"]));return r.default.createElement(em.Provider,{value:n},t)}function eS(t,r){var n=t.data,o=t.error,i=t.time;e.useEffect(function(){console.debug(r,t)},[n,o,i])}function ex(t,r){var n=t.error;e.useEffect(function(){void 0!==n&&r(n)},[n])}function eE(e,t){var r=e.data,n=e.error;void 0===r&&void 0===n&&Object.assign(e,t)}function e_(t){var r=t.fetch;e.useEffect(function(){r()},[r])}function eO(t,r){var n=t.ready,o=t.fetch;e.useEffect(function(){if(n&&r){var e=setInterval(o,r);return function(){return clearInterval(e)}}},[o,r])}function eP(t){var r=t.fetch;e.useEffect(function(){r()},[])}function ej(t){var r=t.data,n=t.fetch;e.useEffect(function(){void 0===r&&n()},[r,n])}function eA(t){var r=e.useRef(t);return r.current=t,r}function eT(t){var r=t.ready,n=eA(t.fetch);e.useEffect(function(){if(r){var e=function(){return n.current()};return addEventListener("online",e),function(){return removeEventListener("online",e)}}},[r])}function eI(t,r){void 0===r&&(r={});var n=t.ready,o=t.skey,i=t.refetch,u=t.error,a=r.init,c=void 0===a?1e3:a,s=r.base,l=void 0===s?2:s,f=r.max,d=void 0===f?3:f,h=e.useRef(0);e.useEffect(function(){h.current=0},[o]);var v=eA(i);e.useEffect(function(){var e=function(){h.current++,v.current()};if(n){if(void 0===u){h.current=0;return}if(!(h.current>=d)){var t=setTimeout(e,c*Math.pow(l,h.current));return function(){return clearTimeout(t)}}}},[n,u])}function eR(t){var r=t.ready,n=eA(t.fetch);e.useEffect(function(){if(r){var e=function(){return!document.hidden&&n.current()};return document.addEventListener("visibilitychange",e),function(){return document.removeEventListener("visibilitychange",e)}}},[r])}function eD(e,t,r,n,o,i,u){try{var a=e[i](u),c=a.value}catch(s){r(s);return}a.done?t(c):Promise.resolve(c).then(n,o)}function eC(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function u(e){eD(i,n,o,u,a,"next",e)}function a(e){eD(i,n,o,u,a,"throw",e)}u(void 0)})}}function eN(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function eL(e,t,r){return t&&eN(e.prototype,t),r&&eN(e,r),e}function ez(){return(ez=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var eM=function(e,t){var r,n,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw TypeError("Generator is already executing.");for(;u;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,n=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=t.call(e,u)}catch(a){i=[6,a],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};function eU(e,t){if(void 0!==e){if("string"==typeof e)return e;var r=t.serializer;return"scroll:"+(void 0===r?E:r).stringify(e)}}var eF=function(){function e(e,t,r,n){void 0===n&&(n={}),this.core=e,this.scroller=t,this.fetcher=r,this.params=n,this.mparams=ez({},e.params,n),this.key=t(),this.skey=eU(this.key,this.mparams),this.loadSync(),this.subscribe()}var t=e.prototype;return t.loadSync=function(){var e=this.core,t=this.skey,r=this.mparams;this._state=e.getSync(t,r)},t.loadAsync=function(){var e=this;return eC(function(){var t,r,n;return eM(this,function(o){switch(o.label){case 0:if(e.ready)return[2];return t=e.core,r=e.skey,n=e.mparams,[4,t.get(r,n)];case 1:return e._state=o.sent(),[2]}})})()},t.subscribe=function(){var e=this,t=this.core,r=this.skey,n=function(t){return e._state=t};t.on(r,n),new FinalizationRegistry(function(){t.off(r,n)}).register(this,void 0)},t.mutate=function(e){var t=this;return eC(function(){var r,n,o,i;return eM(this,function(u){switch(u.label){case 0:if(r=t.core,n=t.skey,o=t.mparams,null!==t._state)return[3,2];return[4,null!=(i=t._init)?i:t._init=t.loadAsync()];case 1:u.sent(),u.label=2;case 2:if(null===t._state)throw Error("Null state after init");return[4,r.mutate(n,t._state,e,o)];case 3:return[2,t._state=u.sent()]}})})()},t.fetch=function(e){var t=this;return eC(function(){var r,n,o,i,u,a;return eM(this,function(c){switch(c.label){case 0:if(r=t.core,n=t.scroller,o=t.skey,i=t.fetcher,u=t.mparams,null!==t._state)return[3,2];return[4,null!=(a=t._init)?a:t._init=t.loadAsync()];case 1:c.sent(),c.label=2;case 2:if(null===t._state)throw Error("Null state after init");if(void 0===i)return[2,t._state];return[4,r.scroll.first(o,n,i,e,u)];case 3:return[2,t._state=c.sent()]}})})()},t.refetch=function(e){var t=this;return eC(function(){var r,n,o,i,u,a;return eM(this,function(c){switch(c.label){case 0:if(r=t.core,n=t.scroller,o=t.skey,i=t.fetcher,u=t.mparams,null!==t._state)return[3,2];return[4,null!=(a=t._init)?a:t._init=t.loadAsync()];case 1:c.sent(),c.label=2;case 2:if(null===t._state)throw Error("Null state after init");if(void 0===i)return[2,t._state];return[4,r.scroll.first(o,n,i,e,u,!0,!0)];case 3:return[2,t._state=c.sent()]}})})()},t.scroll=function(e){var t=this;return eC(function(){var r,n,o,i,u,a;return eM(this,function(c){switch(c.label){case 0:if(r=t.core,n=t.scroller,o=t.skey,i=t.fetcher,u=t.mparams,null!==t._state)return[3,2];return[4,null!=(a=t._init)?a:t._init=t.loadAsync()];case 1:c.sent(),c.label=2;case 2:if(null===t._state)throw Error("Null state after init");if(void 0===i)return[2,t._state];return[4,r.scroll.scroll(o,n,i,e,u,!0,!0)];case 3:return[2,t._state=c.sent()]}})})()},t.clear=function(){var e=this;return eC(function(){var t,r,n;return eM(this,function(o){switch(o.label){case 0:return t=e.core,r=e.skey,n=e.mparams,[4,t.delete(r,n)];case 1:return o.sent(),delete e._state,[2]}})})()},eL(e,[{key:"init",get:function(){return this._init}},{key:"state",get:function(){return this._state}},{key:"ready",get:function(){return null!==this._state}}]),e}();function eB(e,t,r,n,o,i,u){try{var a=e[i](u),c=a.value}catch(s){r(s);return}a.done?t(c):Promise.resolve(c).then(n,o)}function eG(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function u(e){eB(i,n,o,u,a,"next",e)}function a(e){eB(i,n,o,u,a,"throw",e)}u(void 0)})}}var eJ=function(e,t){var r,n,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw TypeError("Generator is already executing.");for(;u;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,n=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=t.call(e,u)}catch(a){i=[6,a],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};function eq(e,t,r){return void 0===r&&(r={}),new eW(e,t,r)}var eW=function(){function e(e,t,r){void 0===r&&(r={}),this.scroller=e,this.fetcher=t,this.params=r}var t=e.prototype;return t.make=function(e){var t=this.scroller,r=this.fetcher,n=this.params;return new eF(e,t,r,n)},t.normalize=function(e,t){var r=this;return eG(function(){var n,o,i,u,a,c;return eJ(this,function(a){switch(a.label){case 0:if(t.shallow)return[2];return o=(n=t.root).time,i=n.cooldown,c={data:e,time:o,cooldown:i,expiration:u=n.expiration,optimistic:n.optimistic},[4,r.make(t.core).mutate(function(){return c})];case 1:return a.sent(),[2]}})})()},e}();function eX(e,t,r,n,o,i,u){try{var a=e[i](u),c=a.value}catch(s){r(s);return}a.done?t(c):Promise.resolve(c).then(n,o)}function eH(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function u(e){eX(i,n,o,u,a,"next",e)}function a(e){eX(i,n,o,u,a,"throw",e)}u(void 0)})}}function eK(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function eQ(e,t,r){return t&&eK(e.prototype,t),r&&eK(e,r),e}function eV(){return(eV=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var eZ=function(e,t){var r,n,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw TypeError("Generator is already executing.");for(;u;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,n=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=t.call(e,u)}catch(a){i=[6,a],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};function e$(e,t){if(void 0!==e){if("string"==typeof e)return e;var r=t.serializer;return(void 0===r?E:r).stringify(e)}}var eY=function(){function e(e,t,r,n){void 0===n&&(n={}),this.core=e,this.key=t,this.fetcher=r,this.params=n,this.mparams=eV({},e.params,n),this.skey=e$(t,this.mparams),this.loadSync(),this.subscribe()}var t=e.prototype;return t.loadSync=function(){var e=this.core,t=this.skey,r=this.mparams;this._state=e.getSync(t,r)},t.loadAsync=function(){var e=this;return eH(function(){var t,r,n;return eZ(this,function(o){switch(o.label){case 0:if(e.ready)return[2];return t=e.core,r=e.skey,n=e.mparams,[4,t.get(r,n)];case 1:return e._state=o.sent(),[2]}})})()},t.subscribe=function(){var e=this,t=this.core,r=this.skey,n=function(t){return e._state=t};t.on(this.skey,n),new FinalizationRegistry(function(){t.off(r,n)}).register(this,void 0)},t.mutate=function(e){var t=this;return eH(function(){var r,n,o,i;return eZ(this,function(u){switch(u.label){case 0:if(r=t.core,n=t.skey,o=t.mparams,null!==t._state)return[3,2];return[4,null!=(i=t._init)?i:t._init=t.loadAsync()];case 1:u.sent(),u.label=2;case 2:if(null===t._state)throw Error("Null state after init");return[4,r.mutate(n,t._state,e,o)];case 3:return[2,t._state=u.sent()]}})})()},t.fetch=function(e){var t=this;return eH(function(){var r,n,o,i,u,a;return eZ(this,function(c){switch(c.label){case 0:if(r=t.core,n=t.key,o=t.skey,i=t.fetcher,u=t.mparams,null!==t._state)return[3,2];return[4,null!=(a=t._init)?a:t._init=t.loadAsync()];case 1:c.sent(),c.label=2;case 2:if(null===t._state)throw Error("Null state after init");if(void 0===i)return[2,t._state];return[4,r.single.fetch(n,o,i,e,u)];case 3:return[2,t._state=c.sent()]}})})()},t.refetch=function(e){var t=this;return eH(function(){var r,n,o,i,u,a;return eZ(this,function(c){switch(c.label){case 0:if(r=t.core,n=t.key,o=t.skey,i=t.fetcher,u=t.mparams,null!==t._state)return[3,2];return[4,null!=(a=t._init)?a:t._init=t.loadAsync()];case 1:c.sent(),c.label=2;case 2:if(null===t._state)throw Error("Null state after init");if(void 0===i)return[2,t._state];return[4,r.single.fetch(n,o,i,e,u,!0,!0)];case 3:return[2,t._state=c.sent()]}})})()},t.update=function(e,t,r){void 0===t&&(t={});var n=this;return eH(function(){var o,i,u,a,c,s,l;return eZ(this,function(f){switch(f.label){case 0:if(o=n.core,i=n.key,u=n.skey,a=n.fetcher,c=n.mparams,null!==n._state)return[3,2];return[4,null!=(s=n._init)?s:n._init=n.loadAsync()];case 1:f.sent(),f.label=2;case 2:if(null===n._state)throw Error("Null state after init");return l=eV({},c,t),[4,o.single.update(i,u,a,e,r,l)];case 3:return[2,n._state=f.sent()]}})})()},t.clear=function(){var e=this;return eH(function(){var t,r,n;return eZ(this,function(o){switch(o.label){case 0:return t=e.core,r=e.skey,n=e.mparams,[4,t.delete(r,n)];case 1:return o.sent(),delete e._state,[2]}})})()},eQ(e,[{key:"init",get:function(){return this._init}},{key:"state",get:function(){return this._state}},{key:"ready",get:function(){return null!==this._state}}]),e}();function e0(e,t,r,n,o,i,u){try{var a=e[i](u),c=a.value}catch(s){r(s);return}a.done?t(c):Promise.resolve(c).then(n,o)}function e1(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function u(e){e0(i,n,o,u,a,"next",e)}function a(e){e0(i,n,o,u,a,"throw",e)}u(void 0)})}}var e2=function(e,t){var r,n,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw TypeError("Generator is already executing.");for(;u;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,n=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=t.call(e,u)}catch(a){i=[6,a],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};function e4(e,t,r){return void 0===r&&(r={}),new e3(e,t,r)}var e3=function(){function e(e,t,r){void 0===r&&(r={}),this.key=e,this.fetcher=t,this.params=r}var t=e.prototype;return t.make=function(e){var t=this.key,r=this.fetcher,n=this.params;return new eY(e,t,r,n)},t.normalize=function(e,t){var r=this;return e1(function(){var n,o,i,u,a,c;return e2(this,function(a){switch(a.label){case 0:if(t.shallow)return[2];return o=(n=t.root).time,i=n.cooldown,c={data:e,time:o,cooldown:i,expiration:u=n.expiration,optimistic:n.optimistic},[4,r.make(t.core).mutate(function(){return c})];case 1:return a.sent(),[2]}})})()},e}();function e6(e,t,r,n,o,i,u){try{var a=e[i](u),c=a.value}catch(s){r(s);return}a.done?t(c):Promise.resolve(c).then(n,o)}function e5(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function u(e){e6(i,n,o,u,a,"next",e)}function a(e){e6(i,n,o,u,a,"throw",e)}u(void 0)})}}function e7(){return(e7=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var e8=function(e,t){var r,n,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw TypeError("Generator is already executing.");for(;u;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,n=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=t.call(e,u)}catch(a){i=[6,a],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};function e9(t,r,n){void 0===n&&(n={});var o=ew(),i=e7({},o.params,n),u=eA(t),a=eA(r),c=eA(i),s=e.useMemo(function(){return t()},[t]),l=e.useMemo(function(){return eU(s,c.current)},[s]),f=e.useState(0)[1],d=e.useRef();e.useMemo(function(){d.current=o.getSync(l,c.current)},[o,l]);var h=e.useCallback(function(e){d.current=e,f(function(e){return e+1})},[]),v=e.useRef();e.useEffect(function(){null===d.current&&(v.current=o.get(l,c.current).then(h))},[o,l]),e.useEffect(function(){if(l)return o.on(l,h,c.current),function(){o.off(l,h,c.current)}},[o,l]);var p=e.useCallback(e5(function(e){var t,r;return e8(this,function(n){switch(n.label){case 0:if(null!==d.current)return[3,2];return[4,v.current];case 1:n.sent(),n.label=2;case 2:if(null===d.current)throw Error("Null state after init");return t=d.current,r=c.current,[4,o.mutate(l,t,e,r)];case 3:return[2,n.sent()]}})}),[o,l]),b=e.useCallback(e5(function(){return e8(this,function(e){switch(e.label){case 0:if(null!==d.current)return[3,2];return[4,v.current];case 1:e.sent(),e.label=2;case 2:if(null===d.current)throw Error("Null state after init");return[4,o.delete(l,c.current)];case 3:return e.sent(),[2]}})}),[o,l]),y=e.useCallback(e5(function(e){var t,r,n;return e8(this,function(i){switch(i.label){case 0:if("undefined"==typeof window)throw Error("Fetch on SSR");if(null!==d.current)return[3,2];return[4,v.current];case 1:i.sent(),i.label=2;case 2:if(null===d.current)throw Error("Null state after init");if(void 0===a.current)return[2,d.current];return t=u.current,r=a.current,n=c.current,[4,o.scroll.first(l,t,r,e,n)];case 3:return[2,i.sent()]}})}),[o,l]),m=e.useCallback(e5(function(e){var t,r,n;return e8(this,function(i){switch(i.label){case 0:if("undefined"==typeof window)throw Error("Refetch on SSR");if(null!==d.current)return[3,2];return[4,v.current];case 1:i.sent(),i.label=2;case 2:if(null===d.current)throw Error("Null state after init");if(void 0===a.current)return[2,d.current];return t=u.current,r=a.current,n=c.current,[4,o.scroll.first(l,t,r,e,n,!0,!0)];case 3:return[2,i.sent()]}})}),[o,l]),w=e.useCallback(e5(function(e){var t,r,n;return e8(this,function(i){switch(i.label){case 0:if("undefined"==typeof window)throw Error("Scroll on SSR");if(null!==d.current)return[3,2];return[4,v.current];case 1:i.sent(),i.label=2;case 2:if(null===d.current)throw Error("Null state after init");if(void 0===a.current)return[2,d.current];return t=u.current,r=a.current,n=c.current,[4,o.scroll.scroll(l,t,r,e,n,!0,!0)];case 3:return[2,i.sent()]}})}),[o,l]),g=e.useCallback(function(){if("undefined"==typeof window)throw Error("Suspend on SSR");return e5(function(){var e,t,r,n;return e8(this,function(i){switch(i.label){case 0:if(null!==d.current)return[3,2];return[4,v.current];case 1:i.sent(),i.label=2;case 2:if(null===d.current)throw Error("Null state after init");if(void 0===a.current)throw Error("No fetcher");return e=u.current,t=a.current,r=c.current,n=new Promise(function(e){return o.once(l,function(){return e()},r)}),[4,o.scroll.first(l,e,t,void 0,r,!1,!0)];case 3:return i.sent(),[4,n];case 4:return i.sent(),[2]}})})()},[o,l]),k=d.current,S=null!=k?k:{},x=S.data,E=S.error,_=S.time,O=S.cooldown,P=S.expiration,j=S.aborter,A=S.optimistic,T=S.realData,I=Boolean(j);return{key:s,skey:l,data:x,error:E,time:_,cooldown:O,expiration:P,aborter:j,optimistic:A,realData:T,loading:I,ready:null!==k,mutate:p,fetch:y,refetch:m,scroll:w,clear:b,suspend:g}}function te(e,t,r,n,o,i,u){try{var a=e[i](u),c=a.value}catch(s){r(s);return}a.done?t(c):Promise.resolve(c).then(n,o)}function tt(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function u(e){te(i,n,o,u,a,"next",e)}function a(e){te(i,n,o,u,a,"throw",e)}u(void 0)})}}function tr(){return(tr=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var tn=function(e,t){var r,n,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw TypeError("Generator is already executing.");for(;u;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,n=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=t.call(e,u)}catch(a){i=[6,a],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};function to(t,r,n){void 0===n&&(n={});var o=ew(),i=tr({},o.params,n),u=eA(t),a=eA(r),c=eA(i),s=e.useMemo(function(){return e$(t,c.current)},[t]),l=e.useState(0)[1],f=e.useRef();e.useMemo(function(){f.current=o.getSync(s,c.current)},[o,s]);var d=e.useCallback(function(e){f.current=e,l(function(e){return e+1})},[]),h=e.useRef();e.useEffect(function(){null===f.current&&(h.current=o.get(s,c.current).then(d))},[o,s]),e.useEffect(function(){if(s)return o.on(s,d,c.current),function(){o.off(s,d,c.current)}},[o,s]);var v=e.useCallback(tt(function(e){var t,r;return tn(this,function(n){switch(n.label){case 0:if(null!==f.current)return[3,2];return[4,h.current];case 1:n.sent(),n.label=2;case 2:if(null===f.current)throw Error("Null state after init");return t=f.current,r=c.current,[4,o.mutate(s,t,e,r)];case 3:return[2,n.sent()]}})}),[o,s]),p=e.useCallback(tt(function(){return tn(this,function(e){switch(e.label){case 0:if(null!==f.current)return[3,2];return[4,h.current];case 1:e.sent(),e.label=2;case 2:if(null===f.current)throw Error("Null state after init");return[4,o.delete(s,c.current)];case 3:return e.sent(),[2]}})}),[o,s]),b=e.useCallback(tt(function(e){var t,r,n;return tn(this,function(i){switch(i.label){case 0:if("undefined"==typeof window)throw Error("Fetch on SSR");if(null!==f.current)return[3,2];return[4,h.current];case 1:i.sent(),i.label=2;case 2:if(null===f.current)throw Error("Null state after init");if(void 0===a.current)return[2,f.current];return t=u.current,r=a.current,n=c.current,[4,o.single.fetch(t,s,r,e,n)];case 3:return[2,i.sent()]}})}),[o,s]),y=e.useCallback(tt(function(e){var t,r,n;return tn(this,function(i){switch(i.label){case 0:if("undefined"==typeof window)throw Error("Refetch on SSR");if(null!==f.current)return[3,2];return[4,h.current];case 1:i.sent(),i.label=2;case 2:if(null===f.current)throw Error("Null state after init");if(void 0===a.current)return[2,f.current];return t=u.current,r=a.current,n=c.current,[4,o.single.fetch(t,s,r,e,n,!0,!0)];case 3:return[2,i.sent()]}})}),[o,s]),m=e.useCallback(tt(function(e,t,r){var n,i,l,d;return tn(this,function(l){switch(l.label){case 0:if(void 0===t&&(t={}),"undefined"==typeof window)throw Error("Update on SSR");if(null!==f.current)return[3,2];return[4,h.current];case 1:l.sent(),l.label=2;case 2:if(null===f.current)throw Error("Null state after init");return n=u.current,i=a.current,d=tr({},c.current,t),[4,o.single.update(n,s,i,e,r,d)];case 3:return[2,l.sent()]}})}),[o,s]),w=e.useCallback(function(){if("undefined"==typeof window)throw Error("Suspend on SSR");return tt(function(){var e,t,r,n;return tn(this,function(i){switch(i.label){case 0:if(null!==f.current)return[3,2];return[4,h.current];case 1:i.sent(),i.label=2;case 2:if(null===f.current)throw Error("Null state after init");if(void 0===a.current)throw Error("No fetcher");return e=u.current,t=a.current,r=c.current,n=new Promise(function(e){return o.once(s,function(){return e()},r)}),[4,o.single.fetch(e,s,t,void 0,r,!1,!0)];case 3:return i.sent(),[4,n];case 4:return i.sent(),[2]}})})()},[o,s]),g=f.current,k=null!=g?g:{},S=k.data,x=k.error,E=k.time,_=k.cooldown,O=k.expiration,P=k.aborter,j=k.optimistic,A=k.realData,T=Boolean(P);return{key:t,skey:s,data:S,error:x,time:E,cooldown:_,expiration:O,aborter:P,optimistic:j,realData:A,loading:T,ready:null!==g,mutate:v,fetch:b,refetch:y,update:m,clear:p,suspend:w}}function ti(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function tu(t,r){var n=e.useMemo(function(){return t.apply(void 0,r)},r);if(ti(n,e3)){var o=n.key;return to(o,n.fetcher,n.params)}if(ti(n,eW)){var i=n.scroller;return e9(i,n.fetcher,n.params)}throw Error("Invalid resource schema")}function ta(){var t=ew(),r=e.useCallback(function(e){return e.make(t)},[t]);return{core:t,make:r}}function tc(e,t,r,n,o,i,u){try{var a=e[i](u),c=a.value}catch(s){r(s);return}a.done?t(c):Promise.resolve(c).then(n,o)}function ts(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function u(e){tc(i,n,o,u,a,"next",e)}function a(e){tc(i,n,o,u,a,"throw",e)}u(void 0)})}}function tl(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function tf(e,t,r){return t&&tl(e.prototype,t),r&&tl(e,r),e}function td(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var th=function(e,t){var r,n,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw TypeError("Generator is already executing.");for(;u;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,n=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=t.call(e,u)}catch(a){i=[6,a],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};function tv(t){var r=e.useRef();return void 0===r.current&&(r.current=new tp(t)),e.useEffect(function(){return function(){var e;null==(e=r.current)||e.unmount()}},[]),r.current}var tp=function(){function e(e){var t=this;this.name=e,this.async=!0,this.keys=new Set,"undefined"!=typeof indexedDB&&(this.initialization=this.load(),this.onunload=function(){return t.unload()},addEventListener("beforeunload",this.onunload))}var t=e.prototype;return t.load=function(){var e=this;return ts(function(){var t,r;return th(this,function(r){switch(r.label){case 0:if("undefined"==typeof indexedDB)return[2];return[4,new Promise(function(t,r){var n=indexedDB.open(e.name,1);n.onupgradeneeded=function(){return n.result.createObjectStore("keyval",{})},n.onblocked=function(){return r("blocked")},n.onsuccess=function(){return t(n.result)},n.onerror=function(){return r(n.error)}})];case 1:if(e._database=r.sent(),"undefined"==typeof Storage||!(t=localStorage.getItem("idb."+e.name+".keys")))return[2];return JSON.parse(t).forEach(function(t){return e.keys.add(t)}),localStorage.removeItem("idb."+e.name+".keys"),[4,e.collect().catch(console.error)];case 2:return r.sent(),[2]}})})()},t.unmount=function(){"undefined"!=typeof indexedDB&&(void 0!==this.onunload&&removeEventListener("beforeunload",this.onunload),this.collect().catch(console.error))},t.unload=function(){if("undefined"!=typeof Storage){var e=JSON.stringify([].concat(this.keys));localStorage.setItem("idb."+this.name+".keys",e)}},t.collect=function(){var e=this;return ts(function(){var t,r,n,o;return th(this,function(i){switch(i.label){case 0:if("undefined"==typeof indexedDB)return[2];t=td(e.keys),i.label=1;case 1:if((r=t()).done)return[3,4];return n=r.value,[4,e.get(n,!0)];case 2:if((null==(o=i.sent())?void 0:o.expiration)===void 0||o.expiration>Date.now())return[3,3];e.delete(n,!1),i.label=3;case 3:return[3,1];case 4:return[2]}})})()},t.transact=function(e,t){var r=this;return ts(function(){return th(this,function(n){switch(n.label){case 0:if("undefined"==typeof indexedDB)return[2];if(void 0!==r.database)return[3,2];return[4,r.initialization];case 1:n.sent(),n.label=2;case 2:return[4,new Promise(function(n,o){if(void 0===r.database)throw Error("Undefined database");var i,u=r.database.transaction("keyval",t);u.onerror=function(){return o(u.error)},u.oncomplete=function(){return n(i)},e(u.objectStore("keyval")).then(function(e){return i=e}).then(function(){return u.commit()}).catch(o)})];case 3:return[2,n.sent()]}})})()},t.get=function(e,t){void 0===t&&(t=!1);var r=this;return ts(function(){return th(this,function(n){switch(n.label){case 0:if("undefined"==typeof indexedDB)return[2];return t||r.keys.has(e)||r.keys.add(e),[4,r.transact(ts(function(t){return th(this,function(r){switch(r.label){case 0:return[4,new Promise(function(r,n){var o=t.get(e);o.onerror=function(){return n(o.error)},o.onsuccess=function(){return r(o.result)}})];case 1:return[2,r.sent()]}})}),"readonly")];case 1:return[2,n.sent()]}})})()},t.set=function(e,t,r){void 0===r&&(r=!1);var n=this;return ts(function(){return th(this,function(o){switch(o.label){case 0:if("undefined"==typeof indexedDB)return[2];return r||n.keys.has(e)||n.keys.add(e),[4,n.transact(ts(function(r){return th(this,function(n){switch(n.label){case 0:return[4,new Promise(function(n,o){var i=r.put(t,e);i.onerror=function(){return o(i.error)},i.onsuccess=function(){return n()}})];case 1:return[2,n.sent()]}})}),"readwrite")];case 1:return[2,o.sent()]}})})()},t.delete=function(e,t){void 0===t&&(t=!1);var r=this;return ts(function(){return th(this,function(n){switch(n.label){case 0:if("undefined"==typeof indexedDB)return[2];return!t&&r.keys.has(e)&&r.keys.delete(e),[4,r.transact(ts(function(t){return th(this,function(r){switch(r.label){case 0:return[4,new Promise(function(r,n){var o=t.delete(e);o.onerror=function(){return n(o.error)},o.onsuccess=function(){return r()}})];case 1:return[2,r.sent()]}})}),"readwrite")];case 1:return[2,n.sent()]}})})()},tf(e,[{key:"database",get:function(){return this._database}}]),e}();function tb(e,t,r,n,o,i,u){try{var a=e[i](u),c=a.value}catch(s){r(s);return}a.done?t(c):Promise.resolve(c).then(n,o)}function ty(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function u(e){tb(i,n,o,u,a,"next",e)}function a(e){tb(i,n,o,u,a,"throw",e)}u(void 0)})}}function tm(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var tw=function(e,t){var r,n,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw TypeError("Generator is already executing.");for(;u;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,n=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=t.call(e,u)}catch(a){i=[6,a],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};function tg(t,r){var n=e.useRef();return void 0===n.current&&(n.current=new tk(t,r)),e.useEffect(function(){return function(){var e;null==(e=n.current)||e.unmount()}},[]),n.current}var tk=function(){function e(e,t){void 0===e&&(e="xswr:"),void 0===t&&(t=JSON);var r=this;this.prefix=e,this.serializer=t,this.async=!0,this.keys=new Set,"undefined"!=typeof Storage&&(this.onunload=function(){return r.collect()},addEventListener("beforeunload",this.onunload))}var t=e.prototype;return t.unmount=function(){if("undefined"!=typeof Storage){this.onunload&&removeEventListener("beforeunload",this.onunload);var e=this;ty(function(){return tw(this,function(t){return[2,e.collect()]})})().catch(console.error)}},t.collect=function(){if("undefined"!=typeof Storage)for(var e,t=tm(this.keys);!(e=t()).done;){var r=e.value,n=this.getSync(r,!0);(null==n?void 0:n.expiration)!==void 0&&(n.expiration>Date.now()||this.delete(r,!1))}},t.getSync=function(e,t){if(void 0===t&&(t=!1),"undefined"!=typeof Storage){t||this.keys.has(e)||this.keys.add(e);var r=localStorage.getItem(this.prefix+e);if(r)return this.serializer.parse(r)}},t.get=function(e,t){void 0===t&&(t=!1);var r=this;return ty(function(){var n;return tw(this,function(o){return"undefined"==typeof Storage?[2]:(t||r.keys.has(e)||r.keys.add(e),n=localStorage.getItem(r.prefix+e))?[2,r.serializer.parse(n)]:[2]})})()},t.set=function(e,t,r){void 0===r&&(r=!1);var n=this;return ty(function(){var o;return tw(this,function(i){return"undefined"==typeof Storage||(r||n.keys.has(e)||n.keys.add(e),o=n.serializer.stringify(t),localStorage.setItem(n.prefix+e,o)),[2]})})()},t.delete=function(e,t){void 0===t&&(t=!1);var r=this;return ty(function(){return tw(this,function(n){return"undefined"==typeof Storage||(!t&&r.keys.has(e)&&r.keys.delete(e),localStorage.removeItem(r.prefix+e)),[2]})})()},e}();function tS(e,t,r,n,o,i,u){try{var a=e[i](u),c=a.value}catch(s){r(s);return}a.done?t(c):Promise.resolve(c).then(n,o)}function tx(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function u(e){tS(i,n,o,u,a,"next",e)}function a(e){tS(i,n,o,u,a,"throw",e)}u(void 0)})}}function tE(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var t_=function(e,t){var r,n,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw TypeError("Generator is already executing.");for(;u;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,n=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=t.call(e,u)}catch(a){i=[6,a],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};function tO(t,r){var n=e.useRef();return n.current||(n.current=new tP(t,r)),e.useEffect(function(){return function(){var e;null==(e=n.current)||e.unmount()}},[]),n.current}var tP=function(){function e(e,t){void 0===e&&(e="xswr:"),void 0===t&&(t=JSON);var r=this;this.prefix=e,this.serializer=t,this.async=!1,this.keys=new Set,"undefined"!=typeof Storage&&(this.onunload=function(){return r.collect()},addEventListener("beforeunload",this.onunload))}var t=e.prototype;return t.unmount=function(){if("undefined"!=typeof Storage){removeEventListener("beforeunload",this.onunload);var e=this;tx(function(){return t_(this,function(t){return[2,e.collect()]})})().catch(console.error)}},t.collect=function(){if("undefined"!=typeof Storage)for(var e,t=tE(this.keys);!(e=t()).done;){var r=e.value,n=this.get(r,!0);(null==n?void 0:n.expiration)!==void 0&&(n.expiration>Date.now()||this.delete(r,!1))}},t.get=function(e,t){if(void 0===t&&(t=!1),"undefined"!=typeof Storage){t||this.keys.has(e)||this.keys.add(e);var r=localStorage.getItem(this.prefix+e);if(r)return this.serializer.parse(r)}},t.set=function(e,t,r){if(void 0===r&&(r=!1),"undefined"!=typeof Storage){r||this.keys.has(e)||this.keys.add(e);var n=this.serializer.stringify(t);localStorage.setItem(this.prefix+e,n)}},t.delete=function(e,t){void 0===t&&(t=!1),"undefined"!=typeof Storage&&(!t&&this.keys.has(e)&&this.keys.delete(e),localStorage.removeItem(this.prefix+e))},e}(),tj={__proto__:null,Core:eb,AbortError:b,isAbortError:y,CoreContext:em,useCore:ew,useCoreProvider:eg,CoreProvider:ek,useDebug:eS,useError:ex,useFallback:eE,useFetch:e_,useInterval:eO,useMount:eP,useOnce:ej,useOnline:eT,useRetry:eI,useVisible:eR,use:tu,useScroll:e9,useSingle:to,useXSWR:ta,ScrollHelper:M,getScrollStorageKey:eU,ScrollObject:eF,scroll:eq,ScrollSchema:eW,SingleHelper:Z,getSingleStorageKey:e$,SingleObject:eY,single:e4,SingleSchema:e3,useIDBStorage:tv,IDBStorage:tp,useAsyncLocalStorage:tg,AsyncLocalStorage:tk,useSyncLocalStorage:tO,SyncLocalStorage:tP,isAsyncStorage:$,DEFAULT_EQUALS:x,DEFAULT_SERIALIZER:E,DEFAULT_COOLDOWN:_,DEFAULT_EXPIRATION:O,DEFAULT_TIMEOUT:P,refEquals:g,jsonEquals:k,shallowEquals:S};exports.XSWR=tj;
