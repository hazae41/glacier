var t=require("react");function e(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var r=e(t);function n(t,e){return null!=e&&"undefined"!=typeof Symbol&&e[Symbol.hasInstance]?!!e[Symbol.hasInstance](t):t instanceof e}var i=function(t,e){return(i=Object.setPrototypeOf||n({__proto__:[]},Array)&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(t,e)};function o(t,e){var r=function(){this.constructor=t};if("function"!=typeof e&&null!==e)throw TypeError("Class extends value "+String(e)+" is not a constructor or null");i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var u=function(){return(u=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function s(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&0>e.indexOf(n)&&(r[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,n=Object.getOwnPropertySymbols(t);i<n.length;i++)0>e.indexOf(n[i])&&Object.prototype.propertyIsEnumerable.call(t,n[i])&&(r[n[i]]=t[n[i]]);return r}function a(t,e,r,i){return new(r||(r=Promise))(function(o,u){var s=function(t){try{c(i.next(t))}catch(e){u(e)}},a=function(t){try{c(i.throw(t))}catch(e){u(e)}},c=function(t){var e;t.done?o(t.value):(n(e=t.value,r)?e:new r(function(t){t(e)})).then(s,a)};c((i=i.apply(t,e||[])).next())})}function c(t,e){var r,n,i,o,u=function(t){return function(e){return s([t,e])}},s=function(o){if(r)throw TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(u){o=[6,u],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}},a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o}function l(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function f(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,i,o=r.call(t),u=[];try{for(;(void 0===e||e-- >0)&&!(n=o.next()).done;)u.push(n.value)}catch(s){i={error:s}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return u}function d(t,e,r){if(r||2===arguments.length)for(var n,i=0,o=e.length;i<o;i++)!n&&i in e||(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))}function h(t){var e=function(e){n[e]=t[e]&&function(n){return new Promise(function(i,o){r(i,o,(n=t[e](n)).done,n.value)})}},r=function(t,e,r,n){Promise.resolve(n).then(function(e){t({value:e,done:r})},e)};if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var n,i=t[Symbol.asyncIterator];return i?i.call(t):(t=l(t),n={},e("next"),e("throw"),e("return"),n[Symbol.asyncIterator]=function(){return this},n)}var v=function(){var t=function(){this.map=new Map};return t.prototype.get=function(t){return this.map.get(t)},t.prototype.push=function(t,e){var r=this.map.get(t);r?r.push(e):this.map.set(t,[e])},t.prototype.erase=function(t,e){var r=this.map.get(t);if(r){var n=r.filter(function(t){return t!==e});n.length?this.map.set(t,n):this.map.delete(t)}},t}(),p=function(){var t=function(){this.listeners=new v};return t.prototype.publish=function(t,e){var r,n,i=this.listeners.get(t);if(i)try{for(var o=l(i),u=o.next();!u.done;u=o.next())(0,u.value)(e)}catch(s){r={error:s}}finally{try{u&&!u.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}},t.prototype.on=function(t,e){this.listeners.push(t,e)},t.prototype.off=function(t,e){this.listeners.erase(t,e)},t}();function y(t){if(t.length)return t[t.length-1]}function m(t){if(-1!==t)return Date.now()+t}function b(t,e){return null!=e&&"undefined"!=typeof Symbol&&e[Symbol.hasInstance]?!!e[Symbol.hasInstance](t):t instanceof e}var w=function(t){var e=function(e){return t.call(this,"Aborted: ".concat(e.reason),{cause:e})||this};return o(e,t),e}(Error);function g(t){return!!(b(t,w)||b(t,DOMException)&&"AbortError"===t.name)}var S=function(t){return t&&"undefined"!=typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};function k(t,e){return t===e}function E(t,e){return t===e||(void 0===t?"undefined":S(t))===(void 0===e?"undefined":S(e))&&JSON.stringify(t)===JSON.stringify(e)}function x(t,e){if(t===e)return!0;if((void 0===t?"undefined":S(t))!==(void 0===e?"undefined":S(e)))return!1;var r,n,i=Object.keys(t),o=Object.keys(e);if(i.length!==o.length)return!1;try{for(var u=l(i),s=u.next();!s.done;s=u.next()){var a=s.value;if(t[a]!==e[a])return!1}}catch(c){r={error:c}}finally{try{s&&!s.done&&(n=u.return)&&n.call(u)}finally{if(r)throw r.error}}return!0}var _=E,O=JSON,D=1e3,C=-1,A=5e3,I=function(){var t=function(t){this.core=t};return t.prototype.first=function(t,e,r,n,i,o,s){var l;return void 0===n&&(n=new AbortController),void 0===i&&(i={}),void 0===o&&(o=!1),void 0===s&&(s=!1),a(this,void 0,void 0,function(){var f,d,h,v,p,y,b,g,S,k,E,x,O,I,R,N,P,j,T,L,z,M,U,B,F,J,q=this;return c(this,function(x){switch(x.label){case 0:if(void 0===t)return[2];return[4,this.core.lock(t,function(){return a(q,void 0,void 0,function(){var r,u;return c(this,function(a){switch(a.label){case 0:return[4,this.core.get(t,i)];case 1:if((null==(r=a.sent())?void 0:r.optimistic)||(null==r?void 0:r.aborter)&&!o||((null==r?void 0:r.aborter)&&o&&r.aborter.abort("Replaced"),this.core.shouldCooldown(r)&&!s||void 0===(u=e(void 0))))return[2,{current:r,skip:!0}];return[4,this.core.mutate(t,r,function(t){return{time:null==t?void 0:t.time,aborter:n}},i)];case 2:return[2,{current:r=a.sent(),first:u}]}})})})];case 1:if(d=(f=x.sent()).current,h=f.skip,v=f.first,h)return[2,d];if(void 0===v)throw Error("Undefined first");y=void 0===(p=i.equals)?_:p,g=void 0===(b=i.cooldown)?D:b,k=void 0===(S=i.expiration)?C:S,O=setTimeout(function(){n.abort("First timed out")},void 0===(E=i.timeout)?A:E),x.label=2;case 2:return x.trys.push([2,8,11,12]),[4,r(v,{signal:I=n.signal})];case 3:if(N=(R=x.sent()).data,P=R.error,T=void 0===(j=R.time)?Date.now():j,z=void 0===(L=R.cooldown)?m(g):L,U=void 0===(M=R.expiration)?m(k):M,I.aborted)throw new w(I);return[4,this.core.get(t,i)];case 4:if(d=x.sent(),B={},void 0!==N&&(B.data=[N]),B.error=P,!(void 0!==N))return[3,6];return[4,this.core.normalize(!0,{data:[N]},i)];case 5:y(null==(F=x.sent())?void 0:F[0],null===(l=null==d?void 0:d.data)||void 0===l?void 0:l[0])&&delete B.data,x.label=6;case 6:return[4,this.core.mutate(t,d,function(){return u({time:T,cooldown:z,expiration:U,aborter:void 0},B)},i)];case 7:case 10:return[2,x.sent()];case 8:return J=x.sent(),[4,this.core.get(t,i)];case 9:if((null==(d=x.sent())?void 0:d.aborter)!==n)return[2,d];return[4,this.core.mutate(t,d,function(){return{aborter:void 0,error:J}},i)];case 11:return clearTimeout(O),[7];case 12:return[2]}})})},t.prototype.scroll=function(t,e,r,n,i,o,s){var l;return void 0===n&&(n=new AbortController),void 0===i&&(i={}),void 0===o&&(o=!1),void 0===s&&(s=!1),a(this,void 0,void 0,function(){var h,v,p,b,g,S,k,E,x,_,O,I,R,N,P,j,T,L,z,M,U,B,F,J=this;return c(this,function(_){switch(_.label){case 0:if(void 0===t)return[2];return[4,this.core.lock(t,function(){return a(J,void 0,void 0,function(){var r,u,a,l;return c(this,function(u){switch(u.label){case 0:return[4,this.core.get(t,i)];case 1:if((null==(r=u.sent())?void 0:r.optimistic)||(null==r?void 0:r.aborter)&&!o||((null==r?void 0:r.aborter)&&o&&r.aborter.abort("Replaced"),this.core.shouldCooldown(r)&&!s||void 0===(a=e(y(null!==(l=null==r?void 0:r.data)&&void 0!==l?l:[])))))return[2,{current:r,skip:!0}];return[4,this.core.mutate(t,r,function(t){return{time:null==t?void 0:t.time,aborter:n}},i)];case 2:return[2,{current:r=u.sent(),last:a}]}})})})];case 1:if(v=(h=_.sent()).current,p=h.skip,b=h.last,p)return[2,v];if(void 0===b)throw Error("Undefined last");S=void 0===(g=i.cooldown)?D:g,E=void 0===(k=i.expiration)?C:k,O=setTimeout(function(){n.abort("Scroll timed out")},void 0===(x=i.timeout)?A:x),_.label=2;case 2:return _.trys.push([2,6,9,10]),[4,r(b,{signal:I=n.signal})];case 3:if(N=(R=_.sent()).data,P=R.error,T=void 0===(j=R.time)?Date.now():j,z=void 0===(L=R.cooldown)?m(S):L,U=void 0===(M=R.expiration)?m(E):M,I.aborted)throw new w(I);return void 0!==U&&(null==v?void 0:v.expiration)!==void 0&&(U=Math.min(U,null==v?void 0:v.expiration)),[4,this.core.get(t,i)];case 4:return v=_.sent(),B={},void 0!==N&&(B.data=d(d([],f(null!==(l=null==v?void 0:v.data)&&void 0!==l?l:[]),!1),[N],!1)),B.error=P,[4,this.core.mutate(t,v,function(){return u({time:T,cooldown:z,expiration:U,aborter:void 0},B)},i)];case 5:case 8:return[2,_.sent()];case 6:return F=_.sent(),[4,this.core.get(t,i)];case 7:if((null==(v=_.sent())?void 0:v.aborter)!==n)return[2,v];return[4,this.core.mutate(t,v,function(){return{aborter:void 0,error:F}},i)];case 9:return clearTimeout(O),[7];case 10:return[2]}})})},t}();function R(t){return a(this,void 0,void 0,function(){var e;return c(this,function(r){switch(r.label){case 0:return[4,t.next()];case 1:if((e=r.sent()).done)return[2,e.value];return[2]}})})}var N=function(){var t=function(t){this.core=t};return t.prototype.fetch=function(t,e,r,n,i,o,s){return void 0===n&&(n=new AbortController),void 0===i&&(i={}),void 0===o&&(o=!1),void 0===s&&(s=!1),a(this,void 0,void 0,function(){var l,f,d,h,v,p,y,b,g,S,k,E,x,_,O,I,R,N,P,j,T,L,z=this;return c(this,function(d){switch(d.label){case 0:if(void 0===t||void 0===e)return[2];return[4,this.core.lock(e,function(){return a(z,void 0,void 0,function(){var t;return c(this,function(r){switch(r.label){case 0:return[4,this.core.get(e,i)];case 1:if((null==(t=r.sent())?void 0:t.optimistic)||(null==t?void 0:t.aborter)&&!o||((null==t?void 0:t.aborter)&&o&&t.aborter.abort("Replaced"),this.core.shouldCooldown(t)&&!s))return[2,{current:t,skip:!0}];return[4,this.core.mutate(e,t,function(t){return{time:null==t?void 0:t.time,aborter:n}},i)];case 2:return[2,{current:t=r.sent()}]}})})})];case 1:if(f=(l=d.sent()).current,l.skip)return[2,f];v=void 0===(h=i.cooldown)?D:h,y=void 0===(p=i.expiration)?C:p,S=setTimeout(function(){n.abort("Fetch timed out")},void 0===(b=i.timeout)?A:b),d.label=2;case 2:return d.trys.push([2,6,9,10]),[4,r(t,{signal:k=n.signal})];case 3:if(x=(E=d.sent()).data,_=E.error,I=void 0===(O=E.time)?Date.now():O,N=void 0===(R=E.cooldown)?m(v):R,j=void 0===(P=E.expiration)?m(y):P,k.aborted)throw new w(k);return[4,this.core.get(e,i)];case 4:return f=d.sent(),T={},void 0!==x&&(T.data=x),T.error=_,[4,this.core.mutate(e,f,function(){return u({time:I,cooldown:N,expiration:j,aborter:void 0},T)},i)];case 5:case 8:return[2,d.sent()];case 6:return L=d.sent(),[4,this.core.get(e,i)];case 7:if((null==(f=d.sent())?void 0:f.aborter)!==n)return[2,f];return[4,this.core.mutate(e,f,function(){return{aborter:void 0,error:L}},i)];case 9:return clearTimeout(S),[7];case 10:return[2]}})})},t.prototype.update=function(t,e,r,n,i,o){var s,l;return void 0===i&&(i=new AbortController),void 0===o&&(o={}),a(this,void 0,void 0,function(){var f,d,v,p,y,b,g,S,k,E,x,_,O,I,N,P,j,T,L,z,M,U,B,F,J,q,W,X,H=this;return c(this,function(v){switch(v.label){case 0:if(void 0===t||void 0===e)return[2];return[4,this.core.lock(e,function(){return a(H,void 0,void 0,function(){var t;return c(this,function(r){switch(r.label){case 0:return[4,this.core.get(e,o)];case 1:if(null==(t=r.sent())?void 0:t.optimistic)return[2,{current:t,skip:!0}];return(null==t?void 0:t.aborter)&&t.aborter.abort("Replaced"),[4,this.core.mutate(e,t,function(t){return{time:null==t?void 0:t.time,aborter:i,optimistic:!0}},o)];case 2:return[2,{current:t=r.sent()}]}})})})];case 1:if(d=(f=v.sent()).current,f.skip)return[2,d];y=void 0===(p=o.cooldown)?D:p,g=void 0===(b=o.expiration)?C:b,E=setTimeout(function(){i.abort("Update timed out")},void 0===(S=o.timeout)?A:S),v.label=2;case 2:v.trys.push([2,23,26,27]),_=n(d,{signal:x=i.signal}),v.label=3;case 3:v.trys.push([3,9,10,15]),O=function(){var t,r,n,s;return c(this,function(a){switch(a.label){case 0:if(r=(t=P.value).data,n=t.error,x.aborted)throw new w(x);return s={},void 0!==r&&(s.data=r),s.error=n,[4,I.core.mutate(e,d,function(t){return u({time:null==t?void 0:t.time,aborter:i,optimistic:!0},s)},o)];case 1:return d=a.sent(),[2]}})},I=this,N=h(_),v.label=4;case 4:return[4,N.next()];case 5:if((P=v.sent()).done)return[3,8];return[5,O()];case 6:v.sent(),v.label=7;case 7:return[3,4];case 8:return[3,15];case 9:return s={error:v.sent()},[3,15];case 10:if(v.trys.push([10,,13,14]),!(P&&!P.done&&(l=N.return)))return[3,12];return[4,l.call(N)];case 11:v.sent(),v.label=12;case 12:return[3,14];case 13:if(s)throw s.error;return[7];case 14:return[7];case 15:return[4,R(_)];case 16:if(void 0!==(T=v.sent()))return[3,18];if(void 0===r)throw Error("Updater returned nothing and undefined fetcher");return[4,r(t,{signal:x,cache:"reload"})];case 17:T=v.sent(),v.label=18;case 18:if(L=T.data,z=T.error,U=void 0===(M=T.time)?Date.now():M,F=void 0===(B=T.cooldown)?m(y):B,q=void 0===(J=T.expiration)?m(g):J,x.aborted)throw new w(x);return[4,this.core.get(e,o)];case 19:if(d=v.sent(),!(void 0!==z))return[3,21];if((null==d?void 0:d.aborter)!==i)return[2,d];return[4,this.core.mutate(e,d,function(t){return{time:null==t?void 0:t.time,cooldown:F,expiration:q,aborter:void 0,optimistic:!1,data:null==t?void 0:t.data,error:z}},o)];case 20:case 22:case 25:return[2,v.sent()];case 21:return W={},void 0!==L&&(W.data=L),W.error=z,[4,this.core.mutate(e,d,function(){return u({time:U,cooldown:F,expiration:q,aborter:void 0,optimistic:!1},W)},o)];case 23:return X=v.sent(),[4,this.core.get(e,o)];case 24:if((null==(d=v.sent())?void 0:d.aborter)!==i)return[2,d];return[4,this.core.mutate(e,d,function(t){return{time:null==t?void 0:t.time,aborter:void 0,optimistic:!1,data:null==t?void 0:t.data,error:X}},o)];case 26:return clearTimeout(E),[7];case 27:return[2]}})})},t}();function P(t){return Boolean(t.async)}var j=function(){var t=function(){};return t.prototype.lock=function(t){return a(this,void 0,void 0,function(){var e;return c(this,function(r){switch(r.label){case 0:if(!this.mutex)return[3,2];return[4,this.mutex];case 1:r.sent(),r.label=2;case 2:return e=t(),this.mutex=e,[4,e];case 3:return[2,r.sent()]}})})},t}(),T=function(t){var e=function(e){var r=t.call(this)||this;return r.params=e,r.single=new N(r),r.scroll=new I(r),r.cache=new Map,r.locks=new Map,r._mounted=!0,r.counts=new Map,r.timeouts=new Map,r};return o(e,t),Object.defineProperty(e.prototype,"mounted",{get:function(){return this._mounted},enumerable:!1,configurable:!0}),e.prototype.unmount=function(){var t,e;try{for(var r=l(this.timeouts.values()),n=r.next();!n.done;n=r.next()){var i=n.value;clearTimeout(i)}}catch(o){t={error:o}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}this._mounted=!1},e.prototype.lock=function(t,e){return a(this,void 0,void 0,function(){var r,n;return c(this,function(i){switch(i.label){case 0:if(!(void 0!==(r=this.locks.get(t))))return[3,2];return[4,r.lock(e)];case 1:case 3:return[2,i.sent()];case 2:return n=new j,this.locks.set(t,n),[4,n.lock(e)]}})})},e.prototype.getSync=function(t,e){if(void 0===e&&(e={}),void 0!==t){var r=this.cache.get(t);if(void 0!==r)return r;var n=e.storage;if(n){if(P(n))return null;var i=n.get(t);return this.cache.set(t,i),i}}},e.prototype.get=function(t,e,r){return void 0===e&&(e={}),void 0===r&&(r=!1),a(this,void 0,void 0,function(){var n,i,o;return c(this,function(u){switch(u.label){case 0:if(void 0===t)return[2];if(void 0!==(n=this.cache.get(t)))return[2,n];if(!(i=e.storage))return[2];return[4,i.get(t,r)];case 1:return o=u.sent(),this.cache.set(t,o),[2,o]}})})},e.prototype.set=function(t,e,r){return void 0===r&&(r={}),a(this,void 0,void 0,function(){var n,i,o,u,s;return c(this,function(a){switch(a.label){case 0:if(void 0===t||(this.cache.set(t,e),this.publish(t,e),!(n=r.storage)))return[2];return i=e.data,o=e.time,u=e.cooldown,s=e.expiration,[4,n.set(t,{data:i,time:o,cooldown:u,expiration:s})];case 1:return a.sent(),[2]}})})},e.prototype.delete=function(t,e){return void 0===e&&(e={}),a(this,void 0,void 0,function(){var r;return c(this,function(n){switch(n.label){case 0:if(!t||(this.cache.delete(t),this.locks.delete(t),this.publish(t,void 0),!(r=e.storage)))return[2];return[4,r.delete(t)];case 1:return n.sent(),[2]}})})},e.prototype.mutate=function(t,e,r,n){var i;return void 0===n&&(n={}),a(this,void 0,void 0,function(){var o,s,a,l,f;return c(this,function(c){switch(c.label){case 0:if(void 0===t)return[2];if(o=r(e))return[3,2];return[4,this.delete(t,n)];case 1:return c.sent(),[2];case 2:if(void 0!==o.time&&o.time<(null!==(i=null==e?void 0:e.time)&&void 0!==i?i:0)||void 0===o.optimistic&&(null==e?void 0:e.optimistic))return[2,e];return a=void 0===(s=n.equals)?_:s,f=l=u(u({},e),o),[4,this.normalize(!1,l,n)];case 3:if(f.data=c.sent(),void 0===l.time&&(l.time=Date.now()),a(l.data,null==e?void 0:e.data)&&(l.data=null==e?void 0:e.data),l.optimistic||(l.realData=l.data),x(l,e))return[2,e];return[4,this.set(t,l,n)];case 4:return c.sent(),[2,l]}})})},e.prototype.normalize=function(t,e,r){return void 0===r&&(r={}),a(this,void 0,void 0,function(){return c(this,function(n){switch(n.label){case 0:if(void 0===e.data)return[2];if(void 0===r.normalizer)return[2,e.data];return[4,r.normalizer(e.data,{core:this,shallow:t,root:e})];case 1:return[2,n.sent()]}})})},e.prototype.shouldCooldown=function(t){return(null==t?void 0:t.cooldown)!==void 0&&Date.now()<t.cooldown},e.prototype.once=function(t,e,r){var n=this;if(void 0===r&&(r={}),t){var i=function(o){n.off(t,i,r),e(o)};this.on(t,i,r)}},e.prototype.on=function(e,r,n){if(e){t.prototype.on.call(this,e,r);var i,o=null!==(i=this.counts.get(e))&&void 0!==i?i:0;this.counts.set(e,o+1);var u=this.timeouts.get(e);void 0!==u&&(clearTimeout(u),this.timeouts.delete(e))}},e.prototype.off=function(e,r,n){return void 0===n&&(n={}),a(this,void 0,void 0,function(){var i,o,u,s,l,f=this;return c(this,function(s){switch(s.label){case 0:if(!e)return[2];if(t.prototype.off.call(this,e,r),void 0===(i=this.counts.get(e)))throw Error("Undefined count");if(i>1)return this.counts.set(e,i-1),[2];return this.counts.delete(e),[4,this.get(e,n,!0)];case 1:if((null==(o=s.sent())?void 0:o.expiration)===void 0||(null==o?void 0:o.expiration)===-1)return[2];if(u=function(){return a(f,void 0,void 0,function(){var t;return c(this,function(t){switch(t.label){case 0:if(!this._mounted||void 0!==this.counts.get(e))return[2];return this.timeouts.delete(e),[4,this.delete(e,n)];case 1:return t.sent(),[2]}})})},!(Date.now()>o.expiration))return[3,3];return[4,u()];case 2:return s.sent(),[2];case 3:return l=setTimeout(u,o.expiration-Date.now()),this.timeouts.set(e,l),[2]}})})},e}(p),L=t.createContext(void 0);function z(){var e=t.useContext(L);if(void 0===e)throw Error("Undefined core");return e}function M(e){var r=t.useRef();return void 0===r.current&&(r.current=new T(e)),t.useEffect(function(){return function(){var t;null===(t=r.current)||void 0===t||t.unmount()}},[]),r.current}function U(t){var e=t.children,n=M(s(t,["children"]));return r.default.createElement(L.Provider,{value:n},e)}function B(e,r){var n=e.data,i=e.error,o=e.time;t.useEffect(function(){console.debug(r,e)},[n,i,o])}function F(e,r){var n=e.error;t.useEffect(function(){void 0!==n&&r(n)},[n])}function J(t,e){var r=t.data,n=t.error;void 0===r&&void 0===n&&Object.assign(t,e)}function q(e){var r=e.fetch;t.useEffect(function(){r()},[r])}function W(e,r){var n=e.ready,i=e.fetch;t.useEffect(function(){if(n&&r){var t=setInterval(i,r);return function(){return clearInterval(t)}}},[i,r])}function X(e){var r=e.fetch;t.useEffect(function(){r()},[])}function H(e){var r=e.data,n=e.fetch;t.useEffect(function(){void 0===r&&n()},[r,n])}function K(e){var r=t.useRef(e);return r.current=e,r}function G(e){var r=e.ready,n=K(e.fetch);t.useEffect(function(){if(r){var t=function(){return n.current()};return addEventListener("online",t),function(){return removeEventListener("online",t)}}},[r])}function Q(e,r){void 0===r&&(r={});var n=e.ready,i=e.skey,o=e.refetch,u=e.error,s=r.init,a=void 0===s?1e3:s,c=r.base,l=void 0===c?2:c,f=r.max,d=void 0===f?3:f,h=t.useRef(0);t.useEffect(function(){h.current=0},[i]);var v=K(o);t.useEffect(function(){var t=function(){h.current++,v.current()};if(n){if(void 0===u){h.current=0;return}if(!(h.current>=d)){var e=setTimeout(t,a*Math.pow(l,h.current));return function(){return clearTimeout(e)}}}},[n,u])}function V(e){var r=e.ready,n=K(e.fetch);t.useEffect(function(){if(r){var t=function(){return!document.hidden&&n.current()};return document.addEventListener("visibilitychange",t),function(){return document.removeEventListener("visibilitychange",t)}}},[r])}function Z(t,e){if(void 0!==t){if("string"==typeof t)return t;var r=e.serializer;return"scroll:".concat((void 0===r?O:r).stringify(t))}}var Y=function(){var t=function(t,e,r,n){void 0===n&&(n={}),this.core=t,this.scroller=e,this.fetcher=r,this.params=n,this.mparams=u(u({},t.params),n),this.key=e(),this.skey=Z(this.key,this.mparams),this.loadSync(),this.subscribe()};return Object.defineProperty(t.prototype,"init",{get:function(){return this._init},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ready",{get:function(){return null!==this._state},enumerable:!1,configurable:!0}),t.prototype.loadSync=function(){var t=this.core,e=this.skey,r=this.mparams;this._state=t.getSync(e,r)},t.prototype.loadAsync=function(){return a(this,void 0,void 0,function(){var t,e,r,n,i;return c(this,function(o){switch(o.label){case 0:if(this.ready)return[2];return t=this,e=t.core,r=t.skey,n=t.mparams,i=this,[4,e.get(r,n)];case 1:return i._state=o.sent(),[2]}})})},t.prototype.subscribe=function(){var t=this,e=this.core,r=this.skey,n=function(e){return t._state=e};e.on(r,n),new FinalizationRegistry(function(){e.off(r,n)}).register(this,void 0)},t.prototype.mutate=function(t){var e;return a(this,void 0,void 0,function(){var r,n,i,o,u;return c(this,function(s){switch(s.label){case 0:if(r=this,n=r.core,i=r.skey,o=r.mparams,null!==this._state)return[3,2];return[4,null!==(e=this._init)&&void 0!==e?e:this._init=this.loadAsync()];case 1:s.sent(),s.label=2;case 2:if(null===this._state)throw Error("Null state after init");return u=this,[4,n.mutate(i,this._state,t,o)];case 3:return[2,u._state=s.sent()]}})})},t.prototype.fetch=function(t){var e;return a(this,void 0,void 0,function(){var r,n,i,o,u,s,a;return c(this,function(c){switch(c.label){case 0:if(r=this,n=r.core,i=r.scroller,o=r.skey,u=r.fetcher,s=r.mparams,null!==this._state)return[3,2];return[4,null!==(e=this._init)&&void 0!==e?e:this._init=this.loadAsync()];case 1:c.sent(),c.label=2;case 2:if(null===this._state)throw Error("Null state after init");if(void 0===u)return[2,this._state];return a=this,[4,n.scroll.first(o,i,u,t,s)];case 3:return[2,a._state=c.sent()]}})})},t.prototype.refetch=function(t){var e;return a(this,void 0,void 0,function(){var r,n,i,o,u,s,a;return c(this,function(c){switch(c.label){case 0:if(r=this,n=r.core,i=r.scroller,o=r.skey,u=r.fetcher,s=r.mparams,null!==this._state)return[3,2];return[4,null!==(e=this._init)&&void 0!==e?e:this._init=this.loadAsync()];case 1:c.sent(),c.label=2;case 2:if(null===this._state)throw Error("Null state after init");if(void 0===u)return[2,this._state];return a=this,[4,n.scroll.first(o,i,u,t,s,!0,!0)];case 3:return[2,a._state=c.sent()]}})})},t.prototype.scroll=function(t){var e;return a(this,void 0,void 0,function(){var r,n,i,o,u,s,a;return c(this,function(c){switch(c.label){case 0:if(r=this,n=r.core,i=r.scroller,o=r.skey,u=r.fetcher,s=r.mparams,null!==this._state)return[3,2];return[4,null!==(e=this._init)&&void 0!==e?e:this._init=this.loadAsync()];case 1:c.sent(),c.label=2;case 2:if(null===this._state)throw Error("Null state after init");if(void 0===u)return[2,this._state];return a=this,[4,n.scroll.scroll(o,i,u,t,s,!0,!0)];case 3:return[2,a._state=c.sent()]}})})},t.prototype.clear=function(){return a(this,void 0,void 0,function(){var t,e,r,n;return c(this,function(i){switch(i.label){case 0:return t=this,e=t.core,r=t.skey,n=t.mparams,[4,e.delete(r,n)];case 1:return i.sent(),delete this._state,[2]}})})},t}();function $(t,e,r){return void 0===r&&(r={}),new tt(t,e,r)}var tt=function(){var t=function(t,e,r){void 0===r&&(r={}),this.scroller=t,this.fetcher=e,this.params=r};return t.prototype.make=function(t){var e=this.scroller,r=this.fetcher,n=this.params;return new Y(t,e,r,n)},t.prototype.normalize=function(t,e){return a(this,void 0,void 0,function(){var r,n,i,o,u,s;return c(this,function(u){switch(u.label){case 0:if(e.shallow)return[2];return n=(r=e.root).time,i=r.cooldown,s={data:t,time:n,cooldown:i,expiration:o=r.expiration,optimistic:r.optimistic},[4,this.make(e.core).mutate(function(){return s})];case 1:return u.sent(),[2]}})})},t}();function te(t,e){if(void 0!==t){if("string"==typeof t)return t;var r=e.serializer;return(void 0===r?O:r).stringify(t)}}var tr=function(){var t=function(t,e,r,n){void 0===n&&(n={}),this.core=t,this.key=e,this.fetcher=r,this.params=n,this.mparams=u(u({},t.params),n),this.skey=te(e,this.mparams),this.loadSync(),this.subscribe()};return Object.defineProperty(t.prototype,"init",{get:function(){return this._init},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ready",{get:function(){return null!==this._state},enumerable:!1,configurable:!0}),t.prototype.loadSync=function(){var t=this.core,e=this.skey,r=this.mparams;this._state=t.getSync(e,r)},t.prototype.loadAsync=function(){return a(this,void 0,void 0,function(){var t,e,r,n,i;return c(this,function(o){switch(o.label){case 0:if(this.ready)return[2];return t=this,e=t.core,r=t.skey,n=t.mparams,i=this,[4,e.get(r,n)];case 1:return i._state=o.sent(),[2]}})})},t.prototype.subscribe=function(){var t=this,e=this.core,r=this.skey,n=function(e){return t._state=e};e.on(this.skey,n),new FinalizationRegistry(function(){e.off(r,n)}).register(this,void 0)},t.prototype.mutate=function(t){var e;return a(this,void 0,void 0,function(){var r,n,i,o,u;return c(this,function(s){switch(s.label){case 0:if(r=this,n=r.core,i=r.skey,o=r.mparams,null!==this._state)return[3,2];return[4,null!==(e=this._init)&&void 0!==e?e:this._init=this.loadAsync()];case 1:s.sent(),s.label=2;case 2:if(null===this._state)throw Error("Null state after init");return u=this,[4,n.mutate(i,this._state,t,o)];case 3:return[2,u._state=s.sent()]}})})},t.prototype.fetch=function(t){var e;return a(this,void 0,void 0,function(){var r,n,i,o,u,s,a;return c(this,function(c){switch(c.label){case 0:if(r=this,n=r.core,i=r.key,o=r.skey,u=r.fetcher,s=r.mparams,null!==this._state)return[3,2];return[4,null!==(e=this._init)&&void 0!==e?e:this._init=this.loadAsync()];case 1:c.sent(),c.label=2;case 2:if(null===this._state)throw Error("Null state after init");if(void 0===u)return[2,this._state];return a=this,[4,n.single.fetch(i,o,u,t,s)];case 3:return[2,a._state=c.sent()]}})})},t.prototype.refetch=function(t){var e;return a(this,void 0,void 0,function(){var r,n,i,o,u,s,a;return c(this,function(c){switch(c.label){case 0:if(r=this,n=r.core,i=r.key,o=r.skey,u=r.fetcher,s=r.mparams,null!==this._state)return[3,2];return[4,null!==(e=this._init)&&void 0!==e?e:this._init=this.loadAsync()];case 1:c.sent(),c.label=2;case 2:if(null===this._state)throw Error("Null state after init");if(void 0===u)return[2,this._state];return a=this,[4,n.single.fetch(i,o,u,t,s,!0,!0)];case 3:return[2,a._state=c.sent()]}})})},t.prototype.update=function(t,e,r){var n;return void 0===e&&(e={}),a(this,void 0,void 0,function(){var i,o,s,a,l,f,d,h;return c(this,function(c){switch(c.label){case 0:if(i=this,o=i.core,s=i.key,a=i.skey,l=i.fetcher,f=i.mparams,null!==this._state)return[3,2];return[4,null!==(n=this._init)&&void 0!==n?n:this._init=this.loadAsync()];case 1:c.sent(),c.label=2;case 2:if(null===this._state)throw Error("Null state after init");return d=u(u({},f),e),h=this,[4,o.single.update(s,a,l,t,r,d)];case 3:return[2,h._state=c.sent()]}})})},t.prototype.clear=function(){return a(this,void 0,void 0,function(){var t,e,r,n;return c(this,function(i){switch(i.label){case 0:return t=this,e=t.core,r=t.skey,n=t.mparams,[4,e.delete(r,n)];case 1:return i.sent(),delete this._state,[2]}})})},t}();function tn(t,e,r){return void 0===r&&(r={}),new ti(t,e,r)}var ti=function(){var t=function(t,e,r){void 0===r&&(r={}),this.key=t,this.fetcher=e,this.params=r};return t.prototype.make=function(t){var e=this.key,r=this.fetcher,n=this.params;return new tr(t,e,r,n)},t.prototype.normalize=function(t,e){return a(this,void 0,void 0,function(){var r,n,i,o,u,s;return c(this,function(u){switch(u.label){case 0:if(e.shallow)return[2];return n=(r=e.root).time,i=r.cooldown,s={data:t,time:n,cooldown:i,expiration:o=r.expiration,optimistic:r.optimistic},[4,this.make(e.core).mutate(function(){return s})];case 1:return u.sent(),[2]}})})},t}();function to(e,r,n){var i=this;void 0===n&&(n={});var o=z(),s=u(u({},o.params),n),l=K(e),d=K(r),h=K(s),v=t.useMemo(function(){return e()},[e]),p=t.useMemo(function(){return Z(v,h.current)},[v]),y=f(t.useState(0),2)[1],m=t.useRef();t.useMemo(function(){m.current=o.getSync(p,h.current)},[o,p]);var b=t.useCallback(function(t){m.current=t,y(function(t){return t+1})},[]),w=t.useRef();t.useEffect(function(){null===m.current&&(w.current=o.get(p,h.current).then(b))},[o,p]),t.useEffect(function(){if(p)return o.on(p,b,h.current),function(){o.off(p,b,h.current)}},[o,p]);var g=t.useCallback(function(t){return a(i,void 0,void 0,function(){var e,r;return c(this,function(n){switch(n.label){case 0:if(null!==m.current)return[3,2];return[4,w.current];case 1:n.sent(),n.label=2;case 2:if(null===m.current)throw Error("Null state after init");return e=m.current,r=h.current,[4,o.mutate(p,e,t,r)];case 3:return[2,n.sent()]}})})},[o,p]),S=t.useCallback(function(){return a(i,void 0,void 0,function(){return c(this,function(t){switch(t.label){case 0:if(null!==m.current)return[3,2];return[4,w.current];case 1:t.sent(),t.label=2;case 2:if(null===m.current)throw Error("Null state after init");return[4,o.delete(p,h.current)];case 3:return t.sent(),[2]}})})},[o,p]),k=t.useCallback(function(t){return a(i,void 0,void 0,function(){var e,r,n;return c(this,function(i){switch(i.label){case 0:if("undefined"==typeof window)throw Error("Fetch on SSR");if(null!==m.current)return[3,2];return[4,w.current];case 1:i.sent(),i.label=2;case 2:if(null===m.current)throw Error("Null state after init");if(void 0===d.current)return[2,m.current];return e=l.current,r=d.current,n=h.current,[4,o.scroll.first(p,e,r,t,n)];case 3:return[2,i.sent()]}})})},[o,p]),E=t.useCallback(function(t){return a(i,void 0,void 0,function(){var e,r,n;return c(this,function(i){switch(i.label){case 0:if("undefined"==typeof window)throw Error("Refetch on SSR");if(null!==m.current)return[3,2];return[4,w.current];case 1:i.sent(),i.label=2;case 2:if(null===m.current)throw Error("Null state after init");if(void 0===d.current)return[2,m.current];return e=l.current,r=d.current,n=h.current,[4,o.scroll.first(p,e,r,t,n,!0,!0)];case 3:return[2,i.sent()]}})})},[o,p]),x=t.useCallback(function(t){return a(i,void 0,void 0,function(){var e,r,n;return c(this,function(i){switch(i.label){case 0:if("undefined"==typeof window)throw Error("Scroll on SSR");if(null!==m.current)return[3,2];return[4,w.current];case 1:i.sent(),i.label=2;case 2:if(null===m.current)throw Error("Null state after init");if(void 0===d.current)return[2,m.current];return e=l.current,r=d.current,n=h.current,[4,o.scroll.scroll(p,e,r,t,n,!0,!0)];case 3:return[2,i.sent()]}})})},[o,p]),_=t.useCallback(function(){if("undefined"==typeof window)throw Error("Suspend on SSR");return a(i,void 0,void 0,function(){var t,e,r,n;return c(this,function(i){switch(i.label){case 0:if(null!==m.current)return[3,2];return[4,w.current];case 1:i.sent(),i.label=2;case 2:if(null===m.current)throw Error("Null state after init");if(void 0===d.current)throw Error("No fetcher");return t=l.current,e=d.current,r=h.current,n=new Promise(function(t){return o.once(p,function(){return t()},r)}),[4,o.scroll.first(p,t,e,void 0,r,!1,!0)];case 3:return i.sent(),[4,n];case 4:return i.sent(),[2]}})})},[o,p]),O=m.current,D=null!=O?O:{},C=D.data,A=D.error,I=D.time,R=D.cooldown,N=D.expiration,P=D.aborter,j=D.optimistic,T=D.realData,L=Boolean(P);return{key:v,skey:p,data:C,error:A,time:I,cooldown:R,expiration:N,aborter:P,optimistic:j,realData:T,loading:L,ready:null!==O,mutate:g,fetch:k,refetch:E,scroll:x,clear:S,suspend:_}}function tu(e,r,n){var i=this;void 0===n&&(n={});var o=z(),s=u(u({},o.params),n),l=K(e),d=K(r),h=K(s),v=t.useMemo(function(){return te(e,h.current)},[e]),p=f(t.useState(0),2)[1],y=t.useRef();t.useMemo(function(){y.current=o.getSync(v,h.current)},[o,v]);var m=t.useCallback(function(t){y.current=t,p(function(t){return t+1})},[]),b=t.useRef();t.useEffect(function(){null===y.current&&(b.current=o.get(v,h.current).then(m))},[o,v]),t.useEffect(function(){if(v)return o.on(v,m,h.current),function(){o.off(v,m,h.current)}},[o,v]);var w=t.useCallback(function(t){return a(i,void 0,void 0,function(){var e,r;return c(this,function(n){switch(n.label){case 0:if(null!==y.current)return[3,2];return[4,b.current];case 1:n.sent(),n.label=2;case 2:if(null===y.current)throw Error("Null state after init");return e=y.current,r=h.current,[4,o.mutate(v,e,t,r)];case 3:return[2,n.sent()]}})})},[o,v]),g=t.useCallback(function(){return a(i,void 0,void 0,function(){return c(this,function(t){switch(t.label){case 0:if(null!==y.current)return[3,2];return[4,b.current];case 1:t.sent(),t.label=2;case 2:if(null===y.current)throw Error("Null state after init");return[4,o.delete(v,h.current)];case 3:return t.sent(),[2]}})})},[o,v]),S=t.useCallback(function(t){return a(i,void 0,void 0,function(){var e,r,n;return c(this,function(i){switch(i.label){case 0:if("undefined"==typeof window)throw Error("Fetch on SSR");if(null!==y.current)return[3,2];return[4,b.current];case 1:i.sent(),i.label=2;case 2:if(null===y.current)throw Error("Null state after init");if(void 0===d.current)return[2,y.current];return e=l.current,r=d.current,n=h.current,[4,o.single.fetch(e,v,r,t,n)];case 3:return[2,i.sent()]}})})},[o,v]),k=t.useCallback(function(t){return a(i,void 0,void 0,function(){var e,r,n;return c(this,function(i){switch(i.label){case 0:if("undefined"==typeof window)throw Error("Refetch on SSR");if(null!==y.current)return[3,2];return[4,b.current];case 1:i.sent(),i.label=2;case 2:if(null===y.current)throw Error("Null state after init");if(void 0===d.current)return[2,y.current];return e=l.current,r=d.current,n=h.current,[4,o.single.fetch(e,v,r,t,n,!0,!0)];case 3:return[2,i.sent()]}})})},[o,v]),E=t.useCallback(function(t,e,r){return void 0===e&&(e={}),a(i,void 0,void 0,function(){var n,i,s,a;return c(this,function(s){switch(s.label){case 0:if("undefined"==typeof window)throw Error("Update on SSR");if(null!==y.current)return[3,2];return[4,b.current];case 1:s.sent(),s.label=2;case 2:if(null===y.current)throw Error("Null state after init");return n=l.current,i=d.current,a=u(u({},h.current),e),[4,o.single.update(n,v,i,t,r,a)];case 3:return[2,s.sent()]}})})},[o,v]),x=t.useCallback(function(){if("undefined"==typeof window)throw Error("Suspend on SSR");return a(i,void 0,void 0,function(){var t,e,r,n;return c(this,function(i){switch(i.label){case 0:if(null!==y.current)return[3,2];return[4,b.current];case 1:i.sent(),i.label=2;case 2:if(null===y.current)throw Error("Null state after init");if(void 0===d.current)throw Error("No fetcher");return t=l.current,e=d.current,r=h.current,n=new Promise(function(t){return o.once(v,function(){return t()},r)}),[4,o.single.fetch(t,v,e,void 0,r,!1,!0)];case 3:return i.sent(),[4,n];case 4:return i.sent(),[2]}})})},[o,v]),_=y.current,O=null!=_?_:{},D=O.data,C=O.error,A=O.time,I=O.cooldown,R=O.expiration,N=O.aborter,P=O.optimistic,j=O.realData,T=Boolean(N);return{key:e,skey:v,data:D,error:C,time:A,cooldown:I,expiration:R,aborter:N,optimistic:P,realData:j,loading:T,ready:null!==_,mutate:w,fetch:S,refetch:k,update:E,clear:g,suspend:x}}function ts(t,e){return null!=e&&"undefined"!=typeof Symbol&&e[Symbol.hasInstance]?!!e[Symbol.hasInstance](t):t instanceof e}function ta(e,r){var n=t.useMemo(function(){return e.apply(void 0,d([],f(r),!1))},r);if(ts(n,ti)){var i=n.key,o=n.fetcher,u=n.params;return tu(i,o,u)}if(ts(n,tt)){var s=n.scroller,o=n.fetcher,u=n.params;return to(s,o,u)}throw Error("Invalid resource schema")}function tc(){var e=z(),r=t.useCallback(function(t){return t.make(e)},[e]);return{core:e,make:r}}function tl(e){var r=t.useRef();return void 0===r.current&&(r.current=new tf(e)),t.useEffect(function(){return function(){var t;null===(t=r.current)||void 0===t||t.unmount()}},[]),r.current}var tf=function(){var t=function(t){var e=this;this.name=t,this.async=!0,this.keys=new Set,"undefined"!=typeof indexedDB&&(this.initialization=this.load(),this.onunload=function(){return e.unload()},addEventListener("beforeunload",this.onunload))};return Object.defineProperty(t.prototype,"database",{get:function(){return this._database},enumerable:!1,configurable:!0}),t.prototype.load=function(){return a(this,void 0,void 0,function(){var t,e,r,n=this;return c(this,function(r){switch(r.label){case 0:if("undefined"==typeof indexedDB)return[2];return t=this,[4,new Promise(function(t,e){var r=indexedDB.open(n.name,1);r.onupgradeneeded=function(){return r.result.createObjectStore("keyval",{})},r.onblocked=function(){return e("blocked")},r.onsuccess=function(){return t(r.result)},r.onerror=function(){return e(r.error)}})];case 1:if(t._database=r.sent(),"undefined"==typeof Storage||!(e=localStorage.getItem("idb.".concat(this.name,".keys"))))return[2];return JSON.parse(e).forEach(function(t){return n.keys.add(t)}),localStorage.removeItem("idb.".concat(this.name,".keys")),[4,this.collect().catch(console.error)];case 2:return r.sent(),[2]}})})},t.prototype.unmount=function(){"undefined"!=typeof indexedDB&&(void 0!==this.onunload&&removeEventListener("beforeunload",this.onunload),this.collect().catch(console.error))},t.prototype.unload=function(){if("undefined"!=typeof Storage){var t=JSON.stringify(d([],f(this.keys),!1));localStorage.setItem("idb.".concat(this.name,".keys"),t)}},t.prototype.collect=function(){return a(this,void 0,void 0,function(){var t,e,r,n,i,o,u;return c(this,function(i){switch(i.label){case 0:if("undefined"==typeof indexedDB)return[2];i.label=1;case 1:i.trys.push([1,6,7,8]),e=(t=l(this.keys)).next(),i.label=2;case 2:if(e.done)return[3,5];return r=e.value,[4,this.get(r,!0)];case 3:if((null==(n=i.sent())?void 0:n.expiration)===void 0||n.expiration>Date.now())return[3,4];this.delete(r,!1),i.label=4;case 4:return e=t.next(),[3,2];case 5:return[3,8];case 6:return o={error:i.sent()},[3,8];case 7:try{e&&!e.done&&(u=t.return)&&u.call(t)}finally{if(o)throw o.error}return[7];case 8:return[2]}})})},t.prototype.transact=function(t,e){return a(this,void 0,void 0,function(){var r=this;return c(this,function(n){switch(n.label){case 0:if("undefined"==typeof indexedDB)return[2];if(void 0!==this.database)return[3,2];return[4,this.initialization];case 1:n.sent(),n.label=2;case 2:return[4,new Promise(function(n,i){if(void 0===r.database)throw Error("Undefined database");var o,u=r.database.transaction("keyval",e);u.onerror=function(){return i(u.error)},u.oncomplete=function(){return n(o)},t(u.objectStore("keyval")).then(function(t){return o=t}).then(function(){return u.commit()}).catch(i)})];case 3:return[2,n.sent()]}})})},t.prototype.get=function(t,e){return void 0===e&&(e=!1),a(this,void 0,void 0,function(){var r=this;return c(this,function(n){switch(n.label){case 0:if("undefined"==typeof indexedDB)return[2];return e||this.keys.has(t)||this.keys.add(t),[4,this.transact(function(e){return a(r,void 0,void 0,function(){return c(this,function(r){switch(r.label){case 0:return[4,new Promise(function(r,n){var i=e.get(t);i.onerror=function(){return n(i.error)},i.onsuccess=function(){return r(i.result)}})];case 1:return[2,r.sent()]}})})},"readonly")];case 1:return[2,n.sent()]}})})},t.prototype.set=function(t,e,r){return void 0===r&&(r=!1),a(this,void 0,void 0,function(){var n=this;return c(this,function(i){switch(i.label){case 0:if("undefined"==typeof indexedDB)return[2];return r||this.keys.has(t)||this.keys.add(t),[4,this.transact(function(r){return a(n,void 0,void 0,function(){return c(this,function(n){switch(n.label){case 0:return[4,new Promise(function(n,i){var o=r.put(e,t);o.onerror=function(){return i(o.error)},o.onsuccess=function(){return n()}})];case 1:return[2,n.sent()]}})})},"readwrite")];case 1:return[2,i.sent()]}})})},t.prototype.delete=function(t,e){return void 0===e&&(e=!1),a(this,void 0,void 0,function(){var r=this;return c(this,function(n){switch(n.label){case 0:if("undefined"==typeof indexedDB)return[2];return!e&&this.keys.has(t)&&this.keys.delete(t),[4,this.transact(function(e){return a(r,void 0,void 0,function(){return c(this,function(r){switch(r.label){case 0:return[4,new Promise(function(r,n){var i=e.delete(t);i.onerror=function(){return n(i.error)},i.onsuccess=function(){return r()}})];case 1:return[2,r.sent()]}})})},"readwrite")];case 1:return[2,n.sent()]}})})},t}();function td(e,r){var n=t.useRef();return void 0===n.current&&(n.current=new th(e,r)),t.useEffect(function(){return function(){var t;null===(t=n.current)||void 0===t||t.unmount()}},[]),n.current}var th=function(){var t=function(t,e){void 0===t&&(t="xswr:"),void 0===e&&(e=JSON);var r=this;this.prefix=t,this.serializer=e,this.async=!0,this.keys=new Set,"undefined"!=typeof Storage&&(this.onunload=function(){return r.collect()},addEventListener("beforeunload",this.onunload))};return t.prototype.unmount=function(){"undefined"!=typeof Storage&&(this.onunload&&removeEventListener("beforeunload",this.onunload),a(this,void 0,void 0,function(){return c(this,function(t){return[2,this.collect()]})}).catch(console.error))},t.prototype.collect=function(){var t,e;if("undefined"!=typeof Storage)try{for(var r=l(this.keys),n=r.next();!n.done;n=r.next()){var i=n.value,o=this.getSync(i,!0);(null==o?void 0:o.expiration)!==void 0&&(o.expiration>Date.now()||this.delete(i,!1))}}catch(u){t={error:u}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}},t.prototype.getSync=function(t,e){if(void 0===e&&(e=!1),"undefined"!=typeof Storage){e||this.keys.has(t)||this.keys.add(t);var r=localStorage.getItem(this.prefix+t);if(r)return this.serializer.parse(r)}},t.prototype.get=function(t,e){return void 0===e&&(e=!1),a(this,void 0,void 0,function(){var r;return c(this,function(n){return"undefined"==typeof Storage?[2]:(e||this.keys.has(t)||this.keys.add(t),r=localStorage.getItem(this.prefix+t))?[2,this.serializer.parse(r)]:[2]})})},t.prototype.set=function(t,e,r){return void 0===r&&(r=!1),a(this,void 0,void 0,function(){var n;return c(this,function(i){return"undefined"==typeof Storage||(r||this.keys.has(t)||this.keys.add(t),n=this.serializer.stringify(e),localStorage.setItem(this.prefix+t,n)),[2]})})},t.prototype.delete=function(t,e){return void 0===e&&(e=!1),a(this,void 0,void 0,function(){return c(this,function(r){return"undefined"==typeof Storage||(!e&&this.keys.has(t)&&this.keys.delete(t),localStorage.removeItem(this.prefix+t)),[2]})})},t}();function tv(e,r){var n=t.useRef();return n.current||(n.current=new tp(e,r)),t.useEffect(function(){return function(){var t;null===(t=n.current)||void 0===t||t.unmount()}},[]),n.current}var tp=function(){var t=function(t,e){void 0===t&&(t="xswr:"),void 0===e&&(e=JSON);var r=this;this.prefix=t,this.serializer=e,this.async=!1,this.keys=new Set,"undefined"!=typeof Storage&&(this.onunload=function(){return r.collect()},addEventListener("beforeunload",this.onunload))};return t.prototype.unmount=function(){"undefined"!=typeof Storage&&(removeEventListener("beforeunload",this.onunload),a(this,void 0,void 0,function(){return c(this,function(t){return[2,this.collect()]})}).catch(console.error))},t.prototype.collect=function(){var t,e;if("undefined"!=typeof Storage)try{for(var r=l(this.keys),n=r.next();!n.done;n=r.next()){var i=n.value,o=this.get(i,!0);(null==o?void 0:o.expiration)!==void 0&&(o.expiration>Date.now()||this.delete(i,!1))}}catch(u){t={error:u}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}},t.prototype.get=function(t,e){if(void 0===e&&(e=!1),"undefined"!=typeof Storage){e||this.keys.has(t)||this.keys.add(t);var r=localStorage.getItem(this.prefix+t);if(r)return this.serializer.parse(r)}},t.prototype.set=function(t,e,r){if(void 0===r&&(r=!1),"undefined"!=typeof Storage){r||this.keys.has(t)||this.keys.add(t);var n=this.serializer.stringify(e);localStorage.setItem(this.prefix+t,n)}},t.prototype.delete=function(t,e){void 0===e&&(e=!1),"undefined"!=typeof Storage&&(!e&&this.keys.has(t)&&this.keys.delete(t),localStorage.removeItem(this.prefix+t))},t}(),ty={__proto__:null,Core:T,AbortError:w,isAbortError:g,CoreContext:L,useCore:z,useCoreProvider:M,CoreProvider:U,useDebug:B,useError:F,useFallback:J,useFetch:q,useInterval:W,useMount:X,useOnce:H,useOnline:G,useRetry:Q,useVisible:V,use:ta,useScroll:to,useSingle:tu,useXSWR:tc,ScrollHelper:I,getScrollStorageKey:Z,ScrollObject:Y,scroll:$,ScrollSchema:tt,SingleHelper:N,getSingleStorageKey:te,SingleObject:tr,single:tn,SingleSchema:ti,useIDBStorage:tl,IDBStorage:tf,useAsyncLocalStorage:td,AsyncLocalStorage:th,useSyncLocalStorage:tv,SyncLocalStorage:tp,isAsyncStorage:P,DEFAULT_EQUALS:_,DEFAULT_SERIALIZER:O,DEFAULT_COOLDOWN:D,DEFAULT_EXPIRATION:C,DEFAULT_TIMEOUT:A,refEquals:k,jsonEquals:E,shallowEquals:x};exports.XSWR=ty;
